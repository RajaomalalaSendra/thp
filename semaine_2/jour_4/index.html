<!DOCTYPE html>
<html class="loading" lang="fr">
  <head>
<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/thp/style/bootstrap.css">
    <title>The hacking project offline</title>
  </head>
  <body class="vertical-layout vertical-menu 2-columns  menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <h1 class="navbar-brand">THE HACKING PROJECT</h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/thp">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/about">About</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>

<div class="container">
    <a type="button" class="btn btn-dark" href="/thp/semaine_1/">Semaine 1</a>
    <a type="button" class="btn btn-dark btn-lg" href="/thp/semaine_2/">Semaine 2</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_3/">Semaine 3</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_4/">Semaine 4</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_5/">Semaine 5</a>  
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      <div class="container">
    <div class="card">
  <div class="card-header">
    <h4 class="text-center"> Programme jour par jour</h4>
  </div>
  <div class="card-body">
    <div class="text-center">
    <a href="/thp/semaine_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-terminal"></i>&nbsp;&nbsp;&nbsp;Lun
      </button>
</a>    <a href="/thp/semaine_2/jour_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-code"></i>&nbsp;&nbsp;&nbsp;Mar
      </button>
</a>    <a href="/thp/semaine_2/jour_3">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-desktop"></i>&nbsp;&nbsp;&nbsp;Mer
      </button>
</a>    <a href="/thp/semaine_2/jour_4">
      <button class="btn btn-secondary btn-outline-dark btn-lg mr-4">
      <i class="fa fa-folder-open"></i>&nbsp;&nbsp;&nbsp;Jeu
      </button>
</a>    <a href="/thp/semaine_2/jour_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-bullhorn"></i>&nbsp;&nbsp;&nbsp;Ven
      </button>
</a>    </div>
  </div>
</div>


<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      
<div class="content-body">
      <h2 class="text-center">L&#39;art du scrapping</h2>
      <h4 class="text-center">Découverte de Ruby</h4>
  <div class="row">
     <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
              <i class="ft-calendar icon-opacity info font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
              <span class="d-block mb-1 font-medium-1"></span>
              <h3 class="info mb-0">
                 Jour 24 / 55</h3>
          </div>
        </div>
        <div class="progress progress-sm mt-1 mb-0 box-shadow-2">
            <div class="progress-bar bg-gradient-x-info" role="progressbar" style="width: 43%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="120">
            </div>
        </div>
      </div>
    </div>
  </div>
 </div>


    <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
            <i class="ft-heart icon-opacity danger font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
            <span class="d-block mb-1 font-medium-1">Jokers restant</span>
            <h3 class="danger mb-0">
                3
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="col-xl-3 col-lg-6 col-md-12">
    <div class="card">
        <div class="card-content">
            <div class="card-body">
                <div class="media d-flex">
                    <div class="align-self-top">
                        <a href="/dashboard/assignments?locale=fr">
                           <i class="ft-fast-forward icon-opacity warning font-large-4"></i>
</a>                    </div>
                    <div class="media-body text-right align-self-bottom mt-3">
                        <span class="d-block mb-1 font-medium-1">Missions</span>
                            <div class="badge border-danger danger badge-border">Pas inscrit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div class="row">
        <div class="container">
    <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
        <div class="card-header">
        <h1 >Découverte de Ruby
                <i class="fa fa-space-shuttle text-danger"></i>
        </h1>
        
        </div>
        <div class="card-content">
        <div class="card-body">
            <div class="card-text">
            <h2 class="text-center">L&#39;art du scrapping</h2>
            <div class="cd-horizontal-timeline loaded">
                <div class="timeline">
                <div class="events-wrapper">
                    <div class="events" style="width: 1800px;">
                    <ol>
                                <li>
                                    <a style="left:120px;" href="/dashboard/weeks/2/days/1?locale=fr">
                                        Lun
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet à rendre ce jour-là"></i>

</a>                                </li>
                                <li>
                                    <a style="left:240px;" href="/dashboard/weeks/2/days/2?locale=fr">
                                        Mar
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journée là" ></i>


</a>                                </li>
                                <li>
                                    <a style="left:360px;" href="/dashboard/weeks/2/days/3?locale=fr">
                                        Mer
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                            <li>
                                <a class="selected" style="left:480px;" data-toggle="tooltip" data-placement="top" title="L&#39;art du scrapping" href="/dashboard/weeks/2/days/4?locale=fr">
                                    Jeu
                                        <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet à rendre ce jour-là"></i>

</a>                                </li>
                                <li>
                                    <a style="left:600px;" href="/dashboard/weeks/2/days/5?locale=fr">
                                        Ven
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journée là" ></i>


</a>                                </li>
                    </ol>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
<div>
  </div>

  <!-- Les fameuses corrections qui n'arrivnet que les jours concernés -->


    <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Exceptions</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          
<h2>1. Introduction</h2>
<p>Quand ton code n'est pas bon, Ruby va généralement planter et te sortir un truc merveilleux du genre : </p>

<pre><code class="language-bash">Traceback (most recent call last):
  2: from /home/felix/.rvm/rubies/ruby-2.5.1/bin/irb:11:in `<main>'
  1: from (irb):3
NameError (undefined local variable or method `bonjour' for main:Object)</code></pre>

<p>Ce merveilleux message d'erreur s'accompagne généralement d'un plantage : ton programme s'arrête net. Or il arrive parfois que tu n'as pas envie de faire planter le programme quand Ruby rencontre une erreur. Nous allons voir les exceptions, qui permettent d'ignorer les erreurs.</p>

<h2>2. Historique</h2>
<p>Un Système de Gestion d'Exceptions permet de gérer les erreurs, car il arrive que certaines erreurs ne soient pas des bugs, mais plutôt des cas particuliers (ou conditions exceptionnelles, ou exceptions) dans le déroulement normal d'une partie d'un programme.</p>

<p>On en a eu très rapidement besoin puisque cela a été créé vers les années 60 pour le langage LISP.</p>

<h2>3. La ressource</h2>
<p>Imagine que tu fais un programme qui va scrapper les annuaires des mairies. Tout se passe bien car toutes les pages de l'annuaire sont identiques… sauf celle de Les Eyzies-de-Tayac-Sireuil, jolie bourgade de Dordogne. Voici le résultat qu'il produira :</p>

<pre><code class="language-ruby">emails = {
  "Bordeaux" => "bordeaux@email.com",
  "Cenon" => "cenon@email.com",
  "Floirac" => "floirac@email.com",
  "Les Eyzies-de-Tayac-Sireuil" => nil,
  etc
}</code></pre>

<p>Si jamais tu fais un deuxième programme pour envoyer des emails, du genre <code>emails.each do {|city, email| send_email(email)}</code>, ton programme va sûrement planter en arrivant à Les Eyzies-de-Tayac-Sireuil car cet élément est égal à <code>nil</code>. Quel dommage de faire foirer 10 minutes d'e-mailing intense de toutes les mairies de Nouvelle-Aquitaine pour si peu : il faut juste lui dire de passer à autre chose s'il rencontre une erreur.</p>


<p>Et bien un système de gestion d'exceptions évitera ceci ! On va dire à notre programme "si jamais tu as une erreur ici, ne plante pas et fais plutôt cela".</p>

<p>Voici <a href="https://blog.honeybadger.io/a-beginner-s-guide-to-exceptions-in-ruby/" target="_blank">une très bonne introduction au sujet</a>. Pas besoin de tout lire (sauf si tu es curieux du sujet), les parties suivantes suffiront :</p>

<ul>
  <li>What's an exception?</li>
  <li>Exception Objects</li>
  <li>Rescuing All Exceptions (the bad way)</li>
  <li>Rescuing All Errors (The Right Way)</li>
</ul>

<h2>4. Points importants à retenir</h2>
<p>Des fois quand ton code va sortir une erreur, tu peux lui dire, "hey ne plante pas, et à la place fais plutôt ceci". Voici les lignes pour faire ceci en Ruby :</p>

<pre><code class="language-ruby">begin
  do_something() #partie de code qui risque de produire une erreur
rescue => e
  puts "Oups petite erreur, mais c'est pas grave" #résultat que tu veux voir en lieu et place d'une erreur terminal
end</code></pre>


<h2>5. Pour aller plus loin</h2>
<p>Tu peux aller au bout de <a href="https://blog.honeybadger.io/a-beginner-s-guide-to-exceptions-in-ruby/" target="_blank">l'article à ce sujet</a> (déjà proposé plus haut).</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Nokogiri</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>"En informatique tout est possible". Aujourd'hui, nous allons poursuivre dans le monde des bots en te présentant la gem Nokogiri, un incontournable du scrapping en Ruby. Cette super gem va te permettre de récupérer le code source d'une page HTML à partir de son URL et d'en extraire les informations avec lesquelles tu veux jouer. </p>
<p>En résumé : tu donnes une URL à Nokogiri, elle peut l'analyser et ensuite extraire les éléments HTML de la page. Par exemple, tu peux lui dire "hey récupère le <i>table</i> avec l'id <code>list-of-emails</code> puis passe sur chacune de ses lignes pour me récupérer le texte de la troisième colonne". Tu stockes tout ça dans un hash et hop : t'as scrappé tous les e-mails d'un tableau de site web. Nous allons t'apprendre à t'en servir : Yallah !</p>

<h2>2. Historique</h2>
<p>Depuis que les documents HTML existent, des gens se sont dits que ce serait bien de pouvoir lire le HTML dans un format plus lisible que <code>$ curl www.thehackingproject.org</code> (tape ça dans ton terminal pour voir). On a donc créé des bibliothèques pour aider les développeurs à coder des robots pour ce genre de tâche : Nokogiri est LE parseur HTML de référence pour Ruby.</p>

<h2>3. La ressource</h2>
<h3>3.1. Introduction à Nokogiri</h3>
<p>Pour cette ressource, nous allons te donner le lien d'un tutoriel très pratique pour apprendre à parser : celui du fameux <a href="http://ruby.bastardsbook.com/" target="_blank">The Bastards Book of Ruby</a>, un super site de Dan Nguyen. Depuis qu'il est admis à l'école de journalisme de Stanford, Dan ne le tient plus trop à jour, mais ce site est une belle source de programmes de chafouins, dont un excellent tutoriel pour Nokogiri.</p>

<p>D'ailleurs, nous proposons en mission moussaillon une mission de réalisation d'une ressource intitulée "faisons pas à pas notre premier scrappeur". Nous contacter si elle te branche 😉</p>

<ul>
    <li>Tout d'abord, tu peux jeter un œil à <a href="https://github.com/sparklemotion/nokogiri" target="_blank">la fameuse Gem Nokogiri</a>.</li>
    <li>Ensuite, pour mettre un pied à l'étrier, nous t'invitons à réaliser ton premier parseur avec <a href="http://ruby.bastardsbook.com/chapters/html-parsing/" target="_blank">ce tutoriel pas à pas</a> du Bastards Book of Ruby.</li>
    <li>Après, tu vas découvrir comment utiliser le XPath, une techno puissante compatible avec Nokogiri en suivant la partie <em>Data Extraction</em> de <a href="https://blog.engineyard.com/2010/getting-started-with-nokogiri" target="_blank">ce tutoriel</a>. Aussi, nous t'invitons à regarder <a href="https://www.youtube.com/watch?v=jSiYpmvA50A">cette vidéo YouTube</a> qui indique comment récupérer le XPath à partir de l'inspecteur d'éléments de Chrome.</li>
    <li>On finit par une <a href="https://devhints.io/xpath">cheatsheet sur le XPath</a> pour qu'il n'ait plus de secret pour toi. En effet, rien ne vaut un XPath rédigé par soi-même après avoir jeté un œil au code source HTML de la page.</li>
</ul>

<h3>3.2. Et les tests dans tout ça ?</h3>
<p>Excellente remarque, et nous allons entrer dans une phase plus funky des tests : comment faire pour tester des programmes complexes ? Un scrappeur est important à tester, étant donné qu'il suffit d'une mise à jour du site que tu scrappes et hop plus rien ne marche : les tags HTML ont bougé donc Nokogiri ne pointe plus aux bons endroits. Du coup ton application va planter, ça va faire foirer en cascade toute ta stack technique, ta start-up aura perdu tous ses clients en deux heures, tu vas devoir déposer le bilan, tu ne pourras pas rembourser ta dette, les huissiers vont saisir ta maison, ta moitié partira avec les enfants et tu sombreras dans l'alcool. Moralité : il faut tester régulièrement notre scrappeur.</p>

<p>En plus, la mise en place de tests a une autre valeur ajoutée pour toi : elle te force à te poser des questions fondamentales. <br>Qu'est-ce que mon programme doit envoyer en sortie ? Comment évaluer si cette sortie est acceptable (= s'il fonctionne bien) ?</p>

<h4>3.2.1. Exemple avec le crypto_scrapper</h4>

<p>Prenons l'exemple du premier projet du jour : récupérer la liste des cryptomonnaies.</p>

<ul>
  <li><b>Qu'est-ce que mon programme doit envoyer en sortie ?</b> Ici, le programme est une méthode <code>crypto_scrapper</code> qui prend en entrée rien du tout, et qui sort un array de hash. Pour le tester, tu dois donc a minima t'assurer que la méthode <code>crypto_scrapper</code> retourne bien un array de hash. Si la méthode retourne une erreur ou <code>nil</code>, c'est que le programme ne marche pas. Tout simplement.</li>
  <li><b>Comment évaluer si cette sortie est acceptable (= s'il fonctionne bien) ?</b> Il y a plusieurs techniques.<br> Nous pouvons vérifier la taille de l'array, et la comparer au nombre de cryptomonnaies sur le site : on doit avoir autant d'entrée dans notre array que de crypto sur le site. Mais ce n'est pas très robuste, car il suffit qu'une cryptomonnaie soit rajoutée et tout plante. <br>Une autre technique serait de vérifier au moins une entrée dans l’array. On est rassurés si, dans notre array, il existe un hash qui a <code>BTC</code> en <i>key</i> et un float non nul et non Nil en <i>value</i>. En cas d'absence, c'est que notre scrappeur n'a pas récupéré le Bitcoin (oups), ou s'il n'a pas de float associé, c'est qu'il n'a pas bien récupéré le cours du Bitcoin (oups bis).<br>
    => Au final, une bonne solution pourrait être un mix des deux : vérifier que ton scrappeur récupère <b>au moins</b> x cryptomonnaies (comme ça, t'es pas à une près) et vérifier la présence de 2-3 cryptomonnaies phares (avec un cours non Nil et non nul).</li>
</ul>

<p>Si ta méthode <code>crypto_scrapper</code> répond bien à ceci, c'est que, a priori, tout va bien.</p>

<h4>3.2.2. Les limites du Test Driven Development (TDD)</h4>
<p>Et là, tu vas commencer à voir les limites de la TDD : difficile d'écrire les tests en amont quand on a aucune idée de la tronche de son futur programme. J'imagine que ta tête doit déjà un peu bouillonner avec toutes ces nouvelles infos sur Nokogiri… et si on ajoute une couche de TDD en plus c'est un peu l'enfer.</p>

<p>Ne t'en fais pas, avec l'expérience cela viendra naturellement. Cependant, pour cette journée, tu as l'autorisation de faire les tests APRES avoir fait ton programme. Si tu es à l'aise avec la philosophie de la TDD, tu peux les faire avant. </p>


<h2>4. Points importants à retenir</h2>
<p>Nokogiri un est outil incontournable quand on veut scrapper en Ruby. Il permet de lire des pages HTML et en récupérer les informations que tu souhaites.</p>
<p>Pour utiliser Nokogiri, les lignes de code de base sont :</p>
<ul>
  <li>Rajouter Nokogiri à ton Gemfile avec <code>gem 'nokogiri</code> et y faire appel dans ton app avec <code>require 'nokogiri</code></li>
  <li>Faire de même avec Open-URI, indispensable pour ouvrir une URL, avec <code>require 'open-uri'</code></li>
  <li>Ouvrir l'URL souhaitée sous Nokogiri et le stocker dans un objet <code>page</code> avec <code>page = Nokogiri::HTML(open("ton_url_a_scrapper.com"))</code></li>
  <li>Extraire les éléments HTML que tu veux scrapper en utilisant leur XPath et en les stockant dans un array (par exemple <code>all_emails_links</code>) avec <code> all_emails_links = page.xpath('/mettre_ici_le_XPath')</code>. Dans ce cas <code>all_emails_links</code> est un array d'éléments HTML.</li>
  <li>Des exemples de XPath? <a href="https://www.youtube.com/watch?v=jSiYpmvA50A">Chrome peut te les donner facilement</a> mais ça n'est pas toujours très ciblé. Le mieux c'est d'analyser le code source toi-même et d'écrire tes XPath. Exemples : <br>
    <ul>
      <li>Si tu veux récupérer tous les liens d'une page, tape <code>page.xpath('//a')</code>. Pour tous les titres h1, utilise <code>page.xpath('//h1')</code></li>
      <li>Si tu veux récupérer les liens situés sous un titre h1 (même s'ils sont inclus dans un paragraphe, lui-même imbriqué dans une div), tape <code>page.xpath('//h1//a')</code>.</li>
      <li>Si tu veux récupérer les liens situés DIRECTEMENT sous un titre h1 (sans élément intermédiaire), tape <code>page.xpath('//h1/a')</code>.</li>
      <li>Si tu veux récupérer TOUS les éléments HTML situés DIRECTEMENT sous un titre h1, tape <code>page.xpath('//h1/*')</code>.</li>
      <li>Si tu veux récupérer le lien ayant l'id <code>email</code> situé sous un titre h1 de classe <code>primary</code>, tape <code>page.xpath('//h1[@class="primary"]/a[@id="email"]')</code>.</li>
      <li>Si tu veux récupérer tous les liens dont le href contient le mot "mailto", tape <code>page.xpath('//a[contains(@href, "mailto")]')</code>.</li>
    </ul>
  </li>

  <li>Ensuite, tu veux récupérer le texte de chaque lien ? Il faut parcourir l'array et extraire le <code>.text</code> de chaque élément HTML <br>
    <pre><code class="language-ruby">all_emails_links.each do |email_link|
      puts email_link.text #ou n'importe quelle autre opération de ton choix ;)
      end</code></pre></li>
    <li>Tu peux aussi récupérer le texte du href d'un élément HTML avec <code>email_link['href']</code></li>
</ul>

<h2>5. Pour aller plus loin</h2>
<p>Pour faire du scrapping, tu as d'autres choix que Nokogiri, par exemple :</p>
<ul>
  <li>La gem <a href="https://github.com/sparklemotion/mechanize" target="_blank">mechanize</a> permet d'interagir avec un HTML, notamment en envoyant des requêtes qui permettent de soumettre un formulaire.</li>
  <li>La gem Watir (que l'on verra plus tard) qui permet de simuler un explorateur internet et d'interagir avec ce dernier. Ultra stylé et super pratique quand le scrapping nécessite d'exécuter le JavaScript d'un site web.</li>
</ul>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>


  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #FF4081 " >
          <h1>Projet : Le scrappeur fou</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          
<h2>1. Introduction</h2>
<p>Aujourd'hui, tu vas automatiser la récupération massive de données issus de sites internet (= tu vas scraper). Tes compétences en en Ruby et en HTML vont te permettre de récupérer ces informations en moins d'une journée. Tu t'amuseras avec le cours des cryptomonnaies, tu iras récupérer les e-mails des mairies de notre beau pays, puis tu chopperas la liste des e-mails des députés de France. Tu ne te penses pas capable de tout ça ? Et bien tu vas voir que si.</p>

<p>Les standards habituels seront attendus : un dossier bien rangé, de beaux README et Gemfile, des tests qui vérifient que tout fonctionne.</p>

<h2>2. Le projet</h2>
<h3>2.1. Initialize</h3>
<p>Commence par créer une structure de dossier propre avec le dossier lib, le dossier spec, etc. Créé un Gemfile, un README et fais ton <code>$ git init</code>. Maintenant on peut commencer à travailler 😘</p>


<h3>2.2. Dark Trader</h3>
<p>Lehman Brothers, impressionnés par ton algorithme d'optimisation d'achat / vente, veut encore faire appel à toi. Leur Chief Digital Officer, très hype, a entendu parler au JT de TF1 d'un "<i>truc révolutionnaire qui s'appelle le bloque-chienne</i>". Il veut en acheter plein. Pour le conseiller, tu vas devoir récupérer le cours de toutes les cryptomonnaies du marché.</p>

<p>En prenant pour source le site <a href="https://coinmarketcap.com/all/views/all/" target="_blank">CoinMarketCap</a>, fait un programme qui récupère le cours de toutes les cryptomonnaies et les enregistre bien proprement dans un array de hashs. <br> Ton array devra avoir le format suivant :</p>

<pre><code class="language-ruby">a = [
  { "BTC" => 5245.12 },
  { "ETH" => 217.34 }, 
  etc
]</code></pre>


<p>Pour les tests, inspire-toi de la ressource plus haut. Il n'y a pas besoin de faire 36 000 tests, il faut juste arriver à tester 1) le fonctionnement de base de ton programme (pas d'erreur ni de retour vide) et 2) que ton programme sort bien un array cohérent (vérifier la présence de 2-3 cryptomonnaies, vérifier que l’array est de taille cohérente, etc.).</p>

<p>Quelques petites aides pour ce premier exercice :</p>
<ul>
  <li>Il est possible de faire le programme en n'allant que sur une seule URL. C'est un bon moyen pour faire un programme rapide car ne chargeant pas 2000 pages HTML.</li>
  <li>Tout se jouera sur la rédaction d'un XPath pertinent et précis qui extrait juste ce qu'il faut d'éléments HTML. Puis un bon traitement de ces éléments pour en extraire les 2 infos dont tu as besoin : le nom des crypto et leur cours.</li>
  <li>Un programme qui scrappe sans rien te dire, c'est non seulement nul mais en plus, tu ne sais pas s'il marche, s'il tourne en boucle ou s’il attend que ton wifi fonctionne. <b>Mets des <code>puts</code> dans ton code pour que ton terminal affiche quelque chose à chaque fois qu'il a pu récupérer une donnée</b>. Comme ça tu vois ton scrappeur qui fonctionne et avec des mots qui apparaissent tout seul sur ton terminal, tu vas donner l'impression que t'es un hacker. Stylaï.</li>
  <li><b>Pense à bien nommer tes variables pour ne pas te perdre !</b> Par exemple, quand tu as un array, nomme-le <code>crypto_name_array</code> ou à minima mets son nom au pluriel <code>crypto_nameS</code>. Sinon tu vas oublier que c'est un array et tu vas tenter des <code>.text</code> dessus alors qu'il faut bosser avec un <code>.each</code>.</li>
  <li>Rappel: un hash s’initialise avec <code>result = Hash.new</code> et on y stocke des infos avec <code>result['ta_key'] = 'ta_value'</code> </li>
  <li>N'hésite pas à <b>découper ton programme en plusieurs étapes simples et dont le fonctionnement est facile à vérifier</b>. Par exemple : 1) Isoler les éléments HTML qui vont bien, 2) En extraire le texte et mettre ça dans un hash, 3) Réorganiser ce hash dans un array de plusieurs mini-hash comme demandé. <br>Même si ça n'est pas le chemin le plus court, l'essentiel est que chaque petite étape te fasse avancer et qu'à chaque fois tu te dises "ok, étape 1), ça fonctionne nickel - pas de bug. Passons à la suite".</li>
</ul>

<h3>2.3. Mairie christmas</h3>

<p>Le CEO de Get-email Corp a besoin de tes services. Il voudrait toutes les adresses e-mail des mairies du Val d'Oise. Aucun souci pour toi. Va sur <a href="http://annuaire-des-mairies.com/" target="_blank">cet annuaire des mairies</a> et récupère les adresses e-mails des mairies du Val d'Oise. Comme pour l'exercice précédent, tu devras enregistrer les données dans un array de hash suivant ce format :</p>

<pre><code class="language-ruby">a = [
  { "ville_1" => "email_1" },
  { "ville_2" => "email_2" }, 
  etc
]</code></pre>


<p>Décomposons le programme en 2 sous-problème simples:</p>
<ol>
  <li>Tu dois être capable d'obtenir un e-mail de mairie à partir de la page de cette dernière (pas en partant du listing complet des mairies). Fais d'abord une méthode <code>get_townhall_email(townhall_url)</code> qui récupère l’e-mail d'une mairie à partir de l'URL de mairies, par exemple celle de <a href="https://www.annuaire-des-mairies.com/95/avernes.html" target="_blank">Avernes</a>.</li>
  <li>Une fois que tu sais le faire pour une mairie, tu vas vouloir industrialiser et répéter ça sur tout l'annuaire du Val d'Oise. La prochaine étape est de coder une méthode <code>get_townhall_urls</code> qui récupère les URLs de <a href="https://www.annuaire-des-mairies.com/val-d-oise.html">chaque ville du Val d'Oise</a>.</li>
</ol>

<p>Quand tu es assez sûr que chaque méthode marche séparément, tu as juste à imbriquer les deux et à toi la gloire.</p>

<p>Pour les tests, ce sera la même chose que pour l'exercice précédent mais appliqué aux deux méthodes : des tests de fonctionnement de base et des tests de cohérence du résultat.</p>

<h3>2.4. Cher député </h3>
<p>Maintenant, fini de se faire mâcher le travail par tes gentils formateurs de THP. Tu dois récupérer la liste complète des députés de France ainsi que leurs adresses e-mail. Cherche par toi-même le site le plus aisé à scrapper et stocke les informations extraites dans une array de hashs selon ce format (un peu différent des exercices précédents) : </p>

<pre><code class="language-ruby">a = [
  { 
    "first_name" => "Jean",
    "last_name" => "Durant",
    "email" => "jean.durant@assemblée.fr"
  },
  { 
    "first_name" => "Martin",
    "last_name" => "Dupont",
    "email" => "martin.dupont@assemblée.fr"
  },
  etc
]</code></pre>

<p>Pour les tests, nous t'invitons à te poser et t'inspirer des tests précédents. Deux tests suffiront.</p>

<h2>3. Rendu attendu</h2>
<p>Un repo GitHub propre qui contient un fichier de scrapping pour chacun des trois exercices (dans le dossier lib), des tests pour chacun des scrappeurs (dossier spec), un Gemfile et un README qui explique le tout. Pas de surprise.</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>



</div>


  </div>
</div>
    <script src="/packs/dashboard-031178fac0de4f91cbcc.js"></script>
    

    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  </body>
</html>

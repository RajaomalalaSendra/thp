<!DOCTYPE html>
<html class="loading" lang="fr">
  <head>
<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/thp/style/bootstrap.css">
    <title>The hacking project offline</title>
  </head>
  <body class="vertical-layout vertical-menu 2-columns  menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <h1 class="navbar-brand">THE HACKING PROJECT</h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/thp">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/about">About</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>

<div class="container">
    <a type="button" class="btn btn-dark" href="/thp/semaine_1/">Semaine 1</a>
    <a type="button" class="btn btn-dark btn-lg" href="/thp/semaine_2/">Semaine 2</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_3/">Semaine 3</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_4/">Semaine 4</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_5/">Semaine 5</a>  
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      <div class="container">
    <div class="card">
  <div class="card-header">
    <h4 class="text-center"> Programme jour par jour</h4>
  </div>
  <div class="card-body">
    <div class="text-center">
    <a href="/thp/semaine_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-terminal"></i>&nbsp;&nbsp;&nbsp;Lun
      </button>
</a>    <a href="/thp/semaine_2/jour_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-code"></i>&nbsp;&nbsp;&nbsp;Mar
      </button>
</a>    <a href="/thp/semaine_2/jour_3">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-desktop"></i>&nbsp;&nbsp;&nbsp;Mer
      </button>
</a>    <a href="/thp/semaine_2/jour_4">
      <button class="btn btn-secondary btn-outline-dark btn-lg mr-4">
      <i class="fa fa-folder-open"></i>&nbsp;&nbsp;&nbsp;Jeu
      </button>
</a>    <a href="/thp/semaine_2/jour_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-bullhorn"></i>&nbsp;&nbsp;&nbsp;Ven
      </button>
</a>    </div>
  </div>
</div>


<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      
<div class="content-body">
      <h2 class="text-center">L&#39;art du scrapping</h2>
      <h4 class="text-center">D√©couverte de Ruby</h4>
  <div class="row">
     <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
              <i class="ft-calendar icon-opacity info font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
              <span class="d-block mb-1 font-medium-1"></span>
              <h3 class="info mb-0">
                 Jour 24 / 55</h3>
          </div>
        </div>
        <div class="progress progress-sm mt-1 mb-0 box-shadow-2">
            <div class="progress-bar bg-gradient-x-info" role="progressbar" style="width: 43%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="120">
            </div>
        </div>
      </div>
    </div>
  </div>
 </div>


    <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
            <i class="ft-heart icon-opacity danger font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
            <span class="d-block mb-1 font-medium-1">Jokers restant</span>
            <h3 class="danger mb-0">
                3
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="col-xl-3 col-lg-6 col-md-12">
    <div class="card">
        <div class="card-content">
            <div class="card-body">
                <div class="media d-flex">
                    <div class="align-self-top">
                        <a href="/dashboard/assignments?locale=fr">
                           <i class="ft-fast-forward icon-opacity warning font-large-4"></i>
</a>                    </div>
                    <div class="media-body text-right align-self-bottom mt-3">
                        <span class="d-block mb-1 font-medium-1">Missions</span>
                            <div class="badge border-danger danger badge-border">Pas inscrit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div class="row">
        <div class="container">
    <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
        <div class="card-header">
        <h1 >D√©couverte de Ruby
                <i class="fa fa-space-shuttle text-danger"></i>
        </h1>
        
        </div>
        <div class="card-content">
        <div class="card-body">
            <div class="card-text">
            <h2 class="text-center">L&#39;art du scrapping</h2>
            <div class="cd-horizontal-timeline loaded">
                <div class="timeline">
                <div class="events-wrapper">
                    <div class="events" style="width: 1800px;">
                    <ol>
                                <li>
                                    <a style="left:120px;" href="/dashboard/weeks/2/days/1?locale=fr">
                                        Lun
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet √† rendre ce jour-l√†"></i>

</a>                                </li>
                                <li>
                                    <a style="left:240px;" href="/dashboard/weeks/2/days/2?locale=fr">
                                        Mar
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journ√©e l√†" ></i>


</a>                                </li>
                                <li>
                                    <a style="left:360px;" href="/dashboard/weeks/2/days/3?locale=fr">
                                        Mer
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                            <li>
                                <a class="selected" style="left:480px;" data-toggle="tooltip" data-placement="top" title="L&#39;art du scrapping" href="/dashboard/weeks/2/days/4?locale=fr">
                                    Jeu
                                        <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet √† rendre ce jour-l√†"></i>

</a>                                </li>
                                <li>
                                    <a style="left:600px;" href="/dashboard/weeks/2/days/5?locale=fr">
                                        Ven
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journ√©e l√†" ></i>


</a>                                </li>
                    </ol>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
<div>
  </div>

  <!-- Les fameuses corrections qui n'arrivnet que les jours concern√©s -->


    <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Exceptions</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          
<h2>1. Introduction</h2>
<p>Quand ton code n'est pas bon, Ruby va g√©n√©ralement planter et te sortir un truc merveilleux du genre¬†: </p>

<pre><code class="language-bash">Traceback (most recent call last):
  2: from /home/felix/.rvm/rubies/ruby-2.5.1/bin/irb:11:in `<main>'
  1: from (irb):3
NameError (undefined local variable or method `bonjour' for main:Object)</code></pre>

<p>Ce merveilleux message d'erreur s'accompagne g√©n√©ralement d'un plantage¬†: ton programme s'arr√™te net. Or il arrive parfois que tu n'as pas envie de faire planter le programme quand Ruby rencontre une erreur. Nous allons voir les exceptions, qui permettent d'ignorer les erreurs.</p>

<h2>2. Historique</h2>
<p>Un Syst√®me de Gestion d'Exceptions permet de g√©rer les erreurs, car il arrive que certaines erreurs ne soient pas des bugs, mais plut√¥t des cas particuliers (ou conditions exceptionnelles, ou exceptions) dans le d√©roulement normal d'une partie d'un programme.</p>

<p>On en a eu tr√®s rapidement besoin puisque cela a √©t√© cr√©√© vers les ann√©es 60 pour le langage LISP.</p>

<h2>3. La ressource</h2>
<p>Imagine que tu fais un programme qui va scrapper les annuaires des mairies. Tout se passe bien car toutes les pages de l'annuaire sont identiques‚Ä¶ sauf celle de Les Eyzies-de-Tayac-Sireuil, jolie bourgade de Dordogne. Voici le r√©sultat qu'il produira :</p>

<pre><code class="language-ruby">emails = {
  "Bordeaux" => "bordeaux@email.com",
  "Cenon" => "cenon@email.com",
  "Floirac" => "floirac@email.com",
  "Les Eyzies-de-Tayac-Sireuil" => nil,
  etc
}</code></pre>

<p>Si jamais tu fais un deuxi√®me programme pour envoyer des emails, du genre <code>emails.each do {|city, email| send_email(email)}</code>, ton programme va s√ªrement planter en arrivant √† Les Eyzies-de-Tayac-Sireuil car cet √©l√©ment est √©gal √† <code>nil</code>. Quel dommage de faire foirer 10 minutes d'e-mailing intense de toutes les mairies de Nouvelle-Aquitaine pour si peu¬†: il faut juste lui dire de passer √† autre chose s'il rencontre une erreur.</p>


<p>Et bien un syst√®me de gestion d'exceptions √©vitera ceci¬†! On va dire √† notre programme "si jamais tu as une erreur ici, ne plante pas et fais plut√¥t cela".</p>

<p>Voici <a href="https://blog.honeybadger.io/a-beginner-s-guide-to-exceptions-in-ruby/" target="_blank">une tr√®s bonne introduction au sujet</a>. Pas besoin de tout lire (sauf si tu es curieux du sujet), les parties suivantes suffiront :</p>

<ul>
  <li>What's an exception?</li>
  <li>Exception Objects</li>
  <li>Rescuing All Exceptions (the bad way)</li>
  <li>Rescuing All Errors (The Right Way)</li>
</ul>

<h2>4. Points importants √† retenir</h2>
<p>Des fois quand ton code va sortir une erreur, tu peux lui dire, "hey ne plante pas, et √† la place fais plut√¥t ceci". Voici les lignes pour faire ceci en Ruby :</p>

<pre><code class="language-ruby">begin
  do_something() #partie de code qui risque de produire une erreur
rescue => e
  puts "Oups petite erreur, mais c'est pas grave" #r√©sultat que tu veux voir en lieu et place d'une erreur terminal
end</code></pre>


<h2>5. Pour aller plus loin</h2>
<p>Tu peux aller au bout de <a href="https://blog.honeybadger.io/a-beginner-s-guide-to-exceptions-in-ruby/" target="_blank">l'article √† ce sujet</a> (d√©j√† propos√© plus haut).</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Nokogiri</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>"En informatique tout est possible". Aujourd'hui, nous allons poursuivre dans le monde des bots en te pr√©sentant la gem Nokogiri, un incontournable du scrapping en Ruby. Cette super gem va te permettre de r√©cup√©rer le code source d'une page HTML √† partir de son URL et d'en extraire les informations avec lesquelles tu veux jouer. </p>
<p>En r√©sum√©¬†: tu donnes une URL √† Nokogiri, elle peut l'analyser et ensuite extraire les √©l√©ments HTML de la page. Par exemple, tu peux lui dire "hey r√©cup√®re le <i>table</i> avec l'id <code>list-of-emails</code> puis passe sur chacune de ses lignes pour me r√©cup√©rer le texte de la troisi√®me colonne". Tu stockes tout √ßa dans un hash et hop¬†: t'as scrapp√© tous les e-mails d'un tableau de site web. Nous allons t'apprendre √† t'en servir¬†: Yallah¬†!</p>

<h2>2. Historique</h2>
<p>Depuis que les documents HTML existent, des gens se sont dits que ce serait bien de pouvoir lire le HTML dans un format plus lisible que <code>$ curl www.thehackingproject.org</code> (tape √ßa dans ton terminal pour voir). On a donc cr√©√© des biblioth√®ques pour aider les d√©veloppeurs √† coder des robots pour ce genre de t√¢che¬†: Nokogiri est LE parseur HTML de r√©f√©rence pour Ruby.</p>

<h2>3. La ressource</h2>
<h3>3.1. Introduction √† Nokogiri</h3>
<p>Pour cette ressource, nous allons te donner le lien d'un tutoriel tr√®s pratique pour apprendre √† parser¬†: celui du fameux <a href="http://ruby.bastardsbook.com/" target="_blank">The Bastards Book of Ruby</a>, un super site de Dan Nguyen. Depuis qu'il est admis √† l'√©cole de journalisme de Stanford, Dan ne le tient plus trop √† jour, mais ce site est une belle source de programmes de chafouins, dont un excellent tutoriel pour Nokogiri.</p>

<p>D'ailleurs, nous proposons en mission moussaillon une mission de r√©alisation d'une ressource intitul√©e "faisons pas √† pas notre premier scrappeur". Nous contacter si elle te branche üòâ</p>

<ul>
    <li>Tout d'abord, tu peux jeter un ≈ìil √† <a href="https://github.com/sparklemotion/nokogiri" target="_blank">la fameuse Gem Nokogiri</a>.</li>
    <li>Ensuite, pour mettre un pied √† l'√©trier, nous t'invitons √† r√©aliser ton premier parseur avec <a href="http://ruby.bastardsbook.com/chapters/html-parsing/" target="_blank">ce tutoriel pas √† pas</a> du Bastards Book of Ruby.</li>
    <li>Apr√®s, tu vas d√©couvrir comment utiliser le XPath, une techno puissante compatible avec Nokogiri en suivant la partie <em>Data Extraction</em> de <a href="https://blog.engineyard.com/2010/getting-started-with-nokogiri" target="_blank">ce tutoriel</a>. Aussi, nous t'invitons √† regarder <a href="https://www.youtube.com/watch?v=jSiYpmvA50A">cette vid√©o YouTube</a> qui indique comment r√©cup√©rer le XPath √† partir de l'inspecteur d'√©l√©ments de Chrome.</li>
    <li>On finit par une <a href="https://devhints.io/xpath">cheatsheet sur le XPath</a> pour qu'il n'ait plus de secret pour toi. En effet, rien ne vaut un XPath r√©dig√© par soi-m√™me apr√®s avoir jet√© un ≈ìil au code source HTML de la page.</li>
</ul>

<h3>3.2. Et les tests dans tout √ßa¬†?</h3>
<p>Excellente remarque, et nous allons entrer dans une phase plus funky des tests¬†: comment faire pour tester des programmes complexes¬†? Un scrappeur est important √† tester, √©tant donn√© qu'il suffit d'une mise √† jour du site que tu scrappes et hop plus rien ne marche¬†: les tags HTML ont boug√© donc Nokogiri ne pointe plus aux bons endroits. Du coup ton application va planter, √ßa va faire foirer en cascade toute ta stack technique, ta start-up aura perdu tous ses clients en deux heures, tu vas devoir d√©poser le bilan, tu ne pourras pas rembourser ta dette, les huissiers vont saisir ta maison, ta moiti√© partira avec les enfants et tu sombreras dans l'alcool. Moralit√©¬†: il faut tester r√©guli√®rement notre scrappeur.</p>

<p>En plus, la mise en place de tests a une autre valeur ajout√©e pour toi¬†: elle te force √† te poser des questions fondamentales. <br>Qu'est-ce que mon programme doit envoyer en sortie¬†? Comment √©valuer si cette sortie est acceptable (= s'il fonctionne bien)¬†?</p>

<h4>3.2.1. Exemple avec le crypto_scrapper</h4>

<p>Prenons l'exemple du premier projet du jour¬†: r√©cup√©rer la liste des cryptomonnaies.</p>

<ul>
  <li><b>Qu'est-ce que mon programme doit envoyer en sortie¬†?</b> Ici, le programme est une m√©thode <code>crypto_scrapper</code> qui prend en entr√©e rien du tout, et qui sort un array de hash. Pour le tester, tu dois donc a minima t'assurer que la m√©thode <code>crypto_scrapper</code> retourne bien un array de hash. Si la m√©thode retourne une erreur ou <code>nil</code>, c'est que le programme ne marche pas. Tout simplement.</li>
  <li><b>Comment √©valuer si cette sortie est acceptable (= s'il fonctionne bien)¬†?</b> Il y a plusieurs techniques.<br> Nous pouvons v√©rifier la taille de l'array, et la comparer au nombre de cryptomonnaies sur le site¬†: on doit avoir autant d'entr√©e dans notre array que de crypto sur le site. Mais ce n'est pas tr√®s robuste, car il suffit qu'une cryptomonnaie soit rajout√©e et tout plante. <br>Une autre technique serait de v√©rifier au moins une entr√©e dans l‚Äôarray. On est rassur√©s si, dans notre array, il existe un hash qui a <code>BTC</code> en <i>key</i> et un float non nul et non Nil en <i>value</i>. En cas d'absence, c'est que notre scrappeur n'a pas r√©cup√©r√© le Bitcoin (oups), ou s'il n'a pas de float associ√©, c'est qu'il n'a pas bien r√©cup√©r√© le cours du Bitcoin (oups bis).<br>
    => Au final, une bonne solution pourrait √™tre un mix des deux¬†: v√©rifier que ton scrappeur r√©cup√®re <b>au moins</b> x cryptomonnaies (comme √ßa, t'es pas √† une pr√®s) et v√©rifier la pr√©sence de 2-3 cryptomonnaies phares (avec un cours non Nil et non nul).</li>
</ul>

<p>Si ta m√©thode <code>crypto_scrapper</code> r√©pond bien √† ceci, c'est que, a priori, tout va bien.</p>

<h4>3.2.2. Les limites du Test Driven Development (TDD)</h4>
<p>Et l√†, tu vas commencer √† voir les limites de la TDD¬†: difficile d'√©crire les tests en amont quand on a aucune id√©e de la tronche de son futur programme. J'imagine que ta t√™te doit d√©j√† un peu bouillonner avec toutes ces nouvelles infos sur Nokogiri‚Ä¶ et si on ajoute une couche de TDD en plus c'est un peu l'enfer.</p>

<p>Ne t'en fais pas, avec l'exp√©rience cela viendra naturellement. Cependant, pour cette journ√©e, tu as l'autorisation de faire les tests APRES avoir fait ton programme. Si tu es √† l'aise avec la philosophie de la TDD, tu peux les faire avant. </p>


<h2>4. Points importants √† retenir</h2>
<p>Nokogiri un est outil incontournable quand on veut scrapper en Ruby. Il permet de lire des pages HTML et en r√©cup√©rer les informations que tu souhaites.</p>
<p>Pour utiliser Nokogiri, les lignes de code de base sont :</p>
<ul>
  <li>Rajouter Nokogiri √† ton Gemfile avec <code>gem 'nokogiri</code> et y faire appel dans ton app avec <code>require 'nokogiri</code></li>
  <li>Faire de m√™me avec Open-URI, indispensable pour ouvrir une URL, avec <code>require 'open-uri'</code></li>
  <li>Ouvrir l'URL souhait√©e sous Nokogiri et le stocker dans un objet <code>page</code> avec <code>page = Nokogiri::HTML(open("ton_url_a_scrapper.com"))</code></li>
  <li>Extraire les √©l√©ments HTML que tu veux scrapper en utilisant leur XPath et en les stockant dans un array (par exemple <code>all_emails_links</code>) avec <code> all_emails_links = page.xpath('/mettre_ici_le_XPath')</code>. Dans ce cas <code>all_emails_links</code> est un array d'√©l√©ments HTML.</li>
  <li>Des exemples de XPath? <a href="https://www.youtube.com/watch?v=jSiYpmvA50A">Chrome peut te les donner facilement</a> mais √ßa n'est pas toujours tr√®s cibl√©. Le mieux c'est d'analyser le code source toi-m√™me et d'√©crire tes XPath. Exemples¬†: <br>
    <ul>
      <li>Si tu veux r√©cup√©rer tous les liens d'une page, tape <code>page.xpath('//a')</code>. Pour tous les titres h1, utilise <code>page.xpath('//h1')</code></li>
      <li>Si tu veux r√©cup√©rer les liens situ√©s sous un titre h1 (m√™me s'ils sont inclus dans un paragraphe, lui-m√™me imbriqu√© dans une div), tape <code>page.xpath('//h1//a')</code>.</li>
      <li>Si tu veux r√©cup√©rer les liens situ√©s DIRECTEMENT sous un titre h1 (sans √©l√©ment interm√©diaire), tape <code>page.xpath('//h1/a')</code>.</li>
      <li>Si tu veux r√©cup√©rer TOUS les √©l√©ments HTML situ√©s DIRECTEMENT sous un titre h1, tape <code>page.xpath('//h1/*')</code>.</li>
      <li>Si tu veux r√©cup√©rer le lien ayant l'id <code>email</code> situ√© sous un titre h1 de classe <code>primary</code>, tape <code>page.xpath('//h1[@class="primary"]/a[@id="email"]')</code>.</li>
      <li>Si tu veux r√©cup√©rer tous les liens dont le href contient le mot "mailto", tape <code>page.xpath('//a[contains(@href, "mailto")]')</code>.</li>
    </ul>
  </li>

  <li>Ensuite, tu veux r√©cup√©rer le texte de chaque lien¬†? Il faut parcourir l'array et extraire le <code>.text</code> de chaque √©l√©ment HTML <br>
    <pre><code class="language-ruby">all_emails_links.each do |email_link|
      puts email_link.text #ou n'importe quelle autre op√©ration de ton choix¬†;)
      end</code></pre></li>
    <li>Tu peux aussi r√©cup√©rer le texte du href d'un √©l√©ment HTML avec <code>email_link['href']</code></li>
</ul>

<h2>5. Pour aller plus loin</h2>
<p>Pour faire du scrapping, tu as d'autres choix que Nokogiri, par exemple :</p>
<ul>
  <li>La gem <a href="https://github.com/sparklemotion/mechanize" target="_blank">mechanize</a> permet d'interagir avec un HTML, notamment en envoyant des requ√™tes qui permettent de soumettre un formulaire.</li>
  <li>La gem Watir (que l'on verra plus tard) qui permet de simuler un explorateur internet et d'interagir avec ce dernier. Ultra styl√© et super pratique quand le scrapping n√©cessite d'ex√©cuter le JavaScript d'un site web.</li>
</ul>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>


  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #FF4081 " >
          <h1>Projet : Le scrappeur fou</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          
<h2>1. Introduction</h2>
<p>Aujourd'hui, tu vas automatiser la r√©cup√©ration massive de donn√©es issus de sites internet (= tu vas scraper). Tes comp√©tences en en Ruby et en HTML vont te permettre de r√©cup√©rer ces informations en moins d'une journ√©e. Tu t'amuseras avec le cours des cryptomonnaies, tu iras r√©cup√©rer les e-mails des mairies de notre beau pays, puis tu chopperas la liste des e-mails des d√©put√©s de France. Tu ne te penses pas capable de tout √ßa¬†? Et bien tu vas voir que si.</p>

<p>Les standards habituels seront attendus¬†: un dossier bien rang√©, de beaux README et Gemfile, des tests qui v√©rifient que tout fonctionne.</p>

<h2>2. Le projet</h2>
<h3>2.1. Initialize</h3>
<p>Commence par cr√©er une structure de dossier propre avec le dossier lib, le dossier spec, etc. Cr√©√© un Gemfile, un README et fais ton <code>$ git init</code>. Maintenant on peut commencer √† travailler üòò</p>


<h3>2.2. Dark Trader</h3>
<p>Lehman Brothers, impressionn√©s par ton algorithme d'optimisation d'achat / vente, veut encore faire appel √† toi. Leur Chief Digital Officer, tr√®s hype, a entendu parler au JT de TF1 d'un "<i>truc r√©volutionnaire qui s'appelle le bloque-chienne</i>". Il veut en acheter plein. Pour le conseiller, tu vas devoir r√©cup√©rer le cours de toutes les cryptomonnaies du march√©.</p>

<p>En prenant pour source le site <a href="https://coinmarketcap.com/all/views/all/" target="_blank">CoinMarketCap</a>, fait un programme qui r√©cup√®re le cours de toutes les cryptomonnaies et les enregistre bien proprement dans un array de hashs. <br> Ton array devra avoir le format suivant :</p>

<pre><code class="language-ruby">a = [
  { "BTC" => 5245.12 },
  { "ETH" => 217.34 }, 
  etc
]</code></pre>


<p>Pour les tests, inspire-toi de la ressource plus haut. Il n'y a pas besoin de faire 36¬†000 tests, il faut juste arriver √† tester 1) le fonctionnement de base de ton programme (pas d'erreur ni de retour vide) et 2) que ton programme sort bien un array coh√©rent (v√©rifier la pr√©sence de 2-3 cryptomonnaies, v√©rifier que l‚Äôarray est de taille coh√©rente, etc.).</p>

<p>Quelques petites aides pour ce premier exercice :</p>
<ul>
  <li>Il est possible de faire le programme en n'allant que sur une seule URL. C'est un bon moyen pour faire un programme rapide car ne chargeant pas 2000 pages HTML.</li>
  <li>Tout se jouera sur la r√©daction d'un XPath pertinent et pr√©cis qui extrait juste ce qu'il faut d'√©l√©ments HTML. Puis un bon traitement de ces √©l√©ments pour en extraire les 2 infos dont tu as besoin¬†: le nom des crypto et leur cours.</li>
  <li>Un programme qui scrappe sans rien te dire, c'est non seulement nul mais en plus, tu ne sais pas s'il marche, s'il tourne en boucle ou s‚Äôil attend que ton wifi fonctionne. <b>Mets des <code>puts</code> dans ton code pour que ton terminal affiche quelque chose √† chaque fois qu'il a pu r√©cup√©rer une donn√©e</b>. Comme √ßa tu vois ton scrappeur qui fonctionne et avec des mots qui apparaissent tout seul sur ton terminal, tu vas donner l'impression que t'es un hacker. Styla√Ø.</li>
  <li><b>Pense √† bien nommer tes variables pour ne pas te perdre¬†!</b> Par exemple, quand tu as un array, nomme-le <code>crypto_name_array</code> ou √† minima mets son nom au pluriel <code>crypto_nameS</code>. Sinon tu vas oublier que c'est un array et tu vas tenter des <code>.text</code> dessus alors qu'il faut bosser avec un <code>.each</code>.</li>
  <li>Rappel: un hash s‚Äôinitialise avec <code>result = Hash.new</code> et on y stocke des infos avec <code>result['ta_key'] = 'ta_value'</code> </li>
  <li>N'h√©site pas √† <b>d√©couper ton programme en plusieurs √©tapes simples et dont le fonctionnement est facile √† v√©rifier</b>. Par exemple¬†: 1) Isoler les √©l√©ments HTML qui vont bien, 2) En extraire le texte et mettre √ßa dans un hash, 3) R√©organiser ce hash dans un array de plusieurs mini-hash comme demand√©. <br>M√™me si √ßa n'est pas le chemin le plus court, l'essentiel est que chaque petite √©tape te fasse avancer et qu'√† chaque fois tu te dises "ok, √©tape 1), √ßa fonctionne nickel - pas de bug. Passons √† la suite".</li>
</ul>

<h3>2.3. Mairie christmas</h3>

<p>Le CEO de Get-email Corp a besoin de tes services. Il voudrait toutes les adresses e-mail des mairies du Val d'Oise. Aucun souci pour toi. Va sur <a href="http://annuaire-des-mairies.com/" target="_blank">cet annuaire des mairies</a> et r√©cup√®re les adresses e-mails des mairies du Val d'Oise. Comme pour l'exercice pr√©c√©dent, tu devras enregistrer les donn√©es dans un array de hash suivant ce format :</p>

<pre><code class="language-ruby">a = [
  { "ville_1" => "email_1" },
  { "ville_2" => "email_2" }, 
  etc
]</code></pre>


<p>D√©composons le programme en 2 sous-probl√®me simples:</p>
<ol>
  <li>Tu dois √™tre capable d'obtenir un e-mail de mairie √† partir de la page de cette derni√®re (pas en partant du listing complet des mairies). Fais d'abord une m√©thode <code>get_townhall_email(townhall_url)</code> qui r√©cup√®re l‚Äôe-mail d'une mairie √† partir de l'URL de mairies, par exemple celle de <a href="https://www.annuaire-des-mairies.com/95/avernes.html" target="_blank">Avernes</a>.</li>
  <li>Une fois que tu sais le faire pour une mairie, tu vas vouloir industrialiser et r√©p√©ter √ßa sur tout l'annuaire du Val d'Oise. La prochaine √©tape est de coder une m√©thode <code>get_townhall_urls</code> qui r√©cup√®re les URLs de <a href="https://www.annuaire-des-mairies.com/val-d-oise.html">chaque ville du Val d'Oise</a>.</li>
</ol>

<p>Quand tu es assez s√ªr que chaque m√©thode marche s√©par√©ment, tu as juste √† imbriquer les deux et √† toi la gloire.</p>

<p>Pour les tests, ce sera la m√™me chose que pour l'exercice pr√©c√©dent mais appliqu√© aux deux m√©thodes¬†: des tests de fonctionnement de base et des tests de coh√©rence du r√©sultat.</p>

<h3>2.4. Cher d√©put√© </h3>
<p>Maintenant, fini de se faire m√¢cher le travail par tes gentils formateurs de THP. Tu dois r√©cup√©rer la liste compl√®te des d√©put√©s de France ainsi que leurs adresses e-mail. Cherche par toi-m√™me le site le plus ais√© √† scrapper et stocke les informations extraites dans une array de hashs selon ce format (un peu diff√©rent des exercices pr√©c√©dents)¬†: </p>

<pre><code class="language-ruby">a = [
  { 
    "first_name" => "Jean",
    "last_name" => "Durant",
    "email" => "jean.durant@assembl√©e.fr"
  },
  { 
    "first_name" => "Martin",
    "last_name" => "Dupont",
    "email" => "martin.dupont@assembl√©e.fr"
  },
  etc
]</code></pre>

<p>Pour les tests, nous t'invitons √† te poser et t'inspirer des tests pr√©c√©dents. Deux tests suffiront.</p>

<h2>3. Rendu attendu</h2>
<p>Un repo GitHub propre qui contient un fichier de scrapping pour chacun des trois exercices (dans le dossier lib), des tests pour chacun des scrappeurs (dossier spec), un Gemfile et un README qui explique le tout. Pas de surprise.</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>



</div>


  </div>
</div>
    <script src="/packs/dashboard-031178fac0de4f91cbcc.js"></script>
    

    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  </body>
</html>

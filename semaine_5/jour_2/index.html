<!DOCTYPE html>
<html class="loading" lang="fr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../../style/bootstrap.css">
    <title>The hacking project offline</title>
  </head>
  <body class="vertical-layout vertical-menu 2-columns  menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <h1 class="navbar-brand">THE HACKING PROJECT</h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="../../">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../about">About</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>

<div class="container">
    <a type="button" class="btn btn-dark " href="../../semaine_1/">Semaine 1</a>
    <a type="button" class="btn btn-dark" href="../../semaine_2/">Semaine 2</a>
    <a type="button" class="btn btn-dark" href="../../semaine_3/">Semaine 3</a>
    <a type="button" class="btn btn-dark" href="../../semaine_4/">Semaine 4</a>
    <a type="button" class="btn btn-dark btn-lg" href="../../semaine_5/">Semaine 5</a> 
    <a type="button" class="btn btn-dark" href="../../semaine_6/">Semaine 6</a>
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      <div class="container">
    <div class="card">
  <div class="card-header">
    <h4 class="text-center"> Programme jour par jour</h4>
  </div>
  <div class="card-body">
    <div class="text-center">
    <a href="../../semaine_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-terminal"></i>&nbsp;&nbsp;&nbsp;Lun
      </button>
</a>    <a href="../../semaine_5/jour_2">
      <button class="btn btn-secondary btn-outline-dark btn-lg mr-4">
        <i class="fa fa-code"></i>&nbsp;&nbsp;&nbsp;Mar
      </button>
</a>    <a href="../../semaine_5/jour_3">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-desktop"></i>&nbsp;&nbsp;&nbsp;Mer
      </button>
</a>    <a href="../../semaine_5/jour_4">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-folder-open"></i>&nbsp;&nbsp;&nbsp;Jeu
      </button>
</a>    <a href="../../semaine_5/jour_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-bullhorn"></i>&nbsp;&nbsp;&nbsp;Ven
      </button>
</a>    </div>
  </div>
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      
<div class="content-body">
      <h2 class="text-center">Mettre son site en ligne üöÄ et formulaire</h2>
      <h4 class="text-center">Rails interm√©diaire</h4>
  <div class="row">
     <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
              <i class="ft-calendar icon-opacity info font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
              <span class="d-block mb-1 font-medium-1"></span>
              <h3 class="info mb-0">
                 Jour 24 / 55</h3>
          </div>
        </div>
        <div class="progress progress-sm mt-1 mb-0 box-shadow-2">
            <div class="progress-bar bg-gradient-x-info" role="progressbar" style="width: 43%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="120">
            </div>
        </div>
      </div>
    </div>
  </div>
 </div>


    <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
            <i class="ft-heart icon-opacity danger font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
            <span class="d-block mb-1 font-medium-1">Jokers restant</span>
            <h3 class="danger mb-0">
                3
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="col-xl-3 col-lg-6 col-md-12">
    <div class="card">
        <div class="card-content">
            <div class="card-body">
                <div class="media d-flex">
                    <div class="align-self-top">
                        <a href="/dashboard/assignments?locale=fr">
                           <i class="ft-fast-forward icon-opacity warning font-large-4"></i>
</a>                    </div>
                    <div class="media-body text-right align-self-bottom mt-3">
                        <span class="d-block mb-1 font-medium-1">Missions</span>
                            <div class="badge border-danger danger badge-border">Pas inscrit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div class="row">
        <div class="container">
    <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
        <div class="card-header">
        <h1 >Rails interm√©diaire
                <i class="fa fa-beer text-warning"></i>
        </h1>
        
        </div>
        <div class="card-content">
        <div class="card-body">
            <div class="card-text">
            <h2 class="text-center">Mettre son site en ligne üöÄ et formulaire</h2>
            <div class="cd-horizontal-timeline loaded">
                <div class="timeline">
                <div class="events-wrapper">
                    <div class="events" style="width: 1800px;">
                    <ol>
                                <li>
                                    <a style="left:120px;" href="/dashboard/weeks/5/days/1?locale=fr">
                                        Lun
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet √† rendre ce jour-l√†"></i>

</a>                                </li>
                            <li>
                                <a class="selected" style="left:240px;" data-toggle="tooltip" data-placement="top" title="Mettre son site en ligne üöÄ et formulaire" href="/dashboard/weeks/5/days/2?locale=fr">
                                    Mar
                                        <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journ√©e l√†" ></i>


</a>                                </li>
                                <li>
                                    <a style="left:360px;" href="/dashboard/weeks/5/days/3?locale=fr">
                                        Mer
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                                <li>
                                    <a style="left:480px;" href="/dashboard/weeks/5/days/4?locale=fr">
                                        Jeu
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet √† rendre ce jour-l√†"></i>

</a>                                </li>
                                <li>
                                    <a style="left:600px;" href="/dashboard/weeks/5/days/5?locale=fr">
                                        Ven
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journ√©e l√†" ></i>


</a>                                </li>
                    </ol>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
<div>
  </div>

  <!-- Les fameuses corrections qui n'arrivnet que les jours concern√©s -->


    <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : D√©ployer un site rails en ligne</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Tes applications rails fracassent. Mais avoue que tu aimerais bien les mettre en ligne pour faire profiter la terre enti√®re de tes super projets. Tkt, on a pr√©vu le coup, et on va te pr√©senter un superbe outil pour mettre en ligne tr√®s facilement tes applications : Heroku.</p>

<p>En quelques lignes de commande (et un peu de param√©trage), tu pourras faire profiter √† ta grand-m√®re des sites que tu vas faire. Much üî•</p>

<h2>2. Historique</h2>
<p>Il existe plusieurs fa√ßons de g√©rer des applications. La premi√®re, est celle que tu as vue jusqu'√† pr√©sent : utiliser un service qui s'occupe de tout pour toi. Ce sont les SaaS (Software as a Service). Aujourd'hui nous allons voir la seconde : d√©velopper soi-m√™me ses applications, puis les h√©berger sur une PaaS (Plateform as a Service). Les PaaS s'occupent de pr√©parer tous les serveurs pour toi, et tu as juste √† pousser le code, et elles s'occupent de compiler l'application, et de la faire tourner pour toi.</p>

<p>La derni√®re solution est pour les personnes qui g√®rent en r√©seau : les IaaS (Infrastrucure as a Service). Les IaaS te filent de l'espace serveur, de la bande passante, et √† toi de te d√©merder et de param√©trer tout cela. Nous ne verrons pas comment brancher tes applications rails vers des IaaS car ce n'est pas le but de la formation.</p>


<img src="https://i.imgur.com/4mO87l8.png" class="img-fluid">


<p>Plus tu vas bas dans ce sch√©ma, plus tu as le contr√¥le dans ce que tu fais. Mais aussi plus tu as de param√©trages √† faire. Un peu comme Sinatra et Rails. Dans Sinatra on a plus de contr√¥le, mais il faut tout param√©trer.</p>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üé® EXEMPLE ILLUSTR√â</h4>
      <p class="card-text">Prenons l'exemple d'une entreprise que tu connais bien : The Hacking Project. The Hacking Project d√©veloppe une plateforme o√π les moussaillons peuvent suivre des cours et mettre √† jour leur projets. On peut dire que c'est une SaaS (c'est pas ultra vrai, mais c'est pour l'exemple). The Hacking Project h√©berge son code chez Heroku, qui est une PaaS. THP a juste √† envoyer le code de son application √† Heroku, qui s'occupera de le faire tourner sur sa plateforme de serveurs.</p>
      <p>Enfin, Heroku utilise Amazon Web Services qui est une IaaS. Heroku loue de l'espace serveur √† AWS, dans lequel il va brancher des serveurs sous Linux, qui s'occupent de faire tourner le code que les SaaS leur envoient.</p>
    </div>
  </div>
</div>

<p>Heroku est un service de PaaS qui a √©t√© cr√©√© en 2007. 3 ans apr√®s leur cr√©ation, ils ont √©t√© rachet√©s par SalesForce pour 212M$. C'est l'un des services d'h√©bergement de code les plus populaires. Ils ont un tarif tr√®s sympa : ils te proposent d'h√©berger gratuitement 100 applications, et tu ne paieras que si ton application cartonne et que tu dois pimp tes serveurs (genre 10 balles par mois, ce qui est tr√®s peu cher).</p>

<h2>3. La ressource</h2>
<p>Apprendre √† mettre en production est une sacr√©e √©tape dans la vie de d√©veloppeur web. C'est le moment o√π "√ßa passe ou √ßa casse". Le fameux √©cran d'erreur d'Heroku qui fait des ravages chez les moussaillons te demandera de d√©bugger des choses dans ton app. Mais √† la fin, elle sera en ligne, et c'est ce qui compte. Car, comme dirait notre mentor Guillaume "mais √ßa marchait sur mon ordinateur n'est pas une excuse" : en tant que moussaillon, tu te fous de savoir que le site The Hacking Project marche sur mon ordinateur ; tout le monde veut un site qui marche bien sur thehackingproject.org !</p>

<h3>3.1. Installer Heroku</h3>
<p>C'est assez ultra simple. Tu vas cr√©er un compte Heroku, installer Heroku pour le faire marcher depuis ton terminal, te connecter, et puis c'est tout ! Pour ceci, je t'invite √† suivre <a href="http://installfest.railsbridge.org/installfest/create_a_heroku_account">la partie de l'installation de Heroku</a> sur le RailsBridgeInstallfest, et tu auras install√© Heroku.</p>

<p>‚ö†Ô∏è Attention utilise le m√™me mail que tu as utilis√© pour git, GitHub et SSH ! ‚ö†Ô∏è</p>


<h3>3.2. Mettre en ligne son application sur Heroku</h3>
<p>Heroku a une configuration diff√©rente de ton ordinateur. Pour faire marcher Heroku, il faut juste param√©trer notre application Rails pour qu'elle soit compatible avec le service. Heureusement, c'est juste quelques r√©glages √† faire. Voici une marche √† suivre assez simple pour mettre un site en production.</p>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Pour √©viter les gal√®res en fin de projet "mais heuuuu le site il ne veut pas push sur heroku üò¢", il est recommand√© de TOUJOURS commencer son app par la configuration Heroku, puis de push une premi√®re fois, et de voir si √ßa marche en ligne. Si √ßa marche, tu peux commencer ton site. Si √ßa ne marche pas, fais marcher le truc, et au pire, relance l'app (c'est plus facile quand tu viens √† peine de commencer que quand tu as 36 mod√®les √† g√©rer).</p>
    </div>
  </div>
</div>

<h4>3.2.1. La base de donn√©es</h4>
<h5>3.2.1.1. SQLite3</h5>
<p>L'un des classiques bug quand les gens veulent push sur heroku est la non concordance entre SQLite3 et PG. Quand tu fais <code>$ rails new</code> (sans utiliser Postgre), de base rails te sort une application en SQLite3. Si tu ouvres ton Gemfile, tu pourras retrouver ces lignes l√† :

<pre><code class="language-ruby"># Use sqlite3 as the database for Active Record
gem 'sqlite3'</code></pre>
<p>Ceci veut dire : "pour ma base de donn√©es, utilise SQLite3 stp merci". Puis lignes 36 -> 42 tu auras ceci :</p>

<pre><code class="language-ruby">group :development, :test do
  # Call 'byebug' anywhere in the code to stop execution and get a debugger console
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  # Adds support for Capybara system testing and selenium driver
  gem 'capybara', '~> 2.13'
  gem 'selenium-webdriver'
end</code></pre>

<p>Ceci veut dire : tout ce qui est entre ces lignes seront des gems que j'utilise pour le d√©veloppement et le test. En gros, tout sauf la production. C'est peut √™tre un peu complexe pour le moment, mais sache une chose, cela veut dire que la ligne 12 n'√©tant pas dans un <code>group</code> sp√©cifique, et bien nous disons √† notre application rails "pour ma base de donn√©es, utilise SQLite3 stp merci, en d√©veloppement, en test <b>et en production</b>".</p>

<p>Le soucis est que Heroku n'utilise pas SQLite3 en production, et d√®s que tu mentionneras SQLite3 en production, il t'enverra chier. Il faut donc virer cette ligne 12, puis dire que l'on ne se sert de SQLite3 qu'en d√©veloppement et en test, puis pour la production, on va utiliser l'outil de base de donn√©es de heroku : PostGreSQL. Pour ceci, rien de plus simple : 
Remplace les lignes 8 et 9 :</p>

<pre><code class="language-ruby"># Use sqlite3 as the database for Active Record
gem 'sqlite3'</code></pre>
<p>et remplace la par :</p>
<pre><code class="language-ruby">group :development, :test do
  gem 'sqlite3'
end

group :production do
  gem 'pg', '>= 0.18'
end</code></pre>

<p>Et voil√†. Tu utilises SQLite3 en Developpement, en Test ; et tu utilises PostgreSQL en production. Comme Heroku.</p>

<p>Maintenant que l'on a un gemfile compatible on va installer le bundle : <code>bundle install --without production</code> Pourquoi le <code>--without production</code> ? Parce que sinon le bundle va installer nos gems de production, qui ne nous concernent pas. Il risque de planter si PostGreSQL n'est pas install√© sur ton ordi et le pg du groupe de production fera de la üí©</p>


<h5>3.2.1.2. PostgreSQL</h5>
<p>Si tu es un moussaillon assid√ª et que tu as bien PG de branch√©, et que tes rails new font du <code>rails new -d postgresql</code>, et bien rien √† changer, ton app est pr√™te √† partir chez Heroku (tu peux voir dans ton Gemfile que pg a remplac√© SQLite3).</p>

<h4>3.2.2. git push heroku master</h4>
<p>Une fois que ta base de donn√©es est param√©tr√©e, tu n'as plus qu'√† push ton application sur Heroku.</p>

<h5>3.2.2.1. Cr√©er ton application</h5>
<p>Avant de push, tu vas cr√©er ton application sur Heroku :</p>
<pre><code class="language-bash">$ heroku create</code></pre>
<p>Ce qui aura pour effet de cr√©er une application sur Heroku, et la lier √† ton application</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">De base, ton application aura un nom de genre <code>pacific-turkey-4983849</code>. Mais tu peux la changer en un truc plus sympa (√† condition que ce ne soit pas pris) du genre <code>nom-de-ton-app</code> avec la ligne suivante :</p>
      <pre><code class="language-bash">$ heroku create nom-de-ton-app</code></pre>
      <p>Et tu peux changer le nom de ton app existante avec :</p>
      <pre><code class="language-bash">heroku apps:rename nouveau-nom-de-ton-app</code></pre>
    </div>
  </div>
</div>

<h5>3.2.2.2. Mettre ton app en prod</h5>
<p>Et voil√†, LA partie importante. Avant de faire le push, on va voir un truc ensemble. Fais donc :</p>
<pre><code class="language-bash">$ git remote --v</code></pre>

<p>Il devrait te renvoyer un truc du genre :</p>
<pre><code class="language-bash">heroku https://git.heroku.com/nom-de-ton-app.git (fetch)
heroku  https://git.heroku.com/nom-de-ton-app.git (push)
origin  git@github.com:username/repo.git (fetch)
origin  git@github.com:username/repo.git (push)</code></pre>

<p>Si tu n'es pas trop en gal√®re sur git, tu devrais comprendre qu'en cr√©ant ton application, tu as branch√© une nouvelle remote √† git. En plus de pouvoir push ton joli travail sur Origin (donc GitHub), tu peux le push sur la remote Heroku. Et bien testons cela :</p>

<pre><code class="language-bash">$ git push heroku master</code></pre>

<p>L√† tu devrais avoir un script assez long, qui peut balancer quelques warnings, mais qui √† la fin devrait dire un truc du genre : </p>

<pre><code class="language-bash">remote: -----> Compressing...
remote:        Done: 48M
remote: -----> Launching...
remote:        Released v6
remote:        https://nom-de-ton-app.herokuapp.com/ deployed to Heroku
remote: 
remote: Verifying deploy... done.
To https://git.heroku.com/nom-de-ton-app.git
 * [new branch]      master -> master</code></pre>


<p>Et voil√†, tu as ton application en production sur Heroku. Tu peux aller sur son url et t'amuser avec (√† condition qu'elle ne soit pas vide üòâ)</p>


<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Alerte g√©n√©rale, cette erreur est un grand classique de Heroku. Alloue un bout de cerveau disponible et <b>enregistre cette information</b>.</p>
      <p>Si ton application a une base de donn√©es, et qu'il faut faire une migration, il <b>te faudra dire √† heroku de migrer</b>, apr√®s avoir push. Si tu ne le fais pas, l'application va te p√©ter √† la gueule. Pour ceci, rentre la commande :</p>
      <pre><code class="language-ruby">$ heroku run rails db:migrate</code></pre>
      <p>(C'est comme en local sur ta machine, mais en production).</p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE (bis)</h4>
      <p class="card-text">Celle-l√† tu la verras plus tard, mais sache que pour l'asset pipeline, il faudra aussi rentrer une manip pour √©viter que Heroku t'explose √† la gueule.</p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Si jamais tu tombes sur une erreur, ou bien si tu tombes sur ceci :</p>
      <div class="text-center">
        <img class="img-fluid" src="https://i.imgur.com/e74hIFn.png?1" alt="PaaS">
      </div>
      <br>
      <p>üôèPour l'amour de dieu, utilise Google et ton bon sens, avant de te pr√©cipiter sur #help üôè</p>
    </div>
  </div>
</div>



<h2>4. Points importants √† retenir</h2>
<p>Heroku te permet d'h√©berger ton app sur des serveurs √† eux. Les serveurs font tourner postgresql donc il te faudra changer certains param√®tres en base de donn√©es si tu utilises encore SQLite3.</p>

<p>Voici un petit flow pour push une app sur Heroku :</p>
<pre><code class="language-bash">$ rails new myapp
$ cd myapp
$ heroku create un-nom-trop-cool
#Je change le Gemfile pour la BDD si je suis en SQLite3
$ bundle install
$ git add .
$ git commit -m "First commit and pushing to Heroku"
$ git push heroku master
$ heroku run rails db:migrate #optionnel si tu as une migration √† migrer</code></pre>

<h2>5. Pour aller plus loin</h2>
<p>Pour ceux qui veulent aller plus loin et conna√Ætre les param√©trages, voici comment mettre en ligne un site sur Heroku, version BG. Tout d'abord, <a href="https://devcenter.heroku.com/articles/getting-started-with-rails5" target="_blank">la doc de Heroku</a> fait le pas √† pas pour bien mettre en ligne un site avec Heroku. Tu peux aussi aller sur <a href="https://www.theodinproject.com/courses/ruby-on-rails/lessons/deployment" target="_blank">l'article de la mise en production</a> fait par The Odin Project.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Les conventions REST et CRUD appliqu√©es aux Routes et Controllers</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          
<h2>1. Introduction</h2>
<p>Cette semaine, tu plonges √† fond dans l'univers de Rails et au passage, tu vas cr√©er de nombreuses applications¬†: d'ici 10 jours, tu seras tr√®s √©tonn√© de ce que tu arrives d√©j√† √† produire. Aussi, on va prendre <b>d√®s maintenant les bonnes habitudes en appliquant les conventions et les bonnes pratiques qui feront de toi un VRAI rubyiste et non plus simplement une "personne qui √©crit du Ruby"</b>. √Ä travers cette ressource, je vais t'apprendre √† organiser ton app Rails pour qu'elle soit <i>100¬†% approved by tech</i>¬†: les routes vont suivre les conventions et les controllers auront une structure efficace et standard.</p>

<p>Il ne s'agit pas l√† de faire de toi un puriste par simple envie de se conformer √† la communaut√© Ruby. Les pratiques que je vais te d√©tailler l√† vont te permettre de d√©velopper des applications complexes avec des routes nombreuses, dynamiques et imbriqu√©es, des controllers vari√©s, h√©bergeant chacun moult m√©thodes, des views en-veux-tu-en-voil√†‚Ä¶ Et le tout sans t'y perdre car cela va suivre une construction logique qui aidera tout le monde √† s'y retrouver¬†: toi, comme tes coll√®gues¬†!</p>

<p>Rails est bas√© sur <a href="https://fr.wikipedia.org/wiki/Representational_state_transfer">REST (representational state transfer)</a>, qui est un style d'architecture logicielle tr√®s courant sur le web. En suivant l'archi REST, on va mettre en place des op√©rations de type CRUD. T'y comprends rien¬†? T'inqui√®tes, on va t'expliquer.</p>

<h2>2. Historique</h2>
<p>Le mod√®le REST a √©t√© cr√©√© en 2000 par un certain Roy Fielding, dans sa th√®se d'√©tudiant (la classe non¬†? Il est devenu quoi toi ton dernier m√©moire √©tudiant¬†? ü•¥ ) </p>

<p>Pour simplifier, le REST √©tabli la r√®gle suivante: "en g√©n√©ral, il y a 7 choses que l'on veut faire, sur Internet, quand on manipule une ressource". Une ressource, c'est g√©n√©ralement un √©l√©ment de ta BDD par exemple la ressource potin, de The Gossip Project. Si tu es en mode REST, il y a donc 7 requ√™tes (ou demandes) que l'utilisateur doit pouvoir envoyer √† ton serveur :</p>
<ol>
  <li><b>Afficher toutes les ressources</b> = <code>GET</code> tous les potins (l'<code>index</code> des potins donc)</li>
  <li><b>Afficher une des ressources</b> = <code>GET</code> juste un potin (<code>show</code> ton potin)</li>
  <li><b>Afficher la page de cr√©ation d'une ressource</b> = <code>GET</code> la page avec le formulaire de cr√©ation d'un nouveau potin (un <code>new</code> potin donc)</li>
  <li><b>Envoyer les informations pour cr√©er une ressource</b> = <code>POST</code> les donn√©es du formulaire de cr√©ation du potin (<code>create</code> ton potin)</li>
  <li><b>Afficher la page de modification d'une ressource</b> = <code>GET</code> la page avec le formulaire d'√©dition d'un potin existant (<code>edit</code> ton potin)</li>
  <li><b>Envoyer les informations pour √©diter une ressource</b> = <code>PUT</code> ou <code>PATCH</code> les donn√©es du formulaire de mise √† jour du potin (<code>update</code> ton potin)</li>
  <li><b>Supprimer une ressource</b> = <code>DELETE</code> un potin sp√©cifique (<code>destroy</code> le potin)</li>
</ol>

<p>Et puis c'est tout¬†! √Ä partir de l√† on peut construire plein d'applications web, et si tu y r√©fl√©chi bien, un tas de sites que tu utilises chaque jour sont aussi bas√©s sur le REST (remplace, dans la liste ci-dessus, "potin" par "post Facebook" ou "Story Instagram" ou "Vid√©o Youtube"). Nous allons voir comment impl√©menter √ßa en Rails.</p>

<h2>3. La ressource</h2>
<h3>3.1. √Ä la base de tout : le CRUD</h3>
<p>Plus haut nous avons vu les 7 m√©thodes du REST. Et bien si on r√©fl√©chit, on peut les r√©unir en 4 cat√©gories qui correspondent au fameux CRUD dont on parle depuis des lustres :</p>

<ul>
  <li><b>CREATE</b>¬†: regroupe l'affichage du formulaire de cr√©ation (m√©thode <code>#new</code>) et son traitement + sauvegarde en base de la ressource (m√©thode <code>#create</code>).</li>
  <li><b>READ</b>¬†: regroupe l'affichage d'une ressource pr√©cise (m√©thode <code>#show</code>) et l'affichage de toutes les ressources en base (m√©thode <code>#index</code>).</li>
  <li><b>UPDATE</b>¬†: regroupe l'affichage du formulaire d'√©dition (m√©thode <code>#edit</code>) et son traitement + mise √† jour en base de la ressource (m√©thode <code>#update</code>).</li>
  <li><b>DESTROY</b>¬†: c'est la destruction en base d'une ressource (m√©thode <code>#destroy</code>). C'est la seule cat√©gorie o√π il n'y a qu'une m√©thode.</li>
</ul>

<p>S'il y a une chose √† retenir, c'est que <b>toute route sur Rails correspond √† une requ√™te du REST, et que derri√®re, cette route va pointer vers une action du CRUD, pour la ressource qui la concerne. Cette action s'effectuera au sein d'une m√©thode de controller puis renverra vers une view correspondante.</b> <br>
En d'autres termes, les routes suivent la convention REST (7 requ√™tes possibles) et pointent vers des controllers qui √©tablissent une action du CRUD avec des m√©thodes ayant des noms fix√©s par convention¬†: <code>#new</code>, <code>#create</code>, <code>#show</code>, <code>#index</code>, <code>#edit</code>, <code>#update</code> et <code>#destroy</code>.</p>

<p>OK, pour le moment, tu as du mal √† imaginer que la page "qui montre juste la photo de mon utilisateur" soit une m√©thode de CRUD (ce n'est pas <code>show</code>, puisque cette m√©thode est d√©j√† prise par la page profil ü§î), mais nous allons te donner plein d'exemples plus loin. Avec un peu d'entra√Ænement, "penser REST" te permettra de structurer tes applications avec une facilit√© d√©concertante.</p>

<h3>3.2. Les routes</h3>
<h4>3.2.1. Les routes, √† la main et en d√©tails</h4>
<p>Nous allons continuer avec l'exemple de nos chers potins. <br>
Nous venons donc de t'expliquer que les routes, en Rails, suivent la convention REST qui d√©fini 7 requ√™tes diff√©rentes possibles. Voici donc √† quoi ressembleraient nos routes Rails associ√©es √† la ressource potin (li√©e √† un model <code>Gossip</code> et √† un controller <code>gossips</code> qui g√®re les actions) :</p>
<pre><code class="language-ruby">get "/gossips", to: "gossips#index"
get "/gossips/:id", to: "gossips#show"
get "/gossips/new", to: "gossips#new"
post "/gossips", to: "gossips#create"  # re√ßoit de l'info d'un formulaire donc verbe POST
get "/gossips/:id/edit", to: "gossips#edit"
put "/gossips/:id", to: "gossips#update" # re√ßoit de l'info d'un formulaire donc verbe PUT
delete "/gossips/:id", to: "gossips#destroy" # une requ√™te un peu sp√©ciale pour supprimer donc verbe DELETE</code></pre>

<p>Tout cela sont des conventions en Rails¬†: les URLs ressembleront √† cela, les verbes HTTP leurs seront associ√©s de cette fa√ßon et les m√©thodes de controller seront toujours nomm√©es ainsi.</p>

<p>Comme tu peux le voir, en Rails, REST et CRUD sont donc imbriqu√©s comme ceci :</p>
<ul>
  <li><b>CREATE</b><ul>
    <li>get <code>/gossips/new</code> affichera un formulaire de cr√©ation de potin. Ce formulaire va envoyer un POST √† la route‚Ä¶</li>
    <li>‚Ä¶post <code>/gossips</code> qui ira √† la m√©thode <code>#create</code> de ton controller dont le r√¥le est de sauvegarder le potin en BDD</li>
  </ul></li>
  <li><b>READ</b><ul>
    <li>get <code>/gossips</code> affichera l'index des potins (= liste de tous les potins).</li>
    <li>get <code>/gossips/:id</code> affichera la page de "profil" du potin.</li>
  </ul></li>
  <li><b>UPDATE</b><ul>
    <li>get <code>/gossips/:id/edit</code> affichera un formulaire de mise √† jour de potin. Ce formulaire va envoyer un PUT √† la route‚Ä¶</li>
    <li>‚Ä¶put <code>/gossips/:id</code> qui ira √† la m√©thode <code>#update</code> de ton controlle dont le r√¥le est de modifier ton potin en BDD</li>
  </ul></li>
  <li><b>DESTROY</b><ul>
    <li>delete <code>/gossips/:id</code> aura pour effet de supprimer ton potin en BDD</li>
  </ul></li>
</ul>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ü§ì QUESTION R√âCURRENTE</h4>
      <p class="card-text"><b>Jamy, c'est pas super intuitif, pourquoi le POST de cr√©ation va √† </b><code>/gossips</code><b> et non pas </b><code>/gossips/new</code><b>¬†?</b></p>
      <p>C'est une convention. REST a parfois ses raisons que la raison ignore. Tu sais ce que l'on dit : Convention Over Configuration. Ne t'amuse pas √† changer ces conventions au d√©but, tu te le permettras avec un peu plus de bouteille üçæ </p>
      <p>Mais inutile d'apprendre ces routes par c≈ìur¬†: Rails a des super helper, avec les adresses en path. Tu vas apprendre √† le laisser g√©rer tout √ßa automatiquement. üèù </p>
    </div>
  </div>
</div>

<h4>3.2.2. les routes, automatis√©es √† la sauce Rails Way‚Ñ¢</h4>
<p>Bon, maintenant que je t'ai montr√© comment √©crire les 7 types de routes qui suivent la convention, tu imagines bien que tu vas pas, √† chaque nouvelle ressource ou nouveau controller, te taper de les √©crire √† la mano une √† une¬†! Encore une fois, la puissance de Rails est l√†¬†: il existe un moyen d'automatiser l'√©criture des routes qui suivent la convention. <br>
Pour cela, il suffit d'une seule ligne dans le fichier <code>routes.rb</code> :</p>

<pre><code class="language-ruby">resources :gossips</code></pre>

<p>Une fois cette ligne √©crite, tu peux voir son r√©sultat en faisant un petit <code>$ rails routes</code>¬†: </p>
<pre><code class="language-shell">                   Prefix Verb   URI Pattern                                                                              Controller#Action
                  gossips GET    /gossips(.:format)                                                                       gossips#index
                          POST   /gossips(.:format)                                                                       gossips#create
               new_gossip GET    /gossips/new(.:format)                                                                   gossips#new
              edit_gossip GET    /gossips/:id/edit(.:format)                                                              gossips#edit
                   gossip GET    /gossips/:id(.:format)                                                                   gossips#show
                          PATCH  /gossips/:id(.:format)                                                                   gossips#update
                          PUT    /gossips/:id(.:format)                                                                   gossips#update
                          DELETE /gossips/:id(.:format)                                                                   gossips#destroy</code></pre>

<p>Et BIM. En une ligne dans <code>routes.rb</code>, tu as cr√©√© les 7 routes qui suivent la convention REST en l'appliquant √† la table <code>gossips</code>. üëå</p>


<p>Sache aussi que tu peux imbriquer les routes entre elles et faire ce que l'on appelle des <i>nested resources</i>. Cela permet de g√©rer, par exemple, un CRUD pour des commentaires qui sont li√©s √† un gossip¬†: tu veux pouvoir afficher la liste des commentaires<b> mais seulement ceux li√©s √† un gossip donn√©</b>. Tu veux pouvoir cr√©er un commentaire <b>en le liant √† un gossip donn√©</b>. etc. <br>
Cela n√©cessite, que pour chaque action CRUD sur un commentaire, que l'on sache de quel gossip (auquel le commentaire est li√©) on parle.</p>
<p> Pour faire √ßa, voici ce qu'il faut √©crire :</p>
<pre><code class="language-ruby">resources :gossips do
  resources :comments
end</code></pre>

<p>Et voil√† ce que cela ajoute dans <code>$ rails routes</code> :</p>
<pre><code class="language-shell">                   Prefix Verb   URI Pattern                                                                              Controller#Action
                          GET    /message/:user_entry(.:format)                                                           message#show
          gossip_comments GET    /gossips/:gossip_id/comments(.:format)                                                   comments#index
                          POST   /gossips/:gossip_id/comments(.:format)                                                   comments#create
       new_gossip_comment GET    /gossips/:gossip_id/comments/new(.:format)                                               comments#new
      edit_gossip_comment GET    /gossips/:gossip_id/comments/:id/edit(.:format)                                          comments#edit
           gossip_comment GET    /gossips/:gossip_id/comments/:id(.:format)                                               comments#show
                          PATCH  /gossips/:gossip_id/comments/:id(.:format)                                               comments#update
                          PUT    /gossips/:gossip_id/comments/:id(.:format)                                               comments#update
                          DELETE /gossips/:gossip_id/comments/:id(.:format)                                               comments#destroy
</code></pre>
<p>Tu remarques alors que les URL commencent toutes par <code>/gossips/:gossip_id/</code> pour d√©finir le gossip sur lequel on travaille (identifi√© par l'id qu'on stocke dans la variable d'URL <code>:gossip_id</code>). Le reste de l'URL suit la convention¬†: la variable <code>:id</code>, quand elle appara√Æt comme dans <code>/gossips/:gossip_id/comments/:id/edit</code>, correspond alors √† l'id du commentaire dans la table <code>comments</code>. <br>
Tu noteras ensuite que chaque route pointe vers le controller <code>comments</code> avec les m√©thodes conventionnelles (<code>create</code>, <code>new</code>, <code>destroy</code>, etc.).</p>



<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Par d√©faut, <code>resources</code> va cr√©er les 7 routes vers les 7 m√©thodes du CRUD. Or, parfois, tu n'auras pas besoin de toutes ces routes. Par exemple¬†: les commentaires de potins, tu veux pouvoir les cr√©er, mais tu n'as pas envie que les gens puissent les modifier, ou les voir individuellement. Autre exemple¬†: tu refuses que les gens puissent supprimer les potins. <br>
      Tu peux supprimer une route cr√©√©e par <code>resources</code> avec un <code>except:</code> comme cela :</p>
      <pre><code class="language-ruby">resources :gossips, except: [:destroy] </code></pre>
      <p>Ou carr√©ment restreindre les routes en faisant un petit <code>only:</code></p>
      <pre><code class="language-ruby">resources :comments, only: [:new, :create, :index, :destroy]</code></pre>
      <p>Tu peux utiliser <code>only:</code> ou <code>except:</code> comme cela t'arrange le mieux, et en pr√©cisant derri√®re le nom des m√©thodes concern√©es (<code>index</code>, <code>show</code>, <code>new</code>, <code>create</code>, <code>edit</code>, <code>update</code> ou <code>destroy</code>)</p>
    </div>
  </div>
</div>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE (bis)</h4>
      <p class="card-text">Et c'est <b>l√†</b> que ma pr√©conisation d'hier prend tout son sens¬†: utilise <code>$ rails routes</code> souvent car c'est un pr√©cieux alli√©. <br>
      Une fois que tu utilises la ligne <code>resources</code>, lire le fichier <code>routes.rb</code> ne suffit plus.</p>
    </div>
  </div>
</div>


<h3>3.3. Les controllers</h3>
<h4>3.3.1. Leur contenu en CRUD</h4>
<p>Pour √™tre coh√©rent avec les routes que l'on a d√©finies, les controllers devront contenir les m√©thodes du CRUD. Voici ce √† quoi devrait ressembler un controller typique, en prenant l'exemple des potins :</p>

<pre><code class="language-ruby">class GossipsController < ApplicationController

  def index
    # M√©thode qui r√©cup√®re tous les potins et les envoie √† la view index (index.html.erb) pour affichage
  end

  def show
    # M√©thode qui r√©cup√®re le potin concern√© et l'envoie √† la view show (show.html.erb) pour affichage
  end

  def new
    # M√©thode qui cr√©e un potin vide et l'envoie une view qui affiche le formulaire pour 'le remplir' (new.html.erb)
  end

  def create
    # M√©thode qui cr√©√© un potin √† partir du contenu du formulaire de new.html.erb, soumis par l'utilisateur
    # pour info, le contenu de ce formulaire sera accessible dans le hash params (ton meilleur pote)
    # Une fois la cr√©ation faite, on redirige g√©n√©ralement vers la m√©thode show (pour afficher le potin cr√©√©)
  end

  def edit
    # M√©thode qui r√©cup√®re le potin concern√© et l'envoie √† la view edit (edit.html.erb) pour affichage dans un formulaire d'√©dition
  end

  def update
    # M√©thode qui met √† jour le potin √† partir du contenu du formulaire de edit.html.erb, soumis par l'utilisateur
    # pour info, le contenu de ce formulaire sera accessible dans le hash params
    # Une fois la modification faite, on redirige g√©n√©ralement vers la m√©thode show (pour afficher le potin modifi√©)
  end

  def destroy
    # M√©thode qui r√©cup√®re le potin concern√© et le d√©truit en base
    # Une fois la suppression faite, on redirige g√©n√©ralement vers la m√©thode index (pour afficher la liste √† jour)
  end
end</code></pre>

<p>Et voil√†. Avec ce template, tu vas pouvoir manipuler tes potins dans tous les sens¬†!</p>


<h4>3.3.2. Exemples de controllers et de m√©thodes</h4>
<p>Pour illustrer un peu √† quoi ressemblent les controllers d'une application web complexe, on va te d√©crire chaque controller et chaque m√©thode qui se cache derri√®re une page du site de THP. <br>
  Au premier jour de THP, les routes √©taient faites √† la main √† base de "get bidule / post truc". √Ä pr√©sent, notre <code>routes.rb</code> est principalement constitu√© de lignes en <code>resources</code>¬†: vachement plus simple √† lire et √† comprendre.</p>

<h5>a) Premier exemple¬†: la page actuelle</h5>
<p>Tu es sur la page qui affiche le contenu (ressources/projets) d'un jour pr√©cis (controller <code>days</code>)¬†: cette page correspond √† la m√©thode <code>days#show</code>.</p>

<h5>b) La page qui affiche les missions des moussaillons</h5>
<p>On a un controller <code>assignments</code> et on veut afficher toutes les missions : c'est tout simplement un index avec <code>assignments#index</code>.</p>

<h5>c) La page pour s'inscrire √† une session</h5>
<p>On cherche √† cr√©er un objet <code>Subscription</code>¬†: c'est donc via la m√©thode <code>subscriptions#new</code> qui initialise le formulaire d'inscription.</p>

<h5>d) La page qui affiche le programme de la session</h5>
<p>Cette page affiche les semaines (controller <code>weeks</code>) du programme. Cela peut √™tre assimil√© √† son index¬†: <code>weeks#index</code>.</p>

<h5>e) La page qui affiche le programme d'une semaine</h5>
<p>Il y a plusieurs solutions pour afficher le contenu d'une semaine donn√©e. Soit on affiche l'index des jours de la dite semaine (m√©thode <code>index</code> du controller <code>days</code> sur une route imbriqu√©e o√π la semaine en question est identifi√©e avec une variable <code>:week_id</code>), soit on affiche le contenu d'une semaine pr√©cise. Finalement, c'est sur cette derni√®re option que nous sommes partis¬†: <code>weeks#show</code>. Mais les deux solutions se valaient.</p>

<h5>f) La page dans notre dashboard admin (invisible pour vous) qui enl√®ve un joker aux moussaillons qui font des b√™tises</h5>
<p>Aah, on commence √† √™tre dans les trucs plus sympas. Il ne nous semblait pas pertinent de consid√©rer les jokers comme des objets √† part enti√®re et de faire un model <code>Joker</code> : on a pr√©f√©r√© stocker le nombre de jokers dans une colonne "jokers" de la table <code>subscriptions</code>. Mais en soi, les jokers sont quand m√™me des ressources et on a fait le choix de cr√©er un controller <code>jokers</code> afin de pouvoir appeler la m√©thode <code>jokers#destroy</code>. En l'absence de model <code>Joker</code>, elle ne fera qu'un truc du genre <code>@subscription.remove_joker</code> qui soustrait 1 √† la colonne "jokers".</p>

<h5>g) La page dans notre dashboard admin (invisible pour vous) qui affiche un jour avec ses infos</h5>
<p>Ce cas est int√©ressant, sachant que l'on utilise d√©j√† <code>days#show</code> pour g√©rer l'affichage aux moussaillons et corsaire de chaque journ√©e. Ici, on a d√ª cr√©er un second controller <code>days</code> qui permet de g√©rer les actions sp√©cifiques √† la partie "admin" du site web (r√©serv√©e √† l'√©quipe de THP). <br>
Pour faire √ßa, on a eu recours √† une petite astuce de Rails, r√©pondant au doux nom de <a href="https://guides.rubyonrails.org/routing.html#controller-namespaces-and-routing" target="_blank">namespace</a>. En gros, on utilisera toujours la m√©thode <code>days#show</code>, mais ce controller <code>days</code> sera situ√© dans un dossier diff√©rent et permet d'appeler un view diff√©rente. Au final, votre affichage de chaque journ√©e et le n√¥tre sont diff√©rents üëå</p>

<h5>h) Afficher un formulaire de contact</h5>
<p>Tu vas cr√©er un controller <code>messages</code> ou <code>contacts</code> et appeler la m√©thode <code>messages#new</code> ou bien <code>contacts#new</code>. Le nom du controller sera celui que tu trouves le plus pertinent.</p>

<h5>i) Conclusion</h5>
<p>Bref, j'esp√®re qu'on a r√©ussi √† te convaincre que m√™me un site web complexe comme THP (avec plein d'objets, une partie admin, des controllers partout, etc.) peut respecter les conventions REST et CRUD. J'irai m√™me plus loin¬†: ces conventions permettent d'avoir tout bien rang√©, selon une logique facile √† expliquer. <br>
Des fois il y aura plusieurs options et l√†, soit tu te fies √† ton exp√©rience, soit (dans ton cas) il faut y r√©fl√©chir deux secondes. Prends le temps de te poser et r√©fl√©chir, avec les membres de ton groupe, sur les bons controllers avant de foncer t√™te baiss√©e vers une architecture dans laquelle tu ne te sentiras pas √† l'aise plus tard. Mais n'oublie jamais¬†: <b>Rails a √©t√© con√ßu pour le REST, donc le framework est adapt√© quand on pense REST.</b></p>

<p>Pour certaines pages, le REST n'est pas adapt√©¬†: par exemple les routes statiques (afficher la politique de confidentialit√©, les t√©moignages, la FAQ). Dans ces cas-l√†, tu peux r√©diger une route √† la main sans passer par <code>resources</code> et sans respecter le REST. Mais il faut que ces cas soient <b>minoritaires</b> et qu'il n'y ait <b>vraiment pas d'autre solution</b>.</p>

<h2>4. Points importants √† retenir</h2>
<p>Rails utilise le REST pour ses routes. Elles renvoient vers des controllers qui suivent les 7 m√©thodes du CRUD¬†: <code>#new</code>, <code>#create</code>, <code>#show</code>, <code>#index</code>, <code>#edit</code>, <code>#update</code>, <code>#destroy</code>.</p>

<p>Il est possible et tr√®s facile de faire des routes qui suivent le REST avec <code>resources</code>.</p>

<p>Tu peux limiter le nombre de routes cr√©√©es par <code>resources</code> avec only: ou except: et en pr√©cisant derri√®re le nom des m√©thodes concern√©es (index, show, new, create, edit, update ou destroy)</p>

<p>Pour visualiser les routes de ton application, tapes <code>$ rails routes</code>. Pour cibler les routes d'un controller particulier, tapes <code>$ rails routes | grep gossips</code>.</p>

<p> ‚ö†Ô∏è √Ä partir de maintenant, nous te demanderons <b>obligatoirement</b> que tes routes suivent le REST, et que tes controllers aient les bons noms de m√©thodes CRUD. Tes routes devront alors utiliser quasi-exclusivement des lignes en <code>resources</code>.</p>

<h2>5. Pour aller plus loin</h2>
<p>Devine ;) <br>
  Pour changer, <a href="https://edgeguides.rubyonrails.org/routing.html">la doc</a> te donne tous les outils disponibles ainsi que les bonnes astuces.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Faire un formulaire en Rails</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Rails et les formulaires : une longue histoire d'amour n√©e d'un mariage un peu oblig√©. En effet, comment faire l'impasse sur les formulaires (leur mise en page, leur fonctionnement) dans les applications web o√π l'utilisateur ne cesse de cr√©er des entr√©es en BDD et de les modifier ensuite¬†? <br>
Rails a plein de "helpers" pour nous aider √† cr√©er des formulaires, mais nous allons dans cette le√ßon voir comment faire pour cr√©er un formulaire avec HTML. Une fois que tu as compris le fonctionnement d'un formulaire de base en HTML, tu pourras manipuler les autres techniques (form_tag, form_for ou encore simple_form), et tu comprendras l'int√©r√™t de ces helpers.</p>

<h2>2. Historique</h2>
<p>Dis-toi bien que toute exp√©rience utilisateur commence par un formulaire¬†: celui d'inscription au site.</p>

<h2>3. La ressource</h2>

<h3>3.1. Les bases d'un formulaire</h3>
<p>Un formulaire de base, en HTML, comporte plusieurs √©l√©ments indispensables¬†:</p>
<ul>
  <li>Les balises <code>&lt;form></code> et <code>&lt;/form></code> pour marquer son d√©but et sa fin</li>
  <li>2 options √† renseigner dans la balise <code>&lt;form></code>¬†: l'option <code>action</code> pour identifier l'URL point√©e et l'option <code>method</code> pour indiquer le verbe HTTP de l'envoi (POST, PUT, etc.)</li>
  <li>G√©n√©ralement un champ <code>&lt;input type="text"></code> pour obtenir la saisie de l'utilisateur</li>
  <li>Obligatoirement un bouton d'envoi sous la forme <code>&lt;input type="submit"></code></li>
</ul>

<p>Ainsi, prenons l'exemple d'un formulaire qui enverrait un champ <code>nom_du_champ</code> (√† compl√©ter par l'utilisateur) √† l'URL <code>url_de_l'action</code>, en faisant une m√©thode <code>POST</code> </p>
<pre><code class="language-html">&lt;form action="url_de_l'action" method="POST">
  &lt;input type="text" name="nom_du_champ">
  &lt;input type="submit" value="Envoyer le formulaire">
&lt;/form></code></pre>

<p>Nos amis de W3 Schools <a href="https://www.w3schools.com/html/html_forms.asp" target="_blank">ont une doc tr√®s fournie</a> sur les formulaires, et tu peux jeter un ≈ìil sur les diff√©rents √©l√©ments qui peuvent entrer dans la composition d'un formulaire (radio_button, checkboxes, etc).</p>

<h3>3.2. L'authenticity token</h3>
<p>Une des forces de Rails est que le framework met automatiquement en place des s√©curit√©s sans qu'il ne soit n√©cessaire de s'en soucier. Ainsi, une forme de piratage fr√©quente sur Internet est l'utilisation de la <a href="https://fr.wikipedia.org/wiki/Cross-site_request_forgery">vuln√©rabilit√© CSRF</a> des sites web. En gros, le formulaire HTML de base ne marchera pas sur Rails, car ce n'est pas tr√®s secure¬†: comment savoir si la requ√™te √©manant de ton ordi a bien √©t√© soumise par un formulaire web et pas par un script tournant, sans que tu ne le saches, sur ton ordi¬†? Pour s'en assurer, Rails demande syst√©matiquement que les requ√™tes provenant de formulaires soient accompagn√©es d'un "authenticity token". Ne t'en fais pas, c'est plut√¥t simple √† impl√©menter¬†: il faut juste rajouter un champ cach√© dans ton formulaire. Pour cela, ajoute cela √† ton formulaire :</p>
<pre><code class="language-html">&lt;input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
</code></pre>

<p>Gr√¢ce au <code>type="hidden"</code>, cette ligne sera invisible pour l'utilisateur. Par contre, tu peux checker le code source de ta page¬†: le <code>&lt;%= form_authenticity_token %></code> sera remplac√© par un long string qui validera que la requ√™te provient bien d'un formulaire web et que personne n'usurpe ton identit√©.</p>

<h3>3.3. l'URL et le verbe du formulaire</h3>
<p>Tout formulaire pointe vers une URL avec un verbe HTTP¬†: quand il sera soumis par l'utilisateur, le formulaire va √©mettre une requ√™te au serveur selon ces 2 param√®tres. Du coup, tu l'as compris, il faut que l'URL et le verbe correspondent √† une route de ton application Rails¬†! Cette route pointera ensuite vers une m√©thode d'un controller dont le r√¥le sera de faire quelque chose de malin avec le contenu du formulaire. <br>
En r√©sum√©, voil√† le cheminement complet :</p>
<ol>
  <li>Le formulaire s'affiche dans le navigateur, l'utilisateur le remplit et clique sur le bouton d'envoi¬†;</li>
  <li>Le contenu du formulaire est envoy√© sous forme de requ√™te au serveur avec l'URL et l'action HTTP param√©tr√©s¬†;</li>
  <li>Le serveur va dans le routeur et regarde √† quoi correspond ce couple URL-verbe HTTP¬†;</li>
  <li>Il fait alors suivre l'information √† la m√©thode du controller que le routeur pointe¬†;</li>
  <li>La m√©thode s'ex√©cute avec, √† disposition, les informations contenues dans le formulaire.</li>
</ol>

<p>Donc il est important de ne pas te tromper sur la requ√™te (URL + verbe HTTP) que tu param√®tres dans le formulaire. En Rails, il est pr√©f√©rable que l'URL soit param√©tr√©e via son path, de la fa√ßon suivante¬†: <code>action= &lt;%= tonchemin_path %> </code>.</p>

<p>Un exemple concret¬†? Le formulaire suivant : </p>
<pre><code class="language-html">&lt;form action= &lt;%= gossips_path %> method="POST">
  &lt;input type="text" name="gossip_text">
  &lt;input type="submit" value="Valider">
&lt;/form></code></pre>

<p>Va pointer vers la route ci-dessous¬†: </p>

<pre><code class="language-shell">                   Prefix   Verb   URI Pattern                                                                         Controller#Action
                    gossips   POST   /gossips(.:format)                                                                  gossips#create</code></pre>

<p>Reste alors √† coder ta m√©thode <code>#create</code> dans ton controller <code>gossips</code> pour qu'elle traite les donn√©es saisies par l'utilisateur. On va voir comment faire √ßa en utilisant <code>params</code>.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ü§ì QUESTION R√âCURRENTE</h4>
      <p class="card-text"><b>√áa existe les formulaires utilisant le verbe GET ?</b></p>
      <p>Oui, en g√©n√©ral c'est de la recherche. W3 Schools expliquent bien <a href="https://www.w3schools.com/html/html_forms.asp" target="_blank" class="text-primary">la diff√©rence</a> entre les formulaires GET et POST.</p>
    </div>
  </div>
</div>

<h3>3.4. Tiens params, comme on s' retrouve‚Ä¶</h3>
<p>Si tu vas dans la fen√™tre de terminal quand tu soumets un formulaire, tu verras un truc du genre passer dans le serveur :</p>
<pre><code class="language-shell">Parameters: {"authenticity_token"=>"L/fvdS8JQNvxOn1PIleAp9e2XEGSa42oBSU0uC68GFgXBPEvSTIh3X+zxis2vulcKzixTBWpGw+e/BxEePwliw==", "first_name"=>"F√©lix", "last_name"=>"Gaud√©", "Envoyer"=>"Valider"}</code></pre>

<p>C'est √† nouveau <code>params</code>, le fameux hash qui contient les variables que l'on passe dans les URL dynamiques, tu te souviens¬†? En fait, <code>params</code> stocke aussi les informations envoy√©es par un formulaire. Et tout comme dans l'exemple des URLs dynamique, on peut extraire les informations de ce hash dans le controller. <br>
Comme pr√©c√©demment, fais des <code>puts params</code> dans la m√©thode de controller vers laquelle pointe ton formulaire¬†: <code>params</code> va s'afficher dans ton terminal et tu sauras alors comment en extraire les valeurs. <br>
Reprenons l'exemple pr√©c√©dent (je rajoute l'authenticity token pour qu'il marche)¬†: </p>

<pre><code class="language-html">&lt;form action= <%= gossips_path %> method="POST">
      &lt;input type="hidden" name="authenticity_token" value=<%= form_authenticity_token %> >
      &lt;input type="text" name="gossip_text">
      &lt;input type="submit" value="Valider">
&lt;/form></code></pre>

<p>√Ä pr√©sent je vais dans la m√©thode vers laquelle il pointe (<code>#create</code> dans le controller<code>gossips</code>) et j'ins√®re un petit <code>puts params</code> bien visible :</p>

<pre><code class="language-ruby">class GossipsController < ApplicationController
  def create
    puts "$" * 60
    puts "ceci est le contenu de params :"
    puts params
    puts "$" * 60
  end
end</code></pre>

<p>En compl√©tant le formulaire avec les mots "ceci est mon gossip" et en l'envoyant, je vais voir passer l'information suivante dans mon terminal :</p>

<pre><code class="language-shell">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
  ceci est le contenu de params :
{"authenticity_token"=>"RF7BdFtqTr3bV3nbZHJZ9zWJfFSdj7I99PS4jPkPd0+nneoUZthLCpJROaUAQ4JX+B/epb3tQro2swZdnN96cA==", <br> "gossip_text"=>"ceci est mon gossip", "controller"=>"gossips", "action"=>"create"}
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</code></pre>

<p>Ainsi, on comprend que <code>params["gossip_text"]</code> contient la valeur saisie dans mon champ <code>&lt;input type="text" name="gossip_text"></code>. Il ne nous reste plus qu'√† faire un petit <code>Gossip.create(params["gossip_text"])</code> pour que la m√©thode <code>create</code> enregistre en base le potin et son texte¬†!</p>

<p>PROTIP¬†: au lieu de faire <code>params["gossip_text"]</code>, tu peux aussi faire <code>params[:gossip_text]</code></p>

<h2>4. Points importants √† retenir</h2>
<p>Les formulaires de Rails peuvent √™tre faits directement en HTML avec les balises <code>form</code> et <code>input</code>.</p>
<p>Pour que le formulaire pointe vers la bonne route, il faut sp√©cifier la bonne URL (dans <code>action</code>) et le bon verbe HTTP (dans <code>method</code>). Tape <code>$ rails routes</code> pour trouver les routes qui n√©cessitent un formulaire (celles en POST ou en PUT g√©n√©ralement).</p>
<p>Les champs du formulaire sont ensuite disponibles dans le controller via le hash <code>params</code>. Fais un <code>puts params</code> pour confirmer son contenu puis utilise les valeurs de params dans ta m√©thode de controller. Par exemple via <code>params[:gossip_text]</code>.</p>

<h2>5. Pour aller plus loin</h2>
<p>W3Schools sont les champions en ce qui concerne le HTML, et ont une excellente doc sur les formulaires.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Tests de vues</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Tu as vu les tests dans Rails ainsi qu'une introduction dans les tests de models. Nous allons continuer cette introduction aux tests avec les tests unitaires des views. En gros nous allons tester que telle vue affiche bien tel √©l√©ment.</p>

<h2>2. Historique</h2>
<p>Rails aime bien tout tester, donc bien entendu le rubyist ont tr√®s rapidement trouv√© le moyen de tester que les √©l√©ments s'affichent bien.</p>

<h2>3. La ressource</h2>
<h3>3.1. Les tests de view</h3>
<p>L'objectif d'un test de vue est de v√©rifier que les √©l√©ments que tu veux voir affich√©s soient affich√©s. Voici quelques exemples :</p>

<ul>
  <li>La page d'accueil de ton site Airbnb va afficher toutes les villes de ton application, elle doit donc afficher "Paris" √† un moment ou un autre</li>
  <li>Tu veux afficher la page profil d'un utilisateur avec ses informations basiques. Cette page devra afficher son adresse email ainsi que son pr√©nom</li>
  <li>Tu veux mettre dans toute ton application un header qui contient le lien de la page d'accueil de ton site. Tu as envie de v√©rifier si ce lien est bien pr√©sent dans tes views</li>
  <li>Sur la page d'accueil, tu mentionnes tel mot. Il faut pouvoir v√©rifier que ce mot soit bien affich√©</li>
  <li>Tu fais une vue qui recense toutes les propositions de missions de tes √©tudiants. Imaginons que tu aies envie que le propri√©taire d'une mission puisse la supprimer avec un bouton de suppresion. Il faut pouvoir tester que ce bouton n'apparaisse pas pour les personnes qui ne sont pas propri√©taires de la mission</li>
</ul>

<p>Les tests de vue permettent de v√©rifier des √©l√©ments comme ceux vus plus haut. Un test de vue permet juste de construire le fichier html √† partir du fichier erb, puis de v√©rifier si tel √©l√©ment existe bien en HTML. Nous n'allons pas v√©rifier le CSS ni le javaScript. En gros, cela permet de voir que tes conditions dans tes vues sont bien respect√©es, et que les √©l√©ments s'affichent bien.</p>


<h3>3.2. Brancher les tests de vue</h3>
<p>Les tests de view se mettent dans le dossier <code>spec/views/</code>. Tout comme les views normales, tu vas mettre les tests de view bien rang√©s dans des dossiers correspondants :</p>

<ul>
  <li>Le test de la view index du controller statics se fera dans <code>spec/views/statics/index.html.erb_spec.rb</code></li>
  <li>Le test de la view new du controller users se fera dans <code>spec/views/users/new.html.erb_spec.rb</code></li>
  <li>Le test de la view show du controller cities se fera dans <code>spec/views/cities.html.erb_spec.rb</code></li>
</ul>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Tu peux g√©n√©rer des tests en utilisant le <a href="https://relishapp.com/rspec/rspec-rails/v/3-8/docs/generators" target="_blank">g√©n√©rateur de tests de Rspec</a>. Par exemple, si tu veux cr√©er le test pour index et new des utilisateurs, tu feras :</p>
      <pre><code class="language-shell">$ rails g rspec:view users index new</code></pre>
    </div>
  </div>
</div>


<p>Voici la base d'un fichier de test pour la vue index des cities (le fichier <code>spec/views/cities/index.html.erb_spec.rb</code>) :</p>

<pre><code class="language-ruby">require 'rails_helper'

RSpec.describe "cities/index.html.erb", type: :view do

  context 'some context' do  
    it 'should display something' do
      # ton test
    end
  end

  context 'other context' do  
    it 'should display something' do
      # ton test
    end
  end

end</code></pre>


<h3>3.3. Quelques exemples de test</h3>
<p>Voici quelques exemples de tests.</p>


<h4>3.3.1. Un test pour voir si tel mot est affich√©</h4>
<p>Prenons l'exemple d'un site qui doit te souhaiter la bienvenue sur sa page d'accueil. Voici √† quoi ressemblerait le test qui v√©rifie que le mot "bienvenue" soit bien mentionn√© sur ta page :</p>

<pre><code class="language-ruby">context 'it says welcome' do
  it "displays 'welcome'" do
    # g√©n√©re la page
    render

    # le contenu "Bievenue" doit √™tre dans la page
    expect(rendered).to have_content 'Bienvenue'
  end
end</code></pre><br>

<p>Nous devons g√©n√©rer la page, puis v√©rifier que tel mot existe. Pas besoin de plus ü§†</p>

<h4>3.3.1. Un test pour v√©rifier que l'adresse email d'un utilisateur est bien affich√© sur sa page profil</h4>
<p>Prenons l'exemple de la page show de ton controller users. Tu as envie que cette page affiche l'email de l'utilisateur. Le soucis est que cette page utilise une variable d'instance, qui s'appelle <code>@user</code>. Les tests de views ne vont tester QUE les views, c'est √† dire qu'ils vont charger la view sans faire appel au controller. Comme ta view utilise une variable d'instance, et que cette derni√®re est g√©n√©r√©e par ton controller, il te faudra la refaire dans ton test. L'avantage est qu'avec FactoryBot c'est tr√®s simple de g√©n√©rer une variable d'instance.</p>

<p>Voici donc un test qui v√©rifie que l'email de l'utilisateur est bien mentionn√© dans la vue :</p>

<pre><code class="language-ruby">context 'it says welcome' do
  it "displays 'welcome'" do
    # dit √† la view que @user sera le build d'un utilisateur avec "lol@email.com" comme email
    assign(:user, build(:user, email: "lol@email.com"))

    # g√©n√®re la vue (ceci doit √™tre fait apr√®s avoir assign√© la variable d'instance, pour qu'il puisse la trouver)
    render
    
    # la vue rendered doit afficher l'email pass√©
    expect(rendered).to match /lol@email.com/
  end
end</code></pre><br>

<p>Nous devons assigner la variable d'instance, render la page, puis v√©rifier que le d√©tail que nous avons d√©fini existe bien.</p>




<h4>3.3.2. Un test pour v√©rifier que la page index affiche bien tous les √©l√©ments</h4>
<p>Tu peux assign un √©l√©ment unique, mais des fois tu veux assign plusieurs √©l√©ments. Par exemple l'index des villes doit afficher tous les villes. Faisons un exemple qui v√©rifie que le zip_code d'une ville et le name d'une ville soient bien affich√©s :</p>

<pre><code class="language-ruby">context 'when there are cities' do  
  it 'displays the details' do
    # d√©clare la variable cities, qui est une array contenant des villes
    assign(:cities,
      [
        build(:city, name: "Bordeaux"),
        build(:city, zip_code: "34000"),
        build(:city),
        build(:city)
      ]
    )

    render

    # v√©rifie que le name d'une des villes soit affich√©
    expect(rendered).to match /Bordeaux/

    # v√©rifie que le zip_code d'une ville soit affich√©
    expect(rendered).to match /34000/
  end
end</code></pre><br>



<h3>3.4. La philosophie des tests de vue</h3>
<p>Les tests de vue sont tr√®s rapides. Ils permettent de montrer que tu as bien mis tel √©l√©ment important dans la vue, ou que ton <code>user.first_name</code> s'affiche bien. Ils sont tr√®s pratiques dans les conditions de vue (par exemple un bouton pour supprimer la mission pour son cr√©ateur) et permettent de confirmer certains √©l√©ments tr√®s chiants √† v√©rifier (imagine la gal√®re pour nous de tester √† la main la vue pour les corrections du matin).</p>

<p>Les tests de vue vont juste v√©rifier le HTML g√©n√©r√© par le fichier ERB √† partir de variables que tu as d√©finies dans le test. Ils ne vont pas v√©rifier le CSS, encore moins le JavaScript.</p>

<h2>4. Points importants √† retenir</h2>
<p>Les tests de vue se font dans le dossier <code>spec/views/</code>. Les tests de vue sont simples : tu v√©rifies juste que tel mot est affich√©, ou bien que tel √©l√©ment de ta variable d'instance est affich√©. Voici comment un test de vue se structure :</p>

<pre><code class="language-ruby">require 'rails_helper'

RSpec.describe "models/method.html.erb", type: :view do

  context 'some context' do  
    it 'should display something' do
      assign(:ta_variable, some_factories)
      render
      expect(rendered).some_test
    end
  end

end</code></pre>




<h2>5. Pour aller plus loin</h2>
<p><a href="https://relishapp.com/rspec/rspec-rails/v/3-8/docs/view-specs/view-spec" target="_blank">La documentation</a> a quelques exemples qui peuvent t'int√©resser.</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>


  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #FF4081 " >
          <h1>Projet : Cr√©ation d&#39;un potin</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Hello¬†! Aujourd'hui, on va rajouter une nouvelle fonctionnalit√© √† The Gossip Project¬†! Tu vas reprendre le projet d'hier puis appliquer ce que tu as vu aujourd'hui :</p>
<ul>
  <li>D√©j√†, tu vas mettre le projet sur Heroku pour que toute la terre enti√®re puisse comm√©rer.</li>
  <li>Ensuite tu vas mettre √† disposition un formulaire pour cr√©er des potins.</li>
  <li>Enfin, tu vas faire des tests pour les views de ton application.</li>
</ul>


<h2>2. Le projet</h2>

<h3>2.0. Bases de donn√©es¬†?</h3>
<p>Tu te souviens de ce que tu avais vu sur les bases de donn√©es et les validations de models¬†? Eh bien nous allons voir si tu n'es pas trop rouill√© √† ce sujet üî® Rajoute, dans les models, des validations aux attributs importants (spoiler¬†: quasi tous) de ton application.</p>

<p>On va t'aider pour les validations du model des potins :</p>

<ul>
  <li>la pr√©sence du <code>title</code> est obligatoire, ce dernier ne peut pas faire moins de 3 caract√®res ni plus de 14 caract√®res</li>
  <li>la pr√©sence du <code>content</code> est obligatoire</li>
</ul>

<p>Ajoutes quelques tests de models pour ne pas perdre la main.</p>

<h3>2.1. En production¬†!</h3>
<p>Maintenant, on va mettre en ligne l'application que tu as cod√©e hier. <br>
Attention, on te pr√©vient¬†: la premi√®re fois qu'on met en ligne, √ßa peut piquer, car on se tape un max de probl√®mes. Impossible pour nous de lister ici tous les soucis que tu risques de rencontrer en chemin¬†: il faut en passer par l√† pour te former √† Heroku. <br>
Nos conseils¬†: </p>
<ul>
  <li>Vas-y pas √† pas au d√©but pour ne pas oublier une √©tape de base (genre de passer les migrations)¬†;</li>
  <li>Lis bien les messages d'erreur, essaye de les comprendre et sinon utilise Google et StackOverflow¬†;</li>
  <li>√âvidemment, appuie-toi sur la communaut√© et appelle √† l'aide sur Slack¬†;</li>
  <li>Surtout ne te d√©courage jamais¬†: on y arrive toujours √† push sur Heroku au bout d'un moment¬†!</li>
</ul>

<h3>2.2. Cr√©ation de potin</h3>
<p>Cette partie sera la plus longue de la journ√©e, car pour la premi√®re fois nous allons te faire jouer avec les controllers de Rails. C'est pas trop t√¥t¬†! ‚ô•</p>

<p>√Ä partir de la page d'accueil qui recense tous les potins, l'application va inviter l'utilisateur √† enregistrer son propre potin. En cliquant sur un lien, il va se retrouver sur une page contenant un formulaire de cr√©ation de potin. Ce formulaire va demander le titre du potin, ainsi que son contenu. Une fois soumis, le formulaire va enregistrer le potin en base et l'utilisateur va √™tre redirig√© vers la page d'accueil.</p>

<p>Le principe de base est simple, mais nous allons le pimenter en te demandant d'impl√©menter quelques concepts nouveaux¬†: le helper <code>form_tag</code> de Rails et les alertes.</p>


<h4>2.2.1. Pr√©paration des routes, du controller et de la view</h4>
<p>Pour cr√©er un potin, il est n√©cessaire d'avoir un controller <code>gossips</code> contenant les m√©thodes <code>#new</code> et <code>#create</code>. <br>
Il faut √©galement les routes (en mode REST) qui pointent vers ces 2 m√©thodes. <br>
Pour finir, il te faut la view qui va afficher le formulaire¬†: <code>gossips/new.html.erb</code>. √Ä noter qu'il n'existe pas de view <code>create.html.erb</code>¬†: la m√©thode <code>#create</code> renvoie vers l'index.</p>
<p>Je te laisse mettre tout √ßa en place¬†! <br>
‚ö†Ô∏è <b>Attention</b> ‚ö†Ô∏è on l'a d√©j√† dit mais √† partir de maintenant on ne veut que des routes en <code>resources</code>¬†! Pas de route √©crite √† la main üëã</b>

<h4>2.2.2. Formulaire de cr√©ation</h4>
<p>Maintenant que tu as ta view, et tes m√©thodes de pr√™tes, nous allons te demander de faire le formulaire de cr√©ation de potins dans la view <code>new.html.erb</code>. En Rails, nous pouvons voir 4 types principaux de formulaires :</p>

<ul>
  <li>Les formulaires HTML (on en a parl√© dans la ressource)</li>
  <li>Les <code>form_tag</code></li>
  <li>Les <code>form_for</code></li>
  <li>Les formulaires via la gem <a href="https://github.com/plataformatec/simple_form" target="_blank">simple_form</a></li>
</ul>

<p>Pour cet exercice, nous allons te demander d'utiliser <code>form_tag</code>, tr√®s adapt√© quand on d√©bute. Nos amis de LaunchSchool ont fait <a href="https://launchschool.com/books/demystifying_rails/read/form_helpers#formtag" target="_blank" class="text-primary">un bon tuto</a> sur form_tag, et tu peux checker <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-form_tag" target="_blank" class="text-primary">la doc de form_tag</a>.</p>

<p>Ton formulaire doit demander le <code>title</code> ainsi que le <code>content</code> du potin que tu vas cr√©er. Bien entendu, quand tu valides le formulaire, ce dernier doit partir √† la m√©thode <code>#create</code> de ton controller de potins.</p>


<h4>2.2.3. Controller</h4>
<h5>2.2.3.1. def create</h5>
<p>Maintenant que nous avons fait un formulaire qui demande ce que l'on veut r√©cup√©rer, et qui l'envoie √† la m√©thode <code>#create</code> de notre controller, il faut que ce dernier fasse son taff. Le r√©sultat que l'on veut, en termes d'exp√©rience utilisateur, est le suivant :</p>

<ul>
  <li>L'utilisateur est sur une magnifique page o√π il doit remplir un formulaire. Il le remplit et le soumet.</li>
  <li>De l√†, 2 cas sont possibles:</li>
  <ol>
    <li><b>Si le contenu du formulaire est accept√©</b> et que l'objet est bien cr√©√© en base, l'utilisateur est redirig√© vers une nouvelle page HTML avec, en haut, un bandeau VERT disant un truc du genre "The super potin was succesfully saved¬†!" (c'est ce qu'on appelle une alerte)</li>
    <li><b>Si le contenu du formulaire est refus√©</b> (objet non cr√©√© en base, car il manque un champ ou alors le contenu n'est pas valide, etc.), l'utilisateur retourne √† nouveau sur la page du formulaire avec, en haut, un bandeau ROUGE disant un truc du genre "Error¬†: you need to complete this field / the title must be at least 3 characters longue / etc." (c'est un autre type d'alerte)</li>
  </ol>
</ul>

<p>Le boulot de ton controller est d'arriver √† coordonner ceci. En gros, il va faire la chose suivante :</p>

<ul>
  <li>Il va r√©cup√©rer les informations du formulaire et essayer d'en faire une instance de ton model et de la sauver.
  <ul>
    <li>le model va soit dire "tout va bien j'ai r√©ussi √† cr√©er mon instance üëå"...</li>
    <li>‚Ä¶ ou alors il va dire "ROLLBACK" "hey¬†! les validations ne sont pas pass√©es, je te renvoie une ou plusieurs erreurs"</li>
  </ul></li>
  <li>Si l'instance est sauvegard√©e en base de donn√©es, le controller va rediriger vers la page index.</li>
  <li>Si le model n'arrive pas √† sauvegarder ton instance, il va rester sur la page du formulaire pour que l'utilisateur r√©-essaye de le remplir sans erreur.</li>
</ul>

<p>Pour la cr√©ation d'une instance, <b>un controller ne fera jamais plus</b>. Rappelle-toi¬†: Fat model Skinny controller. Son taf est de r√©cup√©rer les informations, d'appeler les bons services, puis de faire les redirections.</p>

<p>Bref, voici le squelette de la m√©thode <code>#create</code> :</p>

<pre><code class="language-ruby">def create
  @gossip = Gossip.new(xxx) # avec xxx qui sont les donn√©es obtenues √† partir du formulaire

  if @gossip.save # essaie de sauvegarder en base @gossip
    # si √ßa marche, il redirige vers la page d'index du site
  else
    # sinon, il render la view new (qui est celle sur laquelle on est d√©j√†)
  end
end</code></pre>

<p>Pour info, ce squelette convient √† environ 100¬†% des m√©thodes <code>#create</code> des controllers de Rails. N'essaie pas de sortir des clous de ce squelette, il y aurait 100¬†% de chance que ce soit faux üòâ. Tout ce que tu veux mettre en plus devra aller dans le model.</p>

<p>‚ö†Ô∏èPour le moment nous ne g√©rons pas l'authentification des utilisateurs. Or chaque potin doit avoir un auteur en base¬†! Pour palier √† √ßa, nous allons faire une petite astuce¬†: tu vas cr√©er (en console) un utilisateur nomm√© <code>anonymous</code> puis faire en sorte que tous les potins cr√©√©s dans la view <code>new</code> soient syst√©matiquement associ√©s √† cet utilisateur.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ü§ì QUESTION R√âCURRENTE</h4>
      <p class="card-text"><b>Dis donc Jamy, c'est quoi la diff√©rence entre <code>redirect_to</code> et <code>render</code>¬†? Pourquoi je fais l'un et pas l'autre¬†?</b><br>
        <code>redirect_to</code> va passer par la route s√©lectionn√©e, donc ton app repart sur un controller, sa m√©thode, etc.  <br>
        Par contre <code>render</code>, ne fait qu'afficher une view tout en gardant les variables disponibles (notamment <code>@gossip</code>). Et √ßa, √ßa te permet de faire dans ta view :</p>
        <pre><code class="language-html">&lt;% if @gossip.errors.any? %>
  &lt;p>Nous n'avons pas r√©ussi √† cr√©er le potin pour la (ou les) raison(s) suivante(s) :&lt;/p>
  &lt;ul>
    &lt;% @gossip.errors.full_messages.each do |message| %>
      &lt;li>&lt;%= message %>&lt;/li>
    &lt;% end %>
  &lt;/ul>
&lt;% end %></code></pre>
        <p>Et cela affichera les erreurs que tu as si durement cod√©es dans les validations de tes models üôå</p>
    </div>
  </div>
</div>

<p><b>Et voil√†, maintenant on t'invite √† remplir le controller et coder ta m√©thode <code>create</code> pour qu'elle fonctionne</b>. <br> Pour le moment, n'affiche pas d'alerte de succ√®s ou de r√©ussite¬†: on cherche juste √† sauver en base puis renvoyer vers l'index en cas de succ√®s ou recharger le formulaire en cas d'√©chec. <br>
Nous te laissons d√©lib√©r√©ment avec peu d'information, pour que tu cherches un peu sur le net comment tout articuler.</p>

<h5>2.2.3.2. Alerte g√©n√©rale</h5>
<p>Comme d√©crit plus haut, les alertes permettent de donner √† l'utilisateur l'information qu'un formulaire a √©t√© soumis avec succ√®s (un objet a √©t√© sauv√© en base) ou bien qu'il y a eu un souci (l'utilisateur doit revoir le formulaire).</p>


<p>Commence donc par afficher dans les views des petits messages qui informe l'utilisateur du succ√®s (ou non) de son formulaire.</p>
<p>Une fois que tu as fait cela, essaye d'afficher les messages dans une <a href="https://getbootstrap.com/docs/4.2/components/alerts/" target="_blank">belle alerte Bootstrap</a>. Maintenant il n'y a plus de doute¬†: l'utilisateur sait quand il a r√©ussi (alerte VERTE) ou quand √ßa a rat√© (alerte ROUGE).</p>



<h3>2.3. Tests de views</h3>
<p>Maintenant ajoute un test pour la view de la page d'accueil, puis un test pour la view de la page de cr√©ation de potin.</p>

<h2>3. Rendu attendu</h2>
<p>Une am√©lioration de The Gossip Project : on peut enfin cr√©er un potin sans passer par le seed ni la console¬†!</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>



</div>


  </div>
</div>
    <script src="/packs/dashboard-031178fac0de4f91cbcc.js"></script>
    

    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  </body>
</html>

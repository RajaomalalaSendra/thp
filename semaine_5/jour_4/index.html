<!DOCTYPE html>
<html class="loading" lang="fr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../../style/bootstrap.css">
    <title>The hacking project offline</title>
  </head>
  <body class="vertical-layout vertical-menu 2-columns  menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <h1 class="navbar-brand">THE HACKING PROJECT</h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="../../">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../about">About</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>

<div class="container">
    <a type="button" class="btn btn-dark " href="../../semaine_1/">Semaine 1</a>
    <a type="button" class="btn btn-dark" href="../../semaine_2/">Semaine 2</a>
    <a type="button" class="btn btn-dark" href="../../semaine_3/">Semaine 3</a>
    <a type="button" class="btn btn-dark" href="../../semaine_4/">Semaine 4</a>
    <a type="button" class="btn btn-dark btn-lg" href="../../semaine_5/">Semaine 5</a>  
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      <div class="container">
    <div class="card">
  <div class="card-header">
    <h4 class="text-center"> Programme jour par jour</h4>
  </div>
  <div class="card-body">
    <div class="text-center">
    <a href="../../semaine_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-terminal"></i>&nbsp;&nbsp;&nbsp;Lun
      </button>
</a>    <a href="../../semaine_5/jour_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-code"></i>&nbsp;&nbsp;&nbsp;Mar
      </button>
</a>    <a href="../../semaine_5/jour_3">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-desktop"></i>&nbsp;&nbsp;&nbsp;Mer
      </button>
</a>    <a href="../../semaine_5/jour_4">
      <button class="btn btn-secondary btn-outline-dark btn-lg mr-4">
      <i class="fa fa-folder-open"></i>&nbsp;&nbsp;&nbsp;Jeu
      </button>
</a>    <a href="../../semaine_5/jour_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-bullhorn"></i>&nbsp;&nbsp;&nbsp;Ven
      </button>
</a>    </div>
  </div>
</div>

<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      
<div class="content-body">
      <h2 class="text-center">Pimp du Gossip Project</h2>
      <h4 class="text-center">Rails intermÃ©diaire</h4>
  <div class="row">
     <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
              <i class="ft-calendar icon-opacity info font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
              <span class="d-block mb-1 font-medium-1"></span>
              <h3 class="info mb-0">
                 Jour 23 / 55</h3>
          </div>
        </div>
        <div class="progress progress-sm mt-1 mb-0 box-shadow-2">
            <div class="progress-bar bg-gradient-x-info" role="progressbar" style="width: 41%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="120">
            </div>
        </div>
      </div>
    </div>
  </div>
 </div>


    <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
            <i class="ft-heart icon-opacity danger font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
            <span class="d-block mb-1 font-medium-1">Jokers restant</span>
            <h3 class="danger mb-0">
                3
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="col-xl-3 col-lg-6 col-md-12">
    <div class="card">
        <div class="card-content">
            <div class="card-body">
                <div class="media d-flex">
                    <div class="align-self-top">
                        <a href="/dashboard/assignments?locale=fr">
                           <i class="ft-fast-forward icon-opacity warning font-large-4"></i>
</a>                    </div>
                    <div class="media-body text-right align-self-bottom mt-3">
                        <span class="d-block mb-1 font-medium-1">Missions</span>
                            <div class="badge border-danger danger badge-border">Pas inscrit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div class="row">
        <div class="container">
    <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
        <div class="card-header">
        <h1 >Rails intermÃ©diaire
                <i class="fa fa-space-shuttle text-danger"></i>
        </h1>
        
        </div>
        <div class="card-content">
        <div class="card-body">
            <div class="card-text">
            <h2 class="text-center">Pimp du Gossip Project</h2>
            <div class="cd-horizontal-timeline loaded">
                <div class="timeline">
                <div class="events-wrapper">
                    <div class="events" style="width: 1800px;">
                    <ol>
                                <li>
                                    <a style="left:120px;" href="/dashboard/weeks/5/days/1?locale=fr">
                                        Lun
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet Ã  rendre ce jour-lÃ "></i>

</a>                                </li>
                                <li>
                                    <a style="left:240px;" href="/dashboard/weeks/5/days/2?locale=fr">
                                        Mar
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journÃ©e lÃ " ></i>


</a>                                </li>
                                <li>
                                    <a style="left:360px;" href="/dashboard/weeks/5/days/3?locale=fr">
                                        Mer
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                            <li>
                                <a class="selected" style="left:480px;" data-toggle="tooltip" data-placement="top" title="Pimp du Gossip Project" href="/dashboard/weeks/5/days/4?locale=fr">
                                    Jeu
                                        <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet Ã  rendre ce jour-lÃ "></i>

</a>                                </li>
                                <li>
                                    <a style="left:600px;" href="/dashboard/weeks/5/days/5?locale=fr">
                                        Ven
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journÃ©e lÃ " ></i>


</a>                                </li>
                    </ol>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
<div>
  </div>

  <!-- Les fameuses corrections qui n'arrivnet que les jours concernÃ©s -->


    <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Utilisateurs avec mots de passe</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Dans cette ressource, nous allons voir comment gÃ©rer les mots de passe des utilisateurs de ton app Rails. Mais en guise de prÃ©ambule, on va te faire un topo de culture gÃ© en t'expliquant comment les applications web stockent, en gÃ©nÃ©ral, les mots de passe.</p>


<h2>2. Historique</h2>
<p>Tu trouveras ci-dessous quelques Ã©lÃ©ments d'historique sur la science des mots de passe et de leur cryptage.</p>

<h2>3. La ressource</h2>
<h3>3.1. Gestion de mots de passe dans une base de donnÃ©es</h3>
<p>Les mots de passe sont une donnÃ©e ultra sensible qu'il faut bien protÃ©ger au sein des bases de donnÃ©es. Les stocker en clair (non cryptÃ©s) dans une table, c'est pas loin d'Ãªtre la pire idÃ©e du mondeÂ : si jamais tu te fais hacker et que ta base de donnÃ©es est rÃ©vÃ©lÃ©e Ã  la Terre entiÃ¨re, et bien tout le monde peut voir tous les mots de passe et se connecter en lieu et place de tes utilisateurs. Et comme un bon 80Â % des gens utilisent le mÃªme mot de passe pour tous les sites web, n'importe qui pourra accÃ©der Ã  tous leurs comptes. Ã‡a peut lÃ©gÃ¨rement nuire Ã  l'image de ton entreprise. <br>
Morale de l'histoireÂ : on ne stocke <b>jamais</b> de mots de passe en clair dans une base de donnÃ©es.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ¤“ QUESTION RÃ‰CURRENTE</h4>
      <p class="card-text"><b>Jamy, les hacks de bases de donnÃ©es, Ã§a arrive souventÂ ?</b><br>
        Oui, mÃªme aux meilleurs. L'un des plus connus est celui de <a href="https://en.wikipedia.org/wiki/2012_LinkedIn_hack?oldformat=true" target="_blank">LinkedIn</a> en 2012, oÃ¹ tous leurs mots de passe ont Ã©tÃ© Ã©garÃ©s dans la nature. Oups.</p>
        <p>Il existe mÃªme un site nommÃ© <a href="https://haveibeenpwned.com/" target="_blank">have i been pwned?</a> qui te dit si ton adresse e-mail apparaÃ®t dans une des bases de donnÃ©es hackÃ©es et publiÃ©es sur les nombreux forums de hackers. Si l'un des sites hackÃ© a, un jour, stockÃ© ton mot de passe en clair (les chances sont faibles), tu es dans le ğŸ’© et t'as intÃ©rÃªt Ã  vite le modifierâ€¦.</p>
    </div>
  </div>
</div>

<p>Alors, comment font les sites pour stocker ton mot de passe et te permettre de l'utiliser mais sans le connaÃ®tre eux-mÃªmesÂ ? GÃ©nÃ©ralement, ils utilisent ce que l'on appelle une fonction de hashage cryptographique. DerriÃ¨re ce nom stylÃ© (Ã  noter et Ã  ressortir au prochain apÃ©ro avec tes potes) se cache un programme informatique simpleÂ : il va transformer n'importe quel string en une suite de caractÃ¨res du genre <code>900150983cd24fb0d6963f7d28e17f72</code>. On appelle cette suite un "hash" (attention, Ã§a a le mÃªme nom mais c'est trÃ¨s diffÃ©rent des hash comme <code>params</code> qu'on manipule en Ruby depuis le dÃ©but) et il a deux particularitÃ©s importantes :</p>

<ul>
  <li>Un string ne donnera qu'un seul hash (toujours le mÃªme). Un hash identifie un seul et unique string (câ€™est-Ã -dire que si 2 strings ont le mÃªme hash, c'est qu'ils sont strictement Ã©gaux).</li>
  <li>Deux strings assez similaires, vont donner deux hash radicalement diffÃ©rents en sortie. ExempleÂ :
  <ul>
    <li><code>salut</code> va donner <code>3ed7dceaf266cafef032b9d5db224717</code> ğŸ‘‹</li>
    <li><code>salud</code> va donner <code>6776b3dd95bba354801deda2cb769122</code> ğŸ»</li>
  </ul></li>
  <li>Il est trÃ¨s aisÃ© de passer du <code>string</code> au <code>hash</code> mais, thÃ©oriquement, il est impossible (dans un temps raisonnable - moins de quelques dizaines d'annÃ©es quoi) de passer du <code>hash</code> au <code>string</code>.</li>
</ul>

<p>Ces particularitÃ©s permettent de stocker en base les hash, car mÃªme s'ils sont compromis, il sera impossible pour les hackeurs de dÃ©crypter les mots de passe qui se cachent derriÃ¨re. Ainsi, tu es moins flippÃ© de te faire hacker ta BDDÂ : les mots de passe sont protÃ©gÃ©s. OufÂ !</p>

<p>D'accord mais concrÃ¨tement, comment Ã§a fonctionne dans une applicationÂ ? Nous allons stocker dans la table <code>users</code> un string nommÃ© <code>password_digest</code>. Ã€ l'inscription, l'utilisateur va saisir son mot de passe et on va le rÃ©cupÃ©rer via <code>params</code>. Ensuite on va le convertir en hash, et le stocker dans la colonne <code>password_digest</code> (le mot de passe normal est parti aux oubliettes du params). <br>
Finalement, quand il tentera de se connecter, l'utilisateur va envoyer un <code>params</code> contenant un e-mail et un mot de passe en clair. On va Ã  nouveau convertir le mot de passe en hash et le comparer avec celui en base. Si les deux hash sont identiques, c'est que l'utilisateur t'a donnÃ© le bon mot de passeÂ : <a href="https://www.youtube.com/watch?v=jj7BRKHml8g" target="_blank">ACCESS GRANTED</a></p>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ“š INSTANT CULTURE GÃ‰</h4>
      <p class="card-text">Tu l'as donc comprisÂ : un site web digne de ce nom ne doit jamais enregistrer ton mot de passe en clair. Il ne fait que le stocker temporairement dans <code>params</code>, ce dernier Ã©tant vidÃ© de son contenu Ã  chaque changement de page. <br>
      Si jamais, dans ta vie d'utilisateur, tu retrouves ton mot de passe en clair d'une maniÃ¨re ou une autre (en URL, un e-mail qui te renvoie ton mot de passe), c'est que tu as affaire Ã  un beau service <a href="https://www.youtube.com/watch?v=aeePeVUW6-k" target="_blank">codÃ© avec le cul</a> et pas sÃ©curisÃ©. Fuis ces gensÂ ! ğŸƒ</p>
    </div>
  </div>
</div>


<h3>3.2. Gestion de mots de passe en Rails</h3>
<p>Il est possible de gÃ©rer les hash assez facilement dans RailsÂ : la gem <a href="https://github.com/codahale/bcrypt-ruby" target="_blank">bcrypt</a> s'occupe de tout convertir pour toi. Pour ceci tu vas devoir faire quelques manipulations.</p>
<p>On te propose de faire quelques tests tout en suivant le coursÂ : crÃ©Ã© une app Rails <code>test_bcrypt</code>.</p>

<h4>3.2.1. Installer la gem</h4>
<p>Ajoute bcrypt Ã  ton Gemfile, puis <code>bundle install</code></p>
<p><b>Astuce </b>: bcrypt est dÃ©jÃ  dans le Gemfile, il faut juste dÃ©-commenter la ligne. GÃ©nÃ©ralement, c'est bon signe quand tu n'as que Ã§a Ã  faireÂ : c'est que la gem est bien considÃ©rÃ©e comme faisant partie intÃ©grante des fonctionnalitÃ©s courantes d'une app Rails.</p>


<h4>3.2.2. Une migration pour ajouter la colonne du mot de passe</h4>
<p>Il te faut disposer d'un model <code>User</code> avec une table <code>users</code> contenant une colonne <code>password_digest</code> (c'est le hash du password - le mot de passe cryptÃ© - et c'est un string). Pour que l'exemple soit rÃ©aliste, on va aussi ajouter une colonne <code>email</code> (string). Mets cela en place avec la commande de terminal <code>$ rails g model users email:string password_digest:string</code>. Puis passe la migration pour crÃ©er la table (pense Ã  crÃ©er ta BDD si t'es en PostGre ğŸ™„).</p>

<p>A noter que si la table et le model existaient dÃ©jÃ , tu n'aurais eu qu'Ã  faire une migration pour ajouter la colonne <code>password_digest</code> :</p>

<pre><code class="language-ruby">def change
  add_column :users, :password_digest, :string
end</code></pre>

<h4>3.2.3. Mentionner la gestion des mots de passe dans le model</h4>
<p>Dans ton model <code>User</code>, tu vas indiquer que bcrypt est en charge de gÃ©rer et hasher les mots de passe. Pour cela, rajoute la ligneÂ : </p>

<pre><code class="language-ruby">class User < ApplicationRecord
  has_secure_password
end</code></pre>

<p>Ã€ prÃ©sent, bcrypt est fonctionnel et te met Ã  disposition les fonctionnalitÃ©s suivantes :</p>
<ul>
  <li>Si tu fais <code>my_user = User.create(password: "foobar")</code>, un user va Ãªtre crÃ©Ã© et bcrypt transformera "foobar" en hash sÃ©curisÃ© qui sera stockÃ© dans <code>password_digest</code>.</li>
  <li>Si tu as un objet de typer <code>User</code>, tu peux demander Ã  bcrypt de vÃ©rifier si un string correspond Ã  son mot de passe. Pour cela, si l'objet porte le nom <code>my_user</code>, tapes : <code>my_user.authenticate("test de mot de passe")</code>. <br>
  => Si ce mot de passe ne correspond pas Ã  celui cryptÃ©, bcrypt te retourne <code>false</code> <br>
  => Sâ€™il correspond, bcrypt te retourne tout simplement l'objet <code>my_user</code>.</li>
  <li>Enfin, tu peux faire comme prÃ¨s de 100Â % des sites sur Terre et demander, Ã  l'inscription, un password et sa confirmation. Dans ce cas-lÃ , tu peux faire <code>User.create(password: "motdepasse", password_confirmation: "laconfirmation")</code> et bcrypt n'enregistrera un utilisateur en base QUE si password et password_confirmation sont identiques. Sinon Rollback.</li>
</ul>

<p> Ã‰videmment, tu peux aussi rajouter une contrainte sur le mot de passe, par exemple refuser qu'il soit vide ou trop court. Pour rappel, c'est simple Ã  implÃ©menter avec la ligne suivante dans le model <code>User</code>Â : <code>validates :password, presence: true, length: { minimum: 6 }</code>.</p>

<h4>3.2.4. Tests en console</h4>
<p>Ton model est prÃªt, et tu n'auras plus qu'Ã  brancher les bonnes mÃ©thodes de controller. Testons ceci en console :</p>

<pre><code class="language-ruby">>> u = User.create(email: "email@example.com", password: "foobar")
=> #&lt;User id: 1, email: "email@example.com", password_digest: "$2a$10$T2/g3aj1LS6KUBZts69Yaeeq62oijKnL0VXtsL0Jd5S...", <br> created_at: "2019-02-05 14:31:30", updated_at: "2019-02-05 14:31:30">

>> my_user = User.find_by(email: "email@example.com")
>> my_user.password
=> nil

>> my_user.password_digest
=> "$2a$10$2a$10$T2/g3aj1LS6KUBZts69Yaeeq62oijKnL0VXtsL0Jd5S"

>> my_user.authenticate("not_the_right_password")
false
>> my_user.authenticate("foobaz")
false

>> my_user.authenticate("foobar")
=> #&lt;User id: 1, email: "email@example.com", created_at: "2016-05-23 20:36:46", updated_at: "2016-05-23 20:36:46", <br> password_digest: "$2a$10$xxucoRlMp06RLJSfWpZ8hO8Dt9AZXlGRi3usP3njQg3..."></code></pre>

<h4>3.2.5. Quels impacts sur une app RailsÂ ?</h4>
<p>Ces points seront mis en pratique plus tard, mais on t'en parle dÃ¨s Ã  prÃ©sent.</p>
<h5>a) Pour crÃ©er un utilisateur</h5>
<p>Par rapport Ã  ce qu'on a vu jusque-lÃ , la mÃ©thode <code>#create</code> du controller <code>users</code> ne change quasiment pas. Simplement, il faut rÃ©cupÃ©rer le mot de passe depuis le formulaire d'inscription (via <code>params</code>) et faire un simple <code>User.new(email: "xxx", password: "yyy")</code>. La gem bcrypt s'occupe de tout cÃ´tÃ© model pour encrypter le passwordÂ : Fat model, skinny controllerÂ !</p>

<h5>b) Pour qu'un utilisateur se connecte</h5>
<p>Il faut mettre en place un formulaire de connexion (e-mail + mot de passe), en rÃ©cupÃ©rer les infos (via <code>params</code>) et utiliser dans le controller les mÃ©thodes <code>.find_by(email: xx)</code> (pour identifier l'utilisateur d'aprÃ¨s son e-mail) et <code>.authenticate(xxxx)</code> (pour vÃ©rifier si le mot de passe correspond). Reporte-toi Ã  l'exemple de la console ci-dessus si nÃ©cessaire.</p>
<p>Si on trouve bien un utilisateur Ã  cet e-mail et que le mot de passe correspond, on peut le laisser se connecter en ouvrant une session avec <code>session[:user_id] = my_user.id</code>. Reporte-toi Ã  la ressource sur les sessions pour en savoir plus.</p>


<h2>4. Points importants Ã  retenir</h2>
<p>Il ne faut <b>jamais</b> stocker un mot de passe en clair, mais dans un hash sÃ©curisÃ©.</p>
<p>Sur Rails, la gem bcrypt s'occupe de produire le hash. Tu n'as qu'Ã  l'installer puis faire les Ã©tapes suivantes :</p>

<ul>
  <li>Faire une migration pour ajouter Ã  <code>users</code> une colonne <code>password_digest</code> qui est un string</li>
  <li>Ajouter la ligne <code>has_secure_password</code> dans le model des utilisateurs</li>
  <li>Ã‰ventuellement faire une validation pour le <code>password</code> avec presence true et minimum de caractÃ¨re fixÃ© Ã  6 (ce que proposent tous les sites sÃ©rieux)</li>
</ul>

<p>C'est tout ğŸ˜. A partir de lÃ , bcrypt s'occupe de crypter les mots de passe dans <code>password_digest</code>.</p>
<p>Tu peux alors jouer avec des <code>my_user = User.create(password: "foobar")</code>, des <code>my_user.authenticate("test de mot de passe")</code> ou encore des <code>User.create(password: "motdepasse", password_confirmation: "laconfirmation")</code>.</p>

<h2>5. Pour aller plus loin</h2>

<p>Pour complÃ©ter notre explication sur les mots de passe, je te propose deux vidÃ©os de <a href="https://www.youtube.com/channel/UC9-y-6csu5WGm29I7JiwpnA" target="_blank">ComputerPhile</a> sur les gestions de mots de passeÂ :

<ul>
  <li><a href="https://www.youtube.com/watch?v=8ZtInClXe1Q" target="_blank">Comment stocker ses mots de passe</a></li>
  <li><a href="https://www.youtube.com/watch?v=7U-RbOKanYs" target="_blank">Comment hacker des mots de passe</a></li>
</ul>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : CrÃ©er des sessions et ses propres helpers</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Dans cette ressource, tu vas voir comment gÃ©rer un utilisateur connectÃ© sur ton site web. Chacune des actions qu'il entreprendra seront alors considÃ©rÃ©es comme provenant de luiÂ : il pourra Ã©crire des potins dont il sera directement l'auteur, modifier son profil, etc. Oh yeahÂ !</p>

<p>L'Ã©lÃ©ment central qui va permettre de gÃ©rer cela, ce sont les sessions. Nous te montrerons comment mettre en place tes propres helpers afin d'appeler facilement des mÃ©thodes que tu souhaites utiliser sur presque toutes les views. Finalement, nous te prÃ©senterons le <code>before_action</code> qui permet d'effectuer, au sein des controllers, des tÃ¢ches avant mÃªme que la mÃ©thode appelÃ©e ne soit exÃ©cutÃ©e.</p>

<h2>2. Historique et contexte</h2>
<p>Ce cours va t'apprendre Ã  implÃ©menter toi-mÃªme une session "utilisateur connectÃ©" sur Rails afin de stocker des informations jusqu'Ã  dÃ©connexion de l'utilisateur. Dans quelques jours, on te prÃ©sentera, une gem (Devise) qui automatisera la mise en place des sessions utilisateurs. Mais il est toujours intÃ©ressant, pour les concepts importants comme celui-ci, de l'avoir implÃ©mentÃ© au moins une fois soi-mÃªme avant d'apprendre la mÃ©thode raccourcie / automatisÃ©e.</p>

<h2>3. La ressource</h2>

<h3>3.1. Les sessions</h3>
<h4>3.1.1. Introduction aux sessions</h4>
<p>Quand tu vas sur Facebook, que tu te connectes, et que tu navigues sur le site, ce dernier se souvient que tu es connectÃ© bien que tu passes de page en page. Cette magie noire est plutÃ´t simple Ã  mettre en placeÂ : Facebook stocke sur ton navigateur une petite information qui indiquera, Ã  chaque chargement de page, que tu es l'utilisateur numÃ©ro XXXX. Cette information est souvent stockÃ©e sous la forme de cookiesÂ : entre aujourd'hui et demain, nous allons t'apprendre Ã  coder toi-mÃªme un systÃ¨me de cookies. La premiÃ¨re Ã©tape est de comprendre les sessions.</p>

<p>En Rails, <code>session</code> est un hash qui est stockÃ© dans un coin du navigateur web et qui va suivre le visiteur tout au long de sa navigation. Il est grosso modo crÃ©Ã© quand ce dernier arrive sur ton site, et est dÃ©truit quand il ferme son navigateur. Ã€ l'inverse de <code>params</code>, qui se vide de son contenu Ã  chaque changement de page, le hash <code>session</code> conserve les informations jusqu'Ã  fermeture du navigateur. <br>
En tant qu'application, tu peux Ã©crire et lire Ã  volontÃ© sur <code>session</code>. Si par exemple tu fais <code>session[:salut] = "Message sympa"</code> dans la mÃ©thode d'un controller, tu pourras retrouver cette info dans un autre controller (par exemple avec <code>puts session[:salut]</code>). Mais l'usage le plus courant de <code>session</code> est de stocker l'<code>id</code> de l'utilisateur actuellement connectÃ©. Ainsi, Ã  chaque nouvelle page chargÃ©e, on pourra retrouver quel utilisateur est en train de la visualiser. Tu feras Ã§a dans tes controllers avec les lignes suivantes :</p>

<pre><code class="language-ruby">id = session[:user_id]
@user = User.find(id) #et hop, cette variable @user est l'instance User contenant toutes les infos de l'utilisateur connectÃ©</code></pre>

<p>Pour gÃ©rer les connexions Ã  ton app Rails, on va gÃ©rer des "sessions" via un <code>sessions_controller</code> qui contiendra les mÃ©thodes avec <code>#new</code>, <code>#create</code>, et <code>#destroy</code>. </p>
<ul>
  <li>La crÃ©ation d'une session se fera au travers de la page de login oÃ¹ l'on demande mot de passe et email. </li>
  <li>Puis la mÃ©thode <code>#create</code> va s'occuper d'essayer d'authentifier l'utilisateur avec le couple email-mot de passe. Si ce dernier est bien authentifiÃ©, nous stockerons l'info avec <code>session[:user_id] = user.id</code>. S'il n'est pas bien authentifiÃ©, on fera un render de la page de login avec les messages d'erreur.</li>
  <li>Une fois l'utilisateur connectÃ©, ce sera trÃ¨s simple de retrouver notre utilisateur grÃ¢ce Ã  <code>User.find(session[:user_id])</code> </li>
</ul>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Tu peux t'amuser Ã  voir tes sessions et cookies dans Inspecteur d'Ã©lÃ©ments -> Application -> Storage -> Cookies -> Localhost:3000. Si tu supprimes le hash <code>session</code>, c'est comme si tu fermais ton navigateurÂ !</p>
      <p>De plus, Ã©tant donnÃ© que les cookies temporaires de <code>session</code> sont automatiquement chiffrÃ©s, faire <code>User.find(session[:user_id])</code> pour rÃ©cupÃ©rer un utilisateur est sÃ©curisÃ©. Ce n'est pas possible pour un hacker d'utiliser les informations de <code>session</code> pour usurper ton identitÃ©. Par contre, les cookies permanents sont moins sÃ©curisÃ©sÂ : ils sont vulnÃ©rables Ã  une attaque au dÃ©tournement de session, et nous verrons demain comment Ãªtre prudent en les utilisant.</p>
    </div>
  </div>
</div>

<h4>3.1.2. sessions_controller</h4>
<p>Ici, une session n'est pas un objet en soi. Il n'existe pas de model <code>Session</code> ni d'enregistrement dans la base de donnÃ©e. En fait, on considÃ¨re qu'une session est crÃ©Ã©e Ã  l'instant oÃ¹ un utilisateur se connecte Ã  son compte sur ton site webÂ : on a alors une information dans le hash <code>session[:user_id]</code>. Si personne n'est connectÃ©, il n'y a pas de session et <code>session[:user_id] = nil</code>.</p>

<p>Une session utilisateur pouvant Ãªtre crÃ©Ã©e ou supprimÃ©e, il semble logique d'en confier la gestion Ã  un controller Ã  part entiÃ¨re. Il s'agira de <code>sessions_controller</code> et il disposera de trois mÃ©thodes :</p>

<ul>
  <li><code>#new</code> qui correspond Ã  la page de login</li>
  <li><code>#create</code> qui effectuera l'authentification (traitement des informations saisies dans la page login et sauvegarde de l'info de l'utilisateur connectÃ© dans <code>session</code>)</li>
  <li><code>#destroy</code> qui correspond au logout</li>
</ul>

<p>Les routes seront celles habituelles, grÃ¢ce Ã  un <code>resources :sessions, only: [:new, :create, :destroy]</code>.</p>

<h5>a) new et create</h5>
<p>La view new va juste demander lâ€™e-mail et le mot de passe Ã  l'utilisateur via un formulaire, ce dernier pointant vers la mÃ©thode create. </p>
<p>La mÃ©thode <code>create</code> ressemblera Ã  ceci :</p>

<pre><code class="language-ruby">def create
  # cherche s'il existe un utilisateur en base avec lâ€™e-mail
  user = User.find_by(email: email_dans_ton_params)

  # on vÃ©rifie si l'utilisateur existe bien ET si on arrive Ã  l'authentifier (mÃ©thode bcrypt) avec le mot de passe 
  if user && user.authenticate(password_dans_ton_params)
    session[:user_id] = user.id
    # redirige oÃ¹ tu veux, avec un flash ou pas

  else
    flash.now[:danger] = 'Invalid email/password combination'
    render 'new'
  end
end</code></pre>

<h5>b) utiliser ensuite l'info de <code>session</code></h5>
<p>GrÃ¢ce au <code>create</code> de <code>sessions_controller</code>, on a pu stocker l'<code>id</code> de l'utilisateur actuellement connectÃ©. <br>
Maintenant, Ã  partir de cet <code>id</code>, tu peux remonter Ã  l'utilisateur pour avoir ses infos. Par exemple tu peux faire une view <code>/profile</code> qui aura comme code :</p>
<pre><code class="language-html">&lt;h2>Bienvenue &lt;%= User.find_by(id: session[:user_id]).first_name %> !&lt;/h2></code></pre>

<p>Ou alors crÃ©er un potin et le lier immÃ©diatement Ã  l'utilisateur connectÃ© (qui est forcÃ©ment l'auteur), en mettant dans la mÃ©thode <code>create</code> de <code>gossips_controller</code> :</p>
<pre><code class="language-ruby">def create
  @gossip = Gossip.create(gossip_params)
  @gossip.user = User.find_by(id: session[:user_id])
  if @gossip.save
    flash[:success] = "Potin bien crÃ©Ã©Â !"
    redirect_to root_path
  else
    render :new
  end
end</code></pre><br>

<p>Cette faÃ§on de faire est tout Ã  fait fonctionnelle, mais tu remarques dÃ©jÃ  qu'on Ã©crit plusieurs fois <code>User.find_by(id: session[:user_id])</code>. Et c'est pas trÃ¨s DRY de se rÃ©pÃ©ter en Rails ! <br>
Nous verrons plus loin comment remplacer ce code par un simple appel Ã  une mÃ©thode <code>current_user</code> qui fera la mÃªme chose.</p>

<h5>c) destroy</h5>
<p>Destroy permet de dÃ©connecter l'utilisateur. Cliquer sur le bouton "Se dÃ©connecter" revient Ã  supprimer le contenu de <code>session[:user_id]</code>. <br>
Le lien de ton bouton "Se dÃ©connecter" devrait ressembler Ã  ceci :</p>

<pre><code class="language-html">&lt;%= link_to "Se dÃ©connecter", session_path(session[:user_id]), method: :delete %></code></pre>

<p>Ce qui a pour effet d'appeler la mÃ©thode <code>#destroy</code> de ton sessions_controller. Cette mÃ©thode devrait ressembler Ã  ceci :</p>

<pre><code class="language-ruby">def destroy
  session.delete(:user_id)
end</code></pre>


<h3>3.2. Les helpers</h3>
<h4>3.2.1. Introduction</h4>
<p>Nous allons apprendre Ã  changer un <code>User.find_by(id: session[:user_id])</code> en un plus simple <code>current_user</code> avec deux raisons en tÃªte :</p>

<ol>
  <li>En Rails, c'est <b>le mal</b> de faire un appel au model (= une requÃªte SQL) dans une vue. C'est le rÃ´le du controllerÂ ! Le moindre <code>find</code> dans la view et c'est <code>-30</code> points en test technique.</li>
  <li>En Rails on aime le code bien DRY et bien lisible. <code>current_user</code> c'est trÃ¨s lisible et plus court que l'autre pÃ¢tÃ©.</li>
</ol>

<p>Pour refactorer (= condenser) de cette faÃ§on notre code, nous allons passer par un helper. Les helpers se rangent dans le dossier <code>app/helpers/</code>Â : ils ont pour mission de crÃ©er des mÃ©thodes pour remplacer les bouts de code qu'on utilise frÃ©quemment. Tout ce que tu as Ã  faire, c'est de mettre dans ton controllerÂ : </p>

<pre><code class="language-ruby">class TonController < ApplicationController
  include TonHelper
end</code></pre>

<p><code>TonHelper</code> correspond au fichier <code>app/helpers/ton_helper.rb</code> qui devrait ressembler Ã  ceci :</p>

<pre><code class="language-ruby">module TonHelper
  def some_method
    # une mÃ©thode et son code
  end
end</code></pre>

<h4>3.2.2. SessionsHelper</h4>
<p>Nous allons donc crÃ©er un helper pour les sessions des utilisateurs. Toutefois, il faut savoir qu'on va y faire appel dans quasiment TOUS les controllers et se taper un <code>include SessionsHelper</code> dans chacun d'eux, Ã§a va vite Ãªtre fastidieux. La solution, c'est de rajouter la ligne dans <code>app/controllers/application_controller.rb</code> qui est, en quelque sorte, le parent de tous les controllers. <br>
Si tu es perspicace, tu auras notÃ© que chaque controller commence par la ligne <code>class TonController < ApplicationController</code>Â : en fait ils hÃ©ritent tous de <code>ApplicationController</code>Â ! Au final, c'est un peu le controller ultimeÂ : tout ce qui est Ã©crit dedans, tu peux considÃ©rer qu'il est Ã©crit dans chaque controller.</p>
<p>Donc une fois la ligne rajoutÃ©e, il faut crÃ©er un fichier <code>app/helpers/sessions_helper.rb</code> et y mettre les lignes suivantes :</p>

<pre><code class="language-ruby">module SessionsHelper
   def current_user
    User.find_by(id: session[:user_id])
  end

   def log_in(user)
    session[:user_id] = user.id
  end

end</code></pre>

<p>Et voilÃ Â ! Maintenant tu peux appeler <code>current_user</code> dans n'importe quel controller ou view, et cette mÃ©thode te retournera l'instance de <code>User</code> contenant les infos de ton utilisateur connectÃ©.</p>

<p> Tu noteras mÃªme qu'on s'est amusÃ©s Ã  faire une mÃ©thode <code>login(user)</code>, qui nous servira Ã  connecter facilement l'utilisateur. Ã‡a permet de l'appeler Ã  la page login mais aussi juste aprÃ¨s la crÃ©ation d'un nouvel utilisateur (par exemple).</p>


<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">âš ï¸ ALERTE ERREUR COMMUNE</h4>
      <p>Dans ta view, tu pourrais Ãªtre tentÃ© d'Ã©crire direct des <code>current_user.email</code>. Mais il faut gÃ©rer les 2 casÂ : 1) un utilisateur est connectÃ© et 2) personne n'est connectÃ©. LÃ , si personne n'est connectÃ©, tu auras un joli <code>undefined method `email' for nil:NilClass</code>. <br>
      Pour Ã©viter Ã§a, prÃ©voit de rajouter un <code>if current_user</code>, ou mÃªme coder une mÃ©thode <code>logged_in?</code> dans le helper. Cette mÃ©thode te retournerait <code>true</code> si <code>session[:user_id]</code> est non-nil et <code>false</code> dans le cas contraire.</p>
    </div>
  </div>
</div>



<h3>3.3. Utiliser <code>before_action</code></h3>
<p>Prenons l'exemple d'une page qui ne peut Ãªtre accessible QUE par un utilisateur connectÃ© (par exemple une page en <code>/dashboard</code>). Comment mettre en place un filtre pour rejeter les personnes non connectÃ©esÂ ? Ã‡a c'est une mission pour le controllerÂ ! Eh bien c'est exactement le taf du controllerÂ ! Ce dernier va vÃ©rifier si l'utilisateur est login, et puis il va le rediriger vers la page de login s'il n'est pas connectÃ©. </p> 
<p>On pourrait imaginer de faire quelque chose comme Ã§a dans la mÃ©thode qui pointe vers <code>/dashboard</code> :</p>

<pre><code class="language-ruby">def index
unless current_user
  flash[:danger] = "Please log in."
  redirect_to new_session_path
else
  # on code quelque chose qui permet d'afficher le dashboard de l'utilisateur
end</code></pre>

<p>Sauf qu'on peut faire Ã§a beaucoup plus proprement. La bonne faÃ§on de le prÃ©senter, c'est de faire Ã§a dans une mÃ©thode privÃ©e <code>authenticate_user</code>, et de l'appeler EN AMONT de la mÃ©thode du controller, grÃ¢ce Ã  un callback <code>before_action</code>. Voici le rÃ©sultat :</p>

<pre><code class="language-ruby">class TonController < ApplicationController
  before_action :authenticate_user, only: [:index]

  def index
    # on code quelque chose qui permet d'afficher le dashboard de l'utilisateur
  end

  private

  def authenticate_user
    unless current_user
      flash[:danger] = "Please log in."
      redirect_to new_session_path
    end
  end

end</code></pre>

<p>GrÃ¢ce Ã  ce magnifique callback, Ã  chaque fois que la mÃ©thode index de ton controller est appelÃ©e, la mÃ©thode <code>authenticate_user</code> va Ãªtre exÃ©cutÃ©e en amont. Elle filtrera les utilisateurs non connectÃ©s pour les rediriger vers la page loginÂ : en quelques lignes tu viens de sÃ©curiser ton applicationÂ !</p>

<h2>4. Points importants Ã  retenir</h2>
<p>Tu peux stocker des informations au sein du hash <code>session</code>. Son contenu est conservÃ© jusqu'Ã  fermeture du navigateur.</p>
<p>Pour gÃ©rer la connexion / dÃ©connexion des utilisateurs Ã  leur compte, il faut crÃ©er un controller <code>sessions_controller</code> contenant les mÃ©thodes <code>#new</code>, <code>#create</code> et <code>#destroy</code>.</p>
<p>Ces mÃ©thodes vont permettre de stocker l'<code>id</code> de l'utilisateur connectÃ© dans <code>session[:user_id]</code></p>
<p>Les helpers se rangent dans le dossier <code>app/helpers/</code>Â : ils ont pour mission de crÃ©er des mÃ©thodes pour remplacer les bouts de code qu'on utilise frÃ©quemment. Par exemple, le fait de rÃ©cupÃ©rer l'identitÃ© de l'utilisateur connectÃ© avec <code>current_user</code>.</p>
<p>Les helpers utilisÃ©s dans de nombreux controllers peuvent Ãªtre rajoutÃ©s Ã  <code>ApplicationController</code> via un <code>include TonHelper</code>. </p>
<p>Le callback <code>before_action :authenticate_user, only: [:index]</code> permet d'exÃ©cuter la mÃ©thode <code>authenticate_user</code> AVANT une mÃ©thode du controller (ici la mÃ©thode <code>index</code>). </p>

<h2>5. Pour aller plus loin</h2>
<p>Nous verrons demain comment faire les cookies permanents.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Les tests d&#39;intÃ©gration</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Jusqu'Ã  prÃ©sent, tu as vu les tests unitaires, c'est Ã  dire les tests des Ã©lÃ©ments de ton application. Tu as vu comment faire des models solides et tester ces models. Tu as vu comment faire des vues et pouvoir les tester.</p>

<p>Les tests d'intÃ©gration permettent de tester une <i>user story</i>, c'est Ã  dire un parcours utilisateur. En gros ils permettent de vÃ©rifier que les bouts de ton application son bien imbriquÃ©s entre eux.</p>

<h2>2. Historique</h2>
<p>Toute application en Rails qui se respecte a deux types de tests :</p>

<ul>
	<li>Les tests unitaires, que tu as vus</li>
	<li>Les tests d'intÃ©gration, que tu vas voir aujourd'hui</li>
</ul>

<h2>3. La ressource</h2>
<h3>3.1. Tests unitaires vs. tests d'intagration</h3>
<p>Les tests unitaires permettent de tester des parties bien prÃ©cises de ton application : la mÃ©thode <code>x</code> du controller <code>n</code>, la view <code>new.html.erb</code> de telle ressource, ou encore les models. Ils permettent de connaÃ®tre de maniÃ¨re chirurgicale les endroits oÃ¹ ton application va planter (tel controller n'a pas redirigÃ© l'utilisateur vers la page d'accueil car tu l'as mal paramÃ©trÃ©).</p>

<p>Les tests d'intÃ©gration vont tester ton application haut-niveau, c'est Ã  dire ils vont simuler un utilisateur qui se balade sur ton application et qui fait ce que tes utilisateurs vont faire : s'inscrire, se connecter, s'enregistrer Ã  une session, etc. Par exemple, pour tester le <i>signup</i>, nous allons tester un visiteur qui va sur le site, qui clique sur "S'inscire", qui remplit le formulaire, qui clique sur envoyer, puis qui est redirigÃ© vers la page post inscription (un dashboard, ou une vue profil par exemple).</p>

<p>Les tests unitaires et les tests d'intÃ©gration ont chacun leurs avantages et leur dÃ©fauts. Une application bien testÃ©e aura les deux types de tests.</p>

<p>Pour mieux te renseigner sur les avantages et dÃ©fauts de chacun des tests, permets-moi de te proposer <a href="https://www.youtube.com/watch?v=vqAaMVoKz1c" target="_blank">cette vidÃ©o</a> de Mattias Petter Johansson qui explique Ã  merveille la diffÃ©rence et l'importance des deux types de tests.</p>

<h3>3.2. Les tests d'intÃ©gration en Rails</h3>
<h4>3.2.1. Rspec, Capybara</h4>
<p>Pour Rspec, les tests d'intÃ©gration vont se faire dans le dossier <code>spec/features/ce_que_tu_veux_faire.rb</code>. Voici quelques exemples de tests d'intÃ©gration importants :</p>

<ul>
	<li>Un test pour l'inscription Ã  ton site
	<ul>
		<li>Une inscription qui rÃ©ussit</li>
		<li>Mais aussi une qui rate (le site doit renvoyer une erreur et dire que l'email est dÃ©jÃ  pris / il manque le champ mot de passe / autre)</li>
	</ul></li>
	<li>Un test pour le login Ã  ton site
	<li>Tester la fonctionnalitÃ© principale ou Happy Path de ton application : faire une rÃ©servation sur Doctolib, commander une voiture sur Uber, regarder un film su Netflix</li>
	<li>Tester une fonctionnalitÃ© plus prÃ©cise, mais toute aussi importante : pouvoir annuler une rÃ©servation sur Doctolib, pouvoir liker un post sur Facebook, avoir un Ã©cran qui affiche les bonnes recommandations sur Netflix</li>
</ul>


<p>Rails est normalement Ã©quipÃ© d'une Gem qui permet de lancer des tests d'intÃ©gration : <a href="https://github.com/teamcapybara/capybara" target="_blank">Capybara</a>. Cette Gem permet de simuler trÃ¨s rapidement une page Rails (sans JavaScript) pour tester qu'il est possible de s'enregistrer etc. C'est une version plus rapide Ã  s'exÃ©cuter que Watir. VÃ©rifie bien que tu as Capybara dans le groupe de tests de Rails, et ajoute la Gem si ce n'est pas le cas.</p>

<h4>3.2.2. Des exemples de tests d'intÃ©gration en Rails</h4>
<p>Voici un exemple simple de test d'intagration en Rspec qui teste que le signup marche bien :</p>

<pre><code class="language-ruby">describe "the signup process", type: :feature do
  before :each do
    User.make(email: 'user@example.com', password: 'password')
  end

  it "signs me in" do
    # on va sur la page de crÃ©ation d'utilisateurs
    visit '/users/new'

    # dans le formulaire des users, on remplit les donnÃ©es qu'il faut
    within("#user") do
      fill_in 'Email', with: 'user@example.com'
      fill_in 'Password', with: 'password'
    end

    # clik clik
    click_button 'Sign in'

    # la page affichÃ©e devrait afficher des bonnes nouvelles
    expect(page).to have_content 'Success'
  end
end</code></pre>


<p>Enfin, voici des ressources pour avoir quelques exemples de bonnes pratiques pour les tests d'intÃ©gration :</p>

<ul>
	<li>As usual, ThoughBot sont les champions, <a href="https://thoughtbot.com/blog/rspec-integration-tests-with-capybara" target="_blank">voici un article au sujet des tests d'intÃ©gration de leur part</a></li>
	<li>La documentation officielle <a href="https://relishapp.com/rspec/rspec-rails/docs/feature-specs/feature-spec" target="_blank">peut aussi bien t'aider</a></li>
	<li>Rob Race a Ã©crit <a href="https://hackernoon.com/your-guide-to-testing-in-ruby-on-rails-5-c8bd122e38ad" target="_blank">un article sur les tests</a> sur HackerNoon</li>
</ul>

<h2>4. Points importants Ã  retenir</h2>
<p>Une application bien testÃ©e doit avoir des tests d'intÃ©gration (qui testent les parcours utilisateurs) et des tests unitaires (qui testent de maniÃ¨re trÃ¨s prÃ©cises les parties importantes de ton application).</p>

<p>Si ton application devait ne contenir que 4 tests, les voici :</p>

<ul>
	<li>Un test d'intÃ©gration de ton happy path</li>
	<li>Un test unitaire de la mÃ©thode de controller importante pour ton happy path (<code>appointments#create</code> pour les RDV mÃ©dicaux de Doctolib, etc)</li>
	<li>Des tests unitaires pour que le model important marchent bien (User, Appoi)</li>
	<li>La view concernÃ©e par le happy path</li>
</ul>



<h2>5. Pour aller plus loin</h2>
<p>RÃ S pour le moment.</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>


  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #FF4081 " >
          <h1>Projet : Gossip Project : Facebook style</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Ã‡a y est ! Tu commences Ã  maÃ®triser les fondamentaux de Rails, les termes de MVC, routes, params et bases de donnÃ©es te sont familiers et tu commences Ã  Ãªtre fier des quelques applications que tu as mis en production cette semaine.</p>

<p>Aujourd'hui, nous allons un peu plus loin avec notre application Gossip Project, en rajoutant des features un peu plus stylÃ©es que tu pourras peut-Ãªtre rÃ©utiliser pour l'architecture de ton projet final.</p>
<p>Pour commencer, tu peux reprendre ton app d'hier car la base de donnÃ©es reste globalement la mÃªme.</p>

<p>Ce projet sera peu guidÃ©, je vais juste te donner une liste de fonctionnalitÃ©s que ton app devra avoir et tu vas les implÃ©menter. Celles-ci reprendrons essentiellement ce que tu as vu cette semaine et la semaine derniÃ¨re.</p>

<p>Voici ce que tu vas devoir implÃ©menter dans l'application :</p>

<ul>
	<li>Nous allons commencer par un CRUD succinct des utilisateurs : crÃ©ation</li>
	<li>Nous allons mettre en place un systÃ¨me de login / logout avec une page de connexion</li>
	<li>Nous allons faire en sorte que les potins crÃ©Ã©s soient associÃ©s Ã  l'utilisateur en cours, idem pour les commentaires</li>
	<li>Nous allons rendre impossible la crÃ©ation de potin si l'utilisateur n'est pas connectÃ©. Idem pour <code>show</code> du potin</li>
	<li>Ã‰dition et destruction des potins</li>
	<li>Puis nous allons mettre en place le systÃ¨me de likes</li>
</ul>


<h2>2. Le projet</h2>

<h3>2.1. CrÃ©ation d'utilisateurs</h3>
<p>Fais donc une crÃ©ation d'utilisateur, avec la notion de mot de passe. Bien entendu, le mot de passe ne sera pas stockÃ© en clair dans ta base de donnÃ©es.</p>

<p>Le lien pour s'inscrire devra Ãªtre sur la navbar. Et une fois l'utilisateur inscrit l'utilisateur sera redirigÃ© vers la page d'accueil.</p>

<h3>2.2. Login / logout</h3>
<h4>2.2.1. Login</h4>
<p>Nous allons mettre un Ã©cran de connexion Ã  l'application qui demandera email et mot de passe. Cet Ã©cran va crÃ©er une session si tu arrives Ã  authentifier l'utilisateur avec l'email ou le mot de passe, puis le rediriger vers la page d'accueil s'il arrive Ã  se connecter. Cela sera reliÃ© au <code>sessions_controller</code> (mÃ©thodes <code>#new</code> et <code>#create</code>)</p>

<p>Aussi, Ã  la crÃ©ation de l'utilisateur, il faut login l'utilisateur.</p>

<h4>2.2.2. Logout</h4>
<p>Maintenant il faut faire <code>sessions#destroy</code>. Code la mÃ©thode.</p>


<h4>2.2.3. Login / Signup</h4>
<p>Dans la majoritÃ© des sites (le notre inclus), tu pourras retrouver en haut Ã  droite un bouton qui change en fonction de l'Ã©tat de l'utilisateur

<ul>
	<li>Si l'utilisateur n'est pas connectÃ©, il y aura un  <a href="https://getbootstrap.com/docs/4.0/components/dropdowns/" target="_blank">dropdown</a> "S'inscrire / Se connecter", avec un bouton pour lien (<code>users#new</code>) et un lien pour se connecter (<code>sessions#new</code>)</li>
	<li>Si l'utilisateur est connectÃ©, il y aura un bouton pour se dÃ©connecter (<code>sessions#destroy</code>)</li>
</ul>

<p>Ta mission est mettre en place ceci.</p>

<h3>2.3. CrÃ©ation des potins</h3>
<p>Quand tu crÃ©Ã©s un potin, ce dernier est associÃ© Ã  un utilisateur de ta base. Arrange-toi pour faire en sorte que le potin crÃ©Ã© soit associÃ© Ã  l'utilisateur connectÃ©. Fais de mÃªme avec les commentaires.</p>

<h3>2.4. Impossible de commÃ©rer sans inscription</h3>
<p>Si actuellement tu crÃ©es un potin alors que le visiteur n'est pas connectÃ©, cela va te renvoyer un bug. C'est pas incroyable. Il faut donc faire en sorte que les mÃ©thodes <code>#new</code> et <code>#create</code> vÃ©rifient que l'utilisateur est bien connectÃ© avant de se lancer. Si ce dernier n'est pas connectÃ©, l'application devra le renvoyer vers l'Ã©cran de login. Fais la mÃªme pour l'affichage du potin, et la crÃ©ation de commentaires.</p>



<p>indice : <code>before_action</code></p>



<h3>2.5. Ã‰dition et destruction des potins</h3>
<p>Pour le moment, tout le monde peut Ã©diter un potin. Arrange-toi pour que le bouton pour pouvoir Ã©diter le potin n'apparaisse QUE si l'utilisateur connectÃ© est le crÃ©ateur du potin. De plus, les mÃ©thodes <code>gossips#edit</code>, <code>gossips#update</code> et <code>gossips#destroy</code> doivent vÃ©rifier que le current_user soit bien le crÃ©ateur du potin : impossible de faire ces actions (afficher le formulaire d'Ã©dition du potin, pouvoir Ã©diter le potin, pouvoir dÃ©truire le potin) si ce n'est pas le crÃ©ateur qui le fait !</p>


<h3>2.6. Like that</h3>
<p>Nous allons mettre en place un systÃ¨me de likes, yahou ! Il faut que l'on soit capable de liker un potin sur la page d'index des potins, sur la page des villes (qui affiche les potins pour une ville donnÃ©e), ainsi que sur la page d'affichage d'un potin.</p>

<p>Le like sera attribuÃ© Ã  l'utilisateur en cours (comme Facebook) donc il est impossible de liker si le visiteur n'est pas connectÃ©. Enfin, sur les pages mentionnÃ©es plus haut, insÃ¨re aussi un petit espace qui dit le nombre de likes d'un potin.</p>

<p>Pour finir : il est possible de dÃ©liker un potin.</p>


<h2>3.Rendu attendu</h2>
<p>Un gossip project qui dÃ©chire !</p>

<p>âš  il est <b>interdit</b> d'utiliser une gem d'authentification comme Devise ou Clearance. Seule bcrypt est autorisÃ©e.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>



</div>


  </div>
</div>
    <script src="/packs/dashboard-031178fac0de4f91cbcc.js"></script>
    

    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  </body>
</html>

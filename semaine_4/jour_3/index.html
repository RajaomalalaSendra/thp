<!DOCTYPE html>
<html class="loading" lang="fr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/thp/style/bootstrap.css">
    <title>The hacking project offline</title>
  </head>
  <body class="vertical-layout vertical-menu 2-columns  menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <h1 class="navbar-brand">THE HACKING PROJECT</h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarColor01">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/thp">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/features">Features</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/thp/about">About</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>
<div class="container">
    <a type="button" class="btn btn-dark" href="/thp/semaine_1/">Semaine 1</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_2/">Semaine 2</a>
    <a type="button" class="btn btn-dark " href="/thp/semaine_3/">Semaine 3</a>
    <a type="button" class="btn btn-dark btn-lg" href="/thp/semaine_4/">Semaine 4</a>
    <a type="button" class="btn btn-dark" href="/thp/semaine_5/">Semaine 5</a>  
</div>
<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      <div class="container">
    <div class="card">
  <div class="card-header">
    <h4 class="text-center"> Programme jour par jour</h4>
  </div>
  <div class="card-body">
    <div class="text-center">
    <a href="/thp/semaine_4">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-terminal"></i>&nbsp;&nbsp;&nbsp;Lun
      </button>
</a>    <a href="/thp/semaine_4/jour_2">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
        <i class="fa fa-code"></i>&nbsp;&nbsp;&nbsp;Mar
      </button>
</a>    <a href="/thp/semaine_4/jour_3">
      <button class="btn btn-secondary btn-outline-dark btn-lg mr-4">
        <i class="fa fa-desktop"></i>&nbsp;&nbsp;&nbsp;Mer
      </button>
</a>    <a href="/thp/semaine_4/jour_4">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-folder-open"></i>&nbsp;&nbsp;&nbsp;Jeu
      </button>
</a>    <a href="/thp/semaine_4/jour_5">
      <button class="btn btn-secondary btn-outline-dark btn mr-4">
      <i class="fa fa-bullhorn"></i>&nbsp;&nbsp;&nbsp;Ven
      </button>
</a>    </div>
  </div>
</div>


<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="content-header row"></div>
    
      
<div class="content-body">
      <h2 class="text-center">Passage de SQL Ã  ActiveRecord</h2>
      <h4 class="text-center">Initiation Ã  Rails</h4>
  <div class="row">
     <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
              <i class="ft-calendar icon-opacity info font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
              <span class="d-block mb-1 font-medium-1"></span>
              <h3 class="info mb-0">
                 Jour 24 / 55</h3>
          </div>
        </div>
        <div class="progress progress-sm mt-1 mb-0 box-shadow-2">
            <div class="progress-bar bg-gradient-x-info" role="progressbar" style="width: 43%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="120">
            </div>
        </div>
      </div>
    </div>
  </div>
 </div>


    <div class="col-xl-3 col-lg-6 col-md-12">
  <div class="card">
    <div class="card-content">
      <div class="card-body">
        <div class="media d-flex">
          <div class="align-self-top">
            <i class="ft-heart icon-opacity danger font-large-4"></i>
          </div>
          <div class="media-body text-right align-self-bottom mt-3">
            <span class="d-block mb-1 font-medium-1">Jokers restant</span>
            <h3 class="danger mb-0">
                3
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="col-xl-3 col-lg-6 col-md-12">
    <div class="card">
        <div class="card-content">
            <div class="card-body">
                <div class="media d-flex">
                    <div class="align-self-top">
                        <a href="/dashboard/assignments?locale=fr">
                           <i class="ft-fast-forward icon-opacity warning font-large-4"></i>
</a>                    </div>
                    <div class="media-body text-right align-self-bottom mt-3">
                        <span class="d-block mb-1 font-medium-1">Missions</span>
                            <div class="badge border-danger danger badge-border">Pas inscrit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>
  <div class="row">
        <div class="container">
    <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
        <div class="card-header">
        <h1 >Initiation Ã  Rails
                <i class="fa fa-space-shuttle text-danger"></i>
        </h1>
        
        </div>
        <div class="card-content">
        <div class="card-body">
            <div class="card-text">
            <h2 class="text-center">Passage de SQL Ã  ActiveRecord</h2>
            <div class="cd-horizontal-timeline loaded">
                <div class="timeline">
                <div class="events-wrapper">
                    <div class="events" style="width: 1800px;">
                    <ol>
                                <li>
                                    <a style="left:120px;" href="/dashboard/weeks/4/days/1?locale=fr">
                                        Lun
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                                <li>
                                    <a style="left:240px;" href="/dashboard/weeks/4/days/2?locale=fr">
                                        Mar
                                            <i class="fa fa-beer text-warning" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Rendez-vous pour boire un coup"></i>

</a>                                </li>
                            <li>
                                <a class="selected" style="left:360px;" data-toggle="tooltip" data-placement="top" title="Passage de SQL Ã  ActiveRecord" href="/dashboard/weeks/4/days/3?locale=fr">
                                    Mer
                                        <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet Ã  rendre ce jour-lÃ "></i>

</a>                                </li>
                                <li>
                                    <a style="left:480px;" href="/dashboard/weeks/4/days/4?locale=fr">
                                        Jeu
                                            <i class="fa fa-rocket text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Projet Ã  rendre ce jour-lÃ "></i>
    <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journÃ©e lÃ " ></i>

</a>                                </li>
                                <li>
                                    <a style="left:600px;" href="/dashboard/weeks/4/days/5?locale=fr">
                                        Ven
                                            <i class="fa fa-pencil text-success" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Corrections cette journÃ©e lÃ " ></i>


</a>                                </li>
                    </ol>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
<div>
  </div>

  <!-- Les fameuses corrections qui n'arrivnet que les jours concernÃ©s -->


    <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Ta premiÃ¨re application Rails</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>On a vu ensemble SinatraÂ : un langage bas-niveau qui permet de faire du web de maniÃ¨re simple et oÃ¹ le dÃ©veloppeur a la maÃ®trise de son application. L'avantage pour nous est que son aspect minimaliste te fait mettre les mains dans le cambouis et te fait comprendre comment marchent les requÃªtes. Le dÃ©faut est que tu es entiÃ¨rement maÃ®tre de l'architecture de l'application, ce qui n'est pas forcÃ©ment simple Ã  gÃ©rer en tant que dÃ©veloppeur dÃ©butant. Plus ton application va devenir complexe, plus tu vas devoir prendre des dÃ©cisions sur la faÃ§on d'organiser les diffÃ©rents Ã©lÃ©ments de ton codeâ€¦ et tu n'as pas encore l'expÃ©rience pour faire les bons choix qui sâ€™avÃ©reront payants Ã  long termeÂ ! Maintenant on va passer Ã  Rails qui impose des conventions assez fortesÂ : l'avantage, c'est qu'elles te guident dans tes choix. Et du coup Ã§a se passe, comme sur des rails ğŸš‚.</p>

<p>Hier, on a abordÃ© les bases de donnÃ©es et c'est chouette, trÃ¨s chouette, de faire du SQL. Mais Ã  partir de maintenant, nous allons passer par une surcouche de Rails pour gÃ©rer nos BDDÂ : ActiveRecords.</p>

<p>Pour les trois prochains jours, nous n'allons faire que du backend, et 0 frontend avec plusieurs objectifs en tÃªteÂ : </p>
<ul>
  <li>Le premier est de faire une introduction tout en douceur de Ruby on Rails (RoR), Ã©tant donnÃ© que tu ne vas faire que de l'interaction avec la base de donnÃ©es (on va se concentrer sur la partie Model du MVC).</li>
  <li>Le second de te donner des bases robustes en crÃ©ation de base de donnÃ©es, une compÃ©tence incontournable quand on fait des applications web. Si je te demande aujourd'hui de modÃ©liser la base de donnÃ©es de Tinder, tu ne saurais pas comment faire (et c'est normal). Mais d'ici Ã  vendredi soir, tu auras les bons rÃ©flexes pour tout faire toi-mÃªme et pouvoir l'implÃ©menter sur l'application de tes rÃªves.</li>
  <li>Enfin, le troisiÃ¨me objectif est un totem dans la crÃ©ation d'appli webÂ : il faut Ãªtre capable de crÃ©er des bases de donnÃ©es robustes basÃ©es sur des models en bÃ©ton armÃ©. Si la BDD de ton appli peut Ãªtre facilement polluÃ©e par des entrÃ©es Ã  moitiÃ© remplies et incohÃ©rentes entre elles, c'est toute ton appli qui pourra finir Ã  la poubelle. Donc nous allons t'apprendre Ã  construire des bases de donnÃ©es qui restent propres dans la durÃ©e.</li>
</ul>

<p>Dans cette ressource, tu vas crÃ©er ta premiÃ¨re application en Ruby on Rails. WaowÂ !</p>

<h2>2. Historique</h2>
<p>Rails a Ã©tÃ© crÃ©Ã© en 2005 par un certain David Heinemeier Hansson, plus connu sous le nom <b>DHH</b> (super compte Twitter Ã  suivre BTW). La genÃ¨se de Rails a eu lieu Ã  Basecamp, la fameuse start-up de DHH, oÃ¹ il a imaginÃ© un framework pour faire du web Ã  partir de Ruby. Rails a Ã©tÃ© conÃ§u en privilÃ©giant l'agilitÃ© et la crÃ©ation rapide, afin de pouvoir produire des applications facilement modifiables. Il a basÃ© Rails sur plusieurs idÃ©es originales et plusieurs sont maintenant des standards de l'industrie (par exemple, le principe de migrations que l'on va dÃ©couvrir ensemble).</p>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ“š INSTANT CULTURE GÃ‰</h4>
      <p class="card-text">DHH a fait d'autres choses dans sa vie que bouleverser le monde du web. Je considÃ¨re personnellement BaseCamp, l'entreprise dont il est co-fondateur et CTO, comme l'une des toutes premiÃ¨res startup de l'Ã¨re moderne, <i>Ã  la</i> Trello, Slack, et son livre <a href="https://basecamp.com/books/rework" target="_blank">REWORK</a> est une bible du management moderne d'entreprise.</p>
    </div>
  </div>
</div>

<p>Rails est basÃ© sur plusieurs philosophies :</p>
<ul>
  <li><b>Convention Over Configuration</b>Â : lÃ  oÃ¹ Sinatra te donne absolument tous les droits pour faire ce que tu veux pour tes applications, une application Rails est structurÃ©e dÃ¨s sa crÃ©ation. Elle est "livrÃ©e" avec son dossier controller, son fichier routes, son systÃ¨me de bases de donnÃ©es. Ces conventions sont gÃ©niales pour aller plus vite dans la rÃ©alisation d'applications, la contrepartie est qu'en sortir (le jour oÃ¹ tu seras un demi-dieu du dev) relÃ¨ve du parcours du combattant.</li>
  <li><b>Don't Repeat Yourself</b> (DRY) : Rails de donne la possibilitÃ© de facilement rÃ©unir ton code dans des fichiers afin de les rappeler Ã  plusieurs endroits de ton app. Ainsi, inutile d'Ã©crire 2 fois la mÃªme choseÂ ! C'est du coup plus facile Ã  lire (on ne lit qu'une fois et pas 10) et plus facile Ã  modifier (Ã  un seul endroit, pas Ã  10).</li>
</ul>

<p>Au fil des annÃ©es, Rails est devenu un langage de programmation trÃ¨s populaire dans l'univers du web, avec un apogÃ©e en 2011. Son principe de migration a inspirÃ© le reste du web actuel, et sa rapiditÃ© de mise en Å“uvre couplÃ©e Ã  une puissance et rapiditÃ© d'exÃ©cution en font un outil encore trÃ¨s populaire. Rails et Ruby sont moins en vue ces derniers temps, mais leur popularitÃ© reste trÃ¨s convenable, avec des jolis noms utilisant la technoÂ : Algolia, Airbnb, Qonto, Drivy, JobTeaser, SoundCloud, Github, The Hacking Project, pour ne citer qu'eux.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ¤“ QUESTION RÃ‰CURRENTE</h4>
      <p class="card-text"><b>Mais si Ruby et Rails sont en perte de vitesse, on ne perd pas notre temps Ã  apprendre ce framework et ce langageÂ ?</b><br>
      Absolument pas. Et cela pour plusieurs raisons :</p>
      <ul>
        <li>La communautÃ© Ruby et Rails est plus restreinte que celle de langages plus populaires mais elle est trÃ¨s activeÂ : de nombreux projets open-source (dont Rails) sont mis Ã  jour tous les mois.</li>
        <li>C'est aussi une communautÃ© de qualitÃ©Â : les documentations sont gÃ©nÃ©ralement bonnes et l'aide est facile Ã  trouver via une recherche Google. Sans parler du fait que la <a href="https://dev.to/ben/ruby-has-the-kindest-programming-community-and-i-have-the-data-to-prove-it-4f60">communautÃ© Ruby est globalement bienveillante</a>. Tous les langages ne peuvent pas en dire autant. ğŸ˜ </li>
        <li>Ils se sont imposÃ©s dans le paysage du web et ne sont clairement pas en position de disparaÃ®tre sous peu. Rails et Ruby ont encore de beaux jours devant euxÂ !</li>
        <li>Last but not LeastÂ : en termes de facilitÃ© de mise en Å“uvre et de rapiditÃ© de prise en main, Rails n'a pas d'Ã©gal. Et dans un bootcamp comme THP, sur 11 semaines, un dÃ©butant ne pourrait pas faire tout ce qu'on va te prÃ©senter avec un autre framework. Du coup, apprendre Rails c'est super gratifiant pour un dÃ©butantÂ : Ã§a augmente nettement tes chances d'aller au bout de la formation et poursuivre dans la voie du dÃ©veloppement. </li>
      </ul>
      <p>Au final, Ruby + Rails est une super porte d'entrÃ©e dans le monde du dÃ©veloppement. Mais pas seulementÂ ! Nombreux sont ceux qui restent sur cette stack Ã  l'issue de THP. <br>
      => On espÃ¨re que tu seras convaincu de tout cela Ã  l'issue des 11 semaines. Ce sera alors ton tour d'Ã©vangÃ©liser les sceptiques. ğŸ¤— </p>
    </div>
  </div>
</div>



<h2>3. La ressource</h2>
<h3>3.1. Rails en bref</h3>

<p>Aujourd'hui, on va (enfinÂ !) faire du Rails. Mais avant Ã§a, rappelons les bases : Rails est un framework web, open-source et Ã©crit en Ruby. Ce framework est pensÃ© avant tout pour les devs et suit deux principesÂ : "Convention over configuration" et "Don't repeat yourself (DRY)". Rails est assez rigide dans sa maniÃ¨re de faire mais une fois maÃ®trisÃ©, tu deviens hyper efficace en le manipulantÂ ! En comparaison, lÃ  oÃ¹ crÃ©er une fonctionnalitÃ© en Rails nÃ©cessite une dizaine de lignes de code, il en faudrait cinquantaine en Sinatra.</p>

<h3>3.2. CrÃ©er son app rails</h3>

<p>PrÃªtÂ ? C'est le moment de gloire oÃ¹ tu vas crÃ©er ta premiÃ¨re application Rails. Ouvre donc ton terminal et dÃ©place-toi dans ton rÃ©pertoire de travail. Tape la commande :</p>

<pre><code class="language-shell">$ rails new my_first_app</code></pre>
<p>Cela va crÃ©er un nouveau dossier Rails nommÃ© <code>my_first_app</code>. Tu n'as plus qu'a te dÃ©placer dans ce rÃ©pertoire et lancer la fameuse commande :</p>

<pre><code class="language-shell">$ bundle install</code></pre>

<p>TadamÂ ! Tu as crÃ©Ã© ta premiÃ¨re app RailsÂ ! Prenons deux secondes pour nous recueillir et profiter de ce moment historique. <br>
OK. <br>
Maintenant, regarde un peu ton dossier RailsÂ : tu remarqueras qu'une app rails comporte Ã©normÃ©ment de dossiers et de sous-dossiers. C'est impressionnant au dÃ©but mais c'est normal. Aujourd'hui, nous allons travailler essentiellement avec le dossier <b>db</b> qui se trouve Ã  la racine et avec le sous-dossier <b>model</b> qui se trouve dans le dossier <b>app</b>. Si tu ouvres le contenu de ton dossier avec ton Ã©diteur de texte, tu devrais avoir une architecture du typeÂ : </p>
<pre><code class="language-shell">.
|-- app
|   |-- assets
|   |   |-- images
|   |   |-- javascripts
|   |   |   `-- application.js
|   |   `-- stylesheets
|   |       `-- application.css
|   |-- controllers
|   |   |-- application_controller.rb
|   |   `-- concerns
|   |-- helpers
|   |   `-- application_helper.rb
|   |-- mailers
|   |-- models
|   |   `-- concerns
|   `-- views
|       `-- layouts
|           `-- application.html.erb
|-- bin
|   |-- bundle
|   |-- rails
|   |-- rake
|   |-- setup
|   `-- spring
|-- config
|   |-- application.rb
|   |-- boot.rb
|   |-- database.yml
|   |-- environment.rb
|   |-- environments
|   |   |-- development.rb
|   |   |-- production.rb
|   |   `-- test.rb
|   |-- initializers
|   |   |-- assets.rb
|   |   |-- backtrace_silencers.rb
|   |   |-- cookies_serializer.rb
|   |   |-- filter_parameter_logging.rb
|   |   |-- inflections.rb
|   |   |-- mime_types.rb
|   |   |-- session_store.rb
|   |   `-- wrap_parameters.rb
|   |-- locales
|   |   `-- en.yml
|   |-- routes.rb
|   `-- secrets.yml
|-- config.ru
|-- db
|   `-- seeds.rb
|-- Gemfile
|-- Gemfile.lock
|-- lib
|   |-- assets
|   `-- tasks
|-- log
|-- public
|   |-- 404.html
|   |-- 422.html
|   |-- 500.html
|   |-- favicon.ico
|   `-- robots.txt
|-- Rakefile
|-- README.rdoc
|-- test
|   |-- controllers
|   |-- fixtures
|   |-- helpers
|   |-- integration
|   |-- mailers
|   |-- models
|   `-- test_helper.rb
|-- tmp
|   `-- cache
|       `-- assets
`-- vendor
`-- assets
    |-- javascripts
    `-- stylesheets</code></pre>

<p>Si tu regardes bien, il y a certains fichiers que tu as dÃ©jÃ  vus :
<ul>
  <li><b>Gemfile</b>Â : âš ï¸ Attention Ã  bien avoir les versions THP de Ruby et Rails sinon tu risques de perdre des points bÃªtement lors des prochains projets âš ï¸</li>
  <li><b>App/views</b>Â : Dans ce dossier, tu pourras concevoir l'ensemble de la partie visuelle de ton app.</li>
  <li><b>App/controllers</b>Â : Ce dossier contiendra tes controllers qui font le lien entre tes vues et tes modÃ¨les.</li>
  <li><b>App/model</b>Â : C'est ici que se trouve toute la logique qui lie les objets Ruby (utilisables ensuite dans les controllers et views) avec des tables SQL (la BDD).</li>
  <li><b>Config/routes.rb</b>Â : c'est ici oÃ¹ tu peux crÃ©er tes routes (statiques comme dynamiques).</li>
  <li><b>/db</b>Â : C'est lÃ  que se trouve la base de donnÃ©es de l'app.</li>
</ul>

<p>Pour en savoir un peu plus, tu peux regarder <a href="https://youtu.be/2MdBvjYtE18?list=PLjwdMgw5TTLWfI1B2Wv2WPgR9iOyw12zi&t=236" target="_blank">cette vidÃ©o</a> de Grafikart Ã  partir de la minute 4, jusqu'Ã  la minute 9. Pas de panique si tu ne comprends pas tout, ces notions seront dÃ©veloppÃ©es plus tard ğŸ˜</p>



<h2>4. Points importants Ã  retenir</h2>
<p>Rails est un framework de Ruby qui permet de faire du web, crÃ©Ã© en 2005 par David Heinemeier Hansson. Sa force rÃ©side dans sa rapiditÃ© de mise en place, et (entre autres) dans sa faÃ§on trÃ¨s souple de gÃ©rer des bases de donnÃ©es.</p>

<p>Pour crÃ©er une application Rails, il suffit de faire <code>$ rails new nom_de_mon_app</code>. <br>
Cette commande crÃ©e automatiquement tout une architecture logicielle Ã  laquelle il faut se conformer.</p>


<h2>5. Pour aller plus loin</h2>
<p>Rails a l'une des meilleures docs qui existe, avec les Rails Guides. Un peu obscurs au dÃ©but, ces guides te seront d'une aide plus que prÃ©cieuse quand tu auras un niveau intermÃ©diaire. Tu peux la parcourir mais c'est probablement un peu tÃ´t pour aller checker <a href="https://guides.rubyonrails.org/">la documentation officielle</a>.</p>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Rails Model: les BDD en Rails (migrations, crÃ©ation, etc.)</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Maintenant que tu as vu SQL, un puissant langage qui permet d'interagir avec des bases de donnÃ©es, on va t'expliquer comment Ruby on Rails gÃ¨re les BDD. Tout s'articule autour d'une gem nommÃ©e <a href="https://github.com/rails/rails/tree/master/activerecord" target="_blank">ActiveRecord</a> qui permet de transformer une table de BDD (les fameux tableaux Excel dans lesquels on stocke les donnÃ©es) en classe Ruby (et donc en objet et instances). L'alliance des deux va transformer les requÃªtes SQL un peu barbares comme <code>SELECT * from User</code> en un plus simple <code>User.all</code> en Ruby.</p>

<p>Cette ressource sera consÃ©quente et va faire le lien entre 2 choses que tu viens Ã  peine de dÃ©couvrirÂ : la POO et les BDD. Prends bien le temps de la comprendreÂ ! Quitte Ã  la relire plusieurs fois (et ce week-end) si besoin. <br>
On va t'expliquer 4 concepts clÃ©s dans la modÃ©lisation de bases de donnÃ©es en Rails :</p>

<ol>
  <li>Qu'est-ce qu'ActiveRecordÂ ;</li>
  <li>Les migrationsÂ ;</li>
  <li>Le model dans RailsÂ ;</li>
  <li>Comment lier tables et models entre eux dans Rails.</li>
</ol>

<h2>2. Historique</h2>
<p>L'une des idÃ©es novatrices que Rails a apportÃ© dans le monde du web, c'est la faÃ§on dont ses applications gÃ¨rent leurs bases de donnÃ©es. DÃ©jÃ , utiliser ActiveRecord lui permet de transformer ses tables de BDD en objets Ruby. On retire une information de la BDD (par exemple le prÃ©nom d'un utilisateur) sous la forme d'un simple <code>mon_user.first_name</code>.</p>

<p>Ensuite, le principe de migration a permis d'avoir des bases de donnÃ©es facilement modifiables alors mÃªme que l'application tourne dÃ©jÃ . C'est crucial pour toute jeune entreprise qui avance Ã  tatons (aka les startups). On verra plus en dÃ©tails ce qu'est une migration mais, en gros, l'idÃ©e est d'avoir un dossier qui contient tout l'historique de tous les changements faits sur ta base de donnÃ©es. Le principe de migration est devenu rapidement trÃ¨s populaire et une bonne partie des frameworks web modernes l'utilisent dÃ©sormais.</p>



<h2>3. La ressource</h2>
<h3>3.1. ActiveRecord dans Rails</h3>
<p>Tu as vu rÃ©cemment le modÃ¨le MVC en Ruby, qui te permet de dÃ©composer un programmeÂ : la partie M est le Model, soit celle qui interagit avec ta base de donnÃ©es. Pour le moment, tes modÃ¨les ne jouaient qu'avec des fichiers CSV, et tu as vu hier que SQL Ã©tait THE langage de prÃ©dilection pour interagir avec une BDD. Eh bien grÃ¢ce Ã  ActiveRecord, nous pouvons faire tout ceci d'un coupÂ !</p>

<p>ActiveRecord est une gem implÃ©mentÃ©e dans Rails qui dÃ©compose toutes tes tables en classes Ruby. Dit autrement, dans ton application, tu ne seras pas obligÃ© de travailler avec du SQL : tu pourras dÃ©finir tes models de base de donnÃ©es comme tu dÃ©finis une classe Ruby. Et c'est ultra pratique.</p>


<h3>3.2. Les migrations</h3>
<h4>3.2.1. Qu'est-ce qu'une migrationÂ ?</h4>
<h5>3.2.1.1. Avant les migrations</h5>
<p>Quand tu crÃ©es une application Rails, ton fichier <code>base_de_donnÃ©es.sql</code> est vide. 0 table, 0 colonne. Il faut donc lui ajouter des tables et des colonnes. Avant le systÃ¨me de migrations, on se tapait des grosses commandes SQL du type :</p>

<pre><code class="language-sql">CREATE TABLE CUSTOMER
(
  CustomerID INT NOT NULL,
  CustomerName VARCHAR(40) NOT NULL,
  CustomerZip VARCHAR(10) NOT NULL,
  PRIMARY KEY (CustomerID)
);

CREATE TABLE SALESTRANSACTION
(
  TID INT NOT NULL,
  Tdate DATE NOT NULL,
  CustomerID INTEGER NOT NULL,
  FOREIGN KEY (CustomerID) REFERENCES CUSTOMER(CustomerID)
);</code></pre>

<p><b>Les migrations permettent d'Ã©viter ce genre de barbarie SQL</b>Â : on Ã©crit la demande de crÃ©ation de table dans un langage plus simple Ã  comprendre et directement lu par Rails (inutile de jongler entre 2 interfaces, Rails et SQL).</p>

<p> Imagine maintenant le cas suivantÂ : tu as crÃ©Ã© une application web avec ton Ã©quipe de 5 dÃ©veloppeurs et le site tourne plutÃ´t bien. Vous avez dÃ©jÃ  acquis un millier de clients et tu te rends compte que tu as fais du ğŸ’© en crÃ©ant la table des utilisateurs il y a 2 mois. Elle dispose d'une colonne <code>zip_code</code> (le code postal de l'utilisateur) que tu as mis au format <code>integer</code>. Tout allait bien jusqu'Ã  ce que tu te rendes compte que ce n'Ã©tait pas une bonne idÃ©e (quid des pays ayant des codes postaux avec des lettresÂ ?? Ou alors le code postal de Nice qui passe de <code>06000</code> Ã  <code>6000</code>Â ??). Tu aimerais donc bien passer tous tes codes postaux en <code>string</code>, un format bien plus appropriÃ©. Bien entendu (et c'est lÃ  un point crucial de ton business naissant), ta base de donnÃ©es est dÃ©jÃ  pleineÂ : tu veux conserver tous les codes postaux des utilisateurs dÃ©jÃ  en baseÂ !!</p>

<p>Dans une BDD, avant les migrations, tu te serais tapÃ© un max d'opÃ©rations en SQL pour mettre la BDD de ton ordinateur (qui te permet de tester l'app Rails) Ã  jour. Il aurait fallu 1) crÃ©er une 2Ã¨me table avec une colonne <code>zip_code</code> de type <code>string</code>, 2) copier coller chaque entrÃ©e de la table originelle vers la nouvelle, 3) supprimer l'ancienne table et 4) renommer la nouvelle table pour qu'elle prenne dÃ©finitivement la place de l'ancienne. <b>Les migrations automatisent (en 1 ligne) ces opÃ©rations de changement tout en conservant les donnÃ©es existantes</b>. </p>

<p>Une fois ces opÃ©rations SQL validÃ©es, il aurait fallu les appliquer Ã  la BDD de ton app en PROD (celle qui tourne sur le serveur web et que les clients utilisent) afin de corriger ta bourde. Et finalement, tu aurais dÃ» aussi appliquer ces modifications sur les ordinateurs de tous les devs de l'Ã©quipe pour que leur BDD Ã  eux soit Ã©galement Ã  niveau. Bien sÃ»r, interdiction de se rater et d'oublier une ligne SQL sur aucun ordinateur : on peut parler <a href="https://www.youtube.com/watch?v=k_yLPiPMmrw">de merdier</a> Ã  ce niveau-lÃ .</p>

<p>On peut mÃªme aller plus loinÂ : finalement tu regrettes ta modification de BDD, car elle introduit un bug, fait pÃ©ter toute ton application et le service est downÂ ! Il ne te reste plus qu'Ã  passer les commandes SQL inverses en urgence et dans le bon ordre s'il te plaÃ®t. Ta carriÃ¨re de dÃ©veloppeur va intÃ©resser les archÃ©ologuesÂ : elle est en ruines.</p>

<b><p>Je pense que tu as pigÃ© la puissance des migrations. En rÃ©sumÃ©, elles permettent :</p>
<ul>
  <li>De gÃ©rer les modifications de la BDD directement dans Rails (et non via une interface SQL)Â ;</li>
  <li>De faire des modifications de BDD sur une ligne de commande, sans perte des donnÃ©es existant dÃ©jÃ  en BDDÂ ; </li>
  <li>De facilement transfÃ©rer d'une personne Ã  l'autre les modifications Ã  apporter Ã  la BDD pour qu'elle soit dans l'Ã©tat final souhaitÃ© (chaque ordi a sa propre BDD + celles des serveurs) ;</li>
  <li>De revenir rapidement (une commandeÂ !) en arriÃ¨re en jouant une migration Ã  l'envers.</li>
</ul></b>

<h5>3.2.1.2. Le dossier des migrations</h5>
<p>Les migrations sont consignÃ©es dans un dossier qui contient alors tout l'historique de toutes les modifications que l'on a apportÃ©es Ã  sa base de donnÃ©es. Un peu comme Ã§a :</p>

<pre><code class="language-shell">Jour 1 - crÃ©ation d'une table utilisateurs avec une colonne prÃ©nom et une colonne email
Jour 6 - crÃ©ation d'une table ville et ajout d'une relation entre les villes et les utilisateurs
Jour 15 - suppression de la colonne email chez les utilisateurs
Jour 17 - ajout d'une colonne nom de famille dans la table des utilisateurs
Jour 28 - crÃ©ation d'une table couscous pour lister les meilleurs adresses de la ville</code></pre>

<p>Une migration peut avoir 2 statutsÂ : <code>up</code> ou <code>down</code>.</p>

<ul>
  <li><code>up</code>Â : elle a Ã©tÃ© passÃ©e et est appliquÃ©e Ã  ta base de donnÃ©e actuelle.</li>
  <li><code>down</code>Â : elle n'est pas encore passÃ©e (ou a Ã©tÃ© annulÃ©e).</li>
</ul>

<p>Pour chaque migration, il y a une action pour passer de <code>down</code> Ã  <code>up</code> (cela s'appelle "passer une migration"), et une action pour passer de <code>up</code> Ã  <code>down</code> (cela s'appelle "faire un rollback"). Par exemple :</p>

<ul>
  <li>Pour une migration qui crÃ©e une table pour les utilisateursÂ :
  <ul>
    <li>L'action de <code>down</code> Ã  <code>up</code> sera de crÃ©er une table utilisateurs</li>
    <li>L'action de <code>up</code> Ã  <code>down</code> sera de dÃ©truire la table utilisateurs (attention, la perte de donnÃ©e est irrÃ©versible dans ce cas)</li>
  </ul></li>
  <li>Pour une migration qui ajoute une colonne <code>email</code> Ã  la table utilisateurs :
  <ul>
    <li>L'action de <code>down</code> Ã  <code>up</code> sera de crÃ©er une colonne <code>email</code> dans la table utilisateurs</li>
    <li>L'action de <code>up</code> Ã  <code>down</code> sera de dÃ©truire la colonne <code>email</code> de la table utilisateurs (attention, la perte de donnÃ©e est irrÃ©versible dans ce cas)</li>
  </ul></li>
  <li>Pour une migration qui crÃ©e une table pour les utilisateurs et qui lui donne une colonne <code>first_name</code>
  <ul>
    <li>L'action de <code>down</code> Ã  <code>up</code> sera de crÃ©er une table utilisateurs et lui crÃ©er une colonne <code>first_name</code></li>
    <li>L'action de <code>up</code> Ã  <code>down</code> sera de dÃ©truire la colonne <code>first_name</code> de la table utilisateurs et de dÃ©truire la table (attention, la perte de donnÃ©e est irrÃ©versible dans ce cas)</li>
  </ul></li>
  <li>Bref, tu vois la logique</li>
</ul>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ“š INSTANT CULTURE GÃ‰</h4>
      <p class="card-text">Pour tester si une migration est bien faite, un dÃ©veloppeur senior va faire une sÃ©rie d'acions :</p>
      <ul>
        <li>Passer de <code>down</code> Ã  <code>up</code> pour voir si elle marche bien</li>
        <li>Passer de <code>up</code> Ã  <code>down</code> pour voir s'il est possible de revenir en arriÃ¨re</li>
        <li>Repasser de <code>down</code> Ã  <code>up</code> pour la prendre en compte</li>
      </ul>
      <p>Savoir ceci peut te valoir des points en entretien d'embaucheÂ ;)</p>
    </div>
  </div>
</div>

<h4>3.2.2. CrÃ©er et effectuer ses premiÃ¨res migrations</h4>
<h5>a) CrÃ©er sa premiÃ¨re migration</h5>
<p>Toutes les migrations de ton application se trouvent dans le dossier <code>db/migrate/</code> au format <code>AAAAMMDDHHMMSS_nom_migration.rb</code> (AAAAMMDDHHMMSS = date et heure prÃ©cise de crÃ©ation de la migration). Pour le moment tu nâ€™en as pas, donc nous allons crÃ©er ta premiÃ¨re migration. Avec Rails c'est facile, il suffit de rentrer la ligne de commande suivante :</p>

<pre><code class="language-shell">$ rails generate migration NomDeTaMigration</code></pre>

<p>Si tu exÃ©cutes cette commande, il devrait crÃ©er un fichier de migration qui ressemble Ã  quelque chose comme Ã§a :</p>


<pre><code class="language-ruby">class NomDeTaMigration < ActiveRecord::Migration[5.2]
  def change
    # ici tu mettras les modifications que tu aimerais apporter Ã  ta base de donnÃ©es
  end
end</code></pre>

<p>Pour effectuer la migration (ne le fais pas pour le moment, car ta mÃ©thode <code>change</code> est vide), il te suffira de saisir la commande :</p>

<pre><code class="language-shell">$ rails db:migrate</code></pre>

<h5>b) Des exemples de migration</h5>
<p>Voici quelques exemples de migration. Pour le moment contente-toi de lire, tu pourras revenir ici ensuite quand nous passerons Ã  la pratique.</p>

<p>Voici une migration qui dit "crÃ©e une table <code>users</code>" :</p>
<pre><code class="language-ruby">def change
  create_table :users do |t|
    t.timestamps
  end
end</code></pre>
<p>Les lignes <code>create_table :users do --- end</code> donnent l'ordre de crÃ©er une table <code>users</code> dont les colonnes vont Ãªtre dÃ©finies entre <code>do</code> et <code>end</code>. <br>
Pour le moment on ne dÃ©finit que 2 colonnes en 1 ligne avec <code>t.timestamps</code>Â : il s'agit de 2 colonnes qui porteront les intitulÃ©s <code>created_at</code> et <code>updated_at</code>. Elles permettront de suivre automatiquement (pour chaque entrÃ©e de la table) la date et l'heure de crÃ©ation et de derniÃ¨re mise Ã  jour. C'est une bonne pratique donc Rails proposera automatiquement ces colonnes Ã  la crÃ©ation d'une table. <br>
Note aussi que si cette migration est exÃ©cutÃ©e, la table <code>users</code> contiendra une 3Ã¨me colonne intitulÃ©e <code>id</code>. C'est la fameuse primary key dont on a parlÃ© en SQL (pour identifier de faÃ§on unique chaque entrÃ©e). Cette colonne est indispensable pour gÃ©rer ta table: elle sera toujours prÃ©sente donc pas besoin de la mentionner dans la migration.</p>


<p>Voici une migration qui dit "crÃ©e une table <code>users</code> et donne-lui une colonne <code>name</code>, de type string, et une colonne <code>is_admin</code>, de type boolÃ©en" :</p>
<pre><code class="language-ruby">def change
  create_table :users do |t|
    t.string :name
    t.boolean :is_admin
    t.timestamps
  end
end</code></pre>

<p>Si cette migration est exÃ©cutÃ©e, une table <code>users</code> sera crÃ©Ã©e. Cette table aura 5 colonnes : <code>id</code>, <code>name</code>, <code>is_admin</code><code>created_at</code> et <code>updated_at</code> (les deux timestamps).</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Quand tu gÃ©nÃ¨res une migration Ã  partir de la ligne de commande, Rails peut comprendre, Ã  partir du nom que tu donnes Ã  la migration, ce que tu veux faire exactement. <br>
      Par exemple si tu veux crÃ©er une table <code>users</code>, tu fais <code>$ rails generate migration CreateUsers</code> et hop, la migration comprendra dÃ©jÃ  la ligne <code>create_table :users</code> ğŸ˜</p>
    </div>
  </div>
</div>

<p>Voici une migration qui dit "dans la table <code>users</code> qui existe dÃ©jÃ , ajoute une colonne <code>email</code>, qui sera un string" :</p>

<pre><code class="language-ruby">def change
  add_column :users, :email, :string
end</code></pre>

<p>Voici une migration qui dit "dans la table <code>users</code> qui existe dÃ©jÃ , enlÃ¨ve la colonne <code>is_admin</code>" :</p>

<pre><code class="language-ruby">def change
  remove_column :users, :is_admin, :boolean
end</code></pre>

<p>Bien d'autres exemples sont <a href="http://edgeguides.rubyonrails.org/active_record_migrations.html#creating-a-migration" target="_blank">disponibles dans la doc</a> (renommer une table, etc.) et Jonathan de Grafikart a fait <a href="https://youtu.be/LBtCqTeJvfg" target="_blank">une vidÃ©o de 10mn</a> qui explique les migrations.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Voici quelques commandes trÃ¨s pratiques pour Ãªtre le champion des migrations :</p>
      <ul>
        <li><code>$ rails db:migrate</code>Â : Cette commande exÃ©cute TOUTES les migrations du dossier <code>db/migrate</code> qui sont en statut <code>down</code>. Si tu te rends dans le dossier db aprÃ¨s l'avoir exÃ©cutÃ©e, et ouvre le fichier development.sqlite3, tu verras que la base a Ã©tÃ© crÃ©e (et beaucoup plus facilement qu'hier en SQL).</li>
        <li><code>$ rails db:migrate:status</code>Â : te sort un joli tableau pour voir oÃ¹ tu en es dans tes migrations entre les <code>up</code> et les <code>down</code>.</li>
        <li><code>$ rails db:rollback</code>Â : revient en arriÃ¨re sur la derniÃ¨re migration. TrÃ¨s pratique quand on a fait une coquille qu'on dÃ©tecte de suite.</li>
        <li><code>$ rails db:migrate VERSION=20180905201547</code> : annule toutes les migrations postÃ©rieures Ã  celle portant le nom "20180905201547".</li></li>
      </ul>
    </div>
  </div>
</div>


<h4>3.2.3. Ã€ toi de jouerÂ ! Cas pratique</h4>
<p>TrÃ¨ves de blabla, Ã  toi de jouer. CrÃ©e une table <code>users</code> avec les attributs suivants :</p>

<ul>
  <li>Un <code>email</code> qui est un <code>string</code></li>
  <li>Un <code>first_name</code> qui est un <code>string</code></li>
  <li>Un <code>last_name</code> qui est un <code>string</code></li>
  <li>Un <code>is_admin</code> qui est un <code>boolÃ©en</code></li>
  <li>Les <code>timestamps</code></li>
</ul>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">âš ï¸ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Attention Ã  ne <b>JAMAIS changer ni supprimer</b> un fichier de migration Ã  partir du moment oÃ¹ elle a Ã©tÃ© passÃ©e. Sans le fichier de migration, Rails ne saura pas quoi faire avec ta base de donnÃ©es donc il sera perdu.</p>
      <p>En faisant Ã§a, tu vas crÃ©er des bugs relous Ã  gÃ©rer voire foutre en l'air ta base de donnÃ©es (et tu seras bon pour l'effacer et recommencer).</p>
    </div>
  </div>
</div>

<h3>3.3. Le model</h3>
<h4>3.3.1. CrÃ©er ton model</h4>
<p>Une fois que l'on a fait ses migrations pour sa base de donnÃ©es, nous allons crÃ©er le model correspondant Ã  la table. <br>
Ce qui est primordial que tu comprennes c'est que <b>pour chaque table de la BDD, il doit y avoir un model correspondant</b>. Les deux deviennent alors intimement liÃ©s grÃ¢ce au travail invisible dâ€™Active Records. Si on prend l'exemple d'une table <code>users</code> liÃ©e au model <code>User</code>, voici comment les deux sont liÃ©sÂ : </p>
<ul>
  <li><b>Chaque entrÃ©e de la table <code>users</code> est en fait une instance de la classe <code>User</code></b>.</li>
  <li><b>On peut crÃ©er une nouvelle entrÃ©e en BDD en faisant les lignes de Ruby </b>: <code>julie = User.new("julie", "julie@gmail.com")</code> puis <code>julie.save</code>. La table <code>users</code> est alors complÃ©tÃ©e en BDD d'une nouvelle entrÃ©e avec les bonnes colonnes.</li>
  <li><b>Chaque colonne de la table est automatiquement une variable d'instance qui est dÃ©jÃ  en <code>attr_accessor</code></b>. Par exemple si je fais en Ruby <code>julie.email</code>, je rÃ©cupÃ¨re bien le contenu de la colonne <code>email</code> de cet objet (par ex : "julie@gmail.com"). Et si je fais en Ruby <code>julie.email = nil</code>, puis <code>julie.save</code>, la colonne est bien modifiÃ©e en BDD. </li>
  <li>Et plein d'autres exemples que nous verrons.</li>
</ul>

<p> Mais quel est le rÃ´le du fichier modelÂ ? Il sera dans le dossier <code>app/model</code> et aura pour objectif de dÃ©finir plusieurs chosesÂ : </p>
<ul>
  <li>Les mÃ©thodes de classe qu'on veut pouvoir utiliser sur les instancesÂ ;</li>
  <li>Les validations qui sont les conditions Ã  remplir pour qu'une entrÃ©e soit considÃ©rÃ©e comme OK et sauvegardÃ©e (exÂ : impossible de crÃ©er un utilisateur si le champ e-mail est vide)Â ;</li>
  <li>Les liens entre les diffÃ©rentes tables / models (1-N, N-N, etc.)</li>
</ul> 

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">âš ï¸ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">On te l'a dit, en Rails c'est "Convention over configuration". Comme tout model doit avoir une table et vice et versa, leurs noms doivent respecter la convention pour que Rails sache qui va avec qui. Voici les rÃ¨glesÂ :
      <ul>
        <li>Le nom d'une table (dÃ©finie dans une migration) sera <b>toujours</b> en pluriel snake_case. On parlera par exemple de la table <code>users</code>.</li>
        <li>Le nom de la classe de ton model sera <b>toujours</b> au singulier en CamelCase. On parlera par exemple du model <code>User</code>.</li>
        <li>Le nom de fichier de ton model sera <b>toujours</b> au singulier en snake_case. On parlera par exemple du fichier <code>user.rb</code></li>
      </ul>
      <p>Dans le doute, n'hÃ©site pas Ã  googler, je le fais trÃ¨s rÃ©guliÃ¨rementÂ !</p>
    </div>
  </div>
</div>


<p>Pour crÃ©er un model, Rails a une commande spÃ©ciale. Comme tout model est forcÃ©ment liÃ© Ã  une table, cette commande aura pour effet de crÃ©er une migration de crÃ©ation de table en plus du model correspondant. Un petit 2-en-1 digne des meilleurs dÃ©tergents. <br>
Voici la commande :</p>
<pre><code class="language-shell">$ rails generate model NomDeTonModel</code></pre>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">âš ï¸ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Quand on dÃ©bute, on a tendance Ã  ajouter des migrations Ã  la va-vite sans comprendre leur implication. Si jamais tu as dÃ©jÃ  crÃ©Ã© la table en amont du model, tu dois supprimer la migration que Rails gÃ©nÃ¨re automatiquement mais bien sÃ»r AVANT qu'elle n'ait Ã©tÃ© passÃ©eÂ ! Sinon, au prochain <code>$ rails db:migrate</code>, Rails va te gueuler dessus que tu ne peux pas crÃ©er une table dÃ©jÃ  existante. Ne t'en fais pas, et dis-toi que c'est pour ton bien.</p>
      <p>Ã€ partir de maintenant, essaye de crÃ©er la table et le model en mÃªme temps via la commande de gÃ©nÃ©ration de model. </p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">La commande de gÃ©nÃ©ration d'un modÃ¨le te permet mÃªme d'ajouter direct les colonnes de ta table DANS la migration. Par exemple si tu veux crÃ©er un model user avec un email qui est un string et un is_admin qui est un boolÃ©en, tu Ã©crirais la commande :</p>
      <pre><code class="language-shell">$ rails generate model User email:string is_admin:boolean</code></pre>
      <p>Et hop, la migration est dÃ©jÃ  toute prÃªte. Il n'y a plus qu'Ã  la passer pour avoir la table et ses colonnes.</p>
    </div>
  </div>
</div>

<h4>3.3.2. Tester et jouer avec ton model en base</h4>
<p>Rails dispose d'une console dans laquelle tu vas pouvoir tester la crÃ©ation d'instances via tes models. Elle se lance avec <code>$ rails console</code>. <br>
Lorsque ton model existera tu pourras crÃ©er un utilisateur avec <code>u = User.new</code>, changer son nom avec <code>u.first_name = "FÃ©lix"</code>, l'afficher avec <code>u</code> puis le sauver en base avec <code>u.save</code>. <br>
Pour le moment, ne fait pas de tests (on y vient juste aprÃ¨s !) mais sache que le terminal devrait afficher quelque chose du genreÂ : </p>

<pre><code class="language-ruby">Running via Spring preloader in process 453
Loading development environment (Rails 5.2.2)

2.5.1 :003 > u = User.new
=> #&lt;User id: nil, email: nil, first_name: nil, last_name: nil, is_admin: nil, created_at: nil, updated_at: nil> 

2.5.1 :004 > u.first_name = "FÃ©lix"
 => "FÃ©lix" 

2.5.1 :005 > u
=> #&lt;User id: nil, email: nil, first_name: "FÃ©lix", last_name: nil, is_admin: nil, created_at: nil, updated_at: nil>

2.5.1 :006 > u.save
   u = User.create
   (0.2ms)  begin transaction
  User Create (2.7ms)  INSERT INTO "users" DEFAULT VALUES
   (8.5ms)  commit transaction
=> #&lt;User id: nil, email: nil, first_name: "FÃ©lix", last_name: nil, is_admin: nil, created_at: nil, updated_at: nil>
</code></pre>

<p>Nous verrons dans la leÃ§on suivante comment jouer avec la console de Rails, un super lieu chaleureux ğŸ”¥</p>

<h4>3.3.3. Ã€ toi de jouerÂ ! Cas pratique</h4>
<p>Prends la table <code>users</code> de tout Ã  l'heure et crÃ©e-lui le model correspondant. Il faut que tu sois capable de faire <code>User.create</code> (Ã©quivalent d'un <code>u = User.new</code> suivi d'un <code>u.save</code>) dans la console pour tester que le model et la table sont bien fonctionnels.</p>


<h3>3.4. Lier deux tables entre elles</h3>
<p>LE moment qui fait peur Ã  tout le mondeÂ : comment faire en sorte que mon utilisateur puisse Ãªtre liÃ© Ã  des articles de blog (qu'il a Ã©crit)Â ? Et comment faire en sorte que chaque article ait un auteurÂ ? Eh bien avec le mode d'emploi et un peu de rigueur, c'est pas si compliquÃ© que Ã§a.</p>

<p><b>Pour le moment, nous allons faire une relation 1-N, car ce sont les plus simples</b>. Pour que ton association marche, il faut ajouter une colonne d'index (<code>id</code>) dans une des deux tables, puis mentionner dans chaque modÃ¨le l'existence de cette association. C'est tout, et nous allons voir ensemble comment faire ceci - Ã  nouveau, pour le moment, lis sans tester. Nous pratiquerons juste aprÃ¨s et tu pourras revenir aux explications.</p>


<h4>3.4.1. Lier les tables dÃ¨s leur crÃ©ation</h4>

<p>Prenons le cas d'un <code>Book</code>, qui aurait un <code>Author</code>. Dans ce cas, un livre n'a qu'un seul auteur, mais un auteur peut avoir Ã©crit plusieurs livres. Nous allons commencer par crÃ©er le model <code>Author</code>, ainsi que la migration correspondante qui va crÃ©er la table <code>authors</code>: </p>

<pre><code class="language-shell">$ rails generate model Author</code></pre>

<p>Ce qui aura pour effet de crÃ©er le fichier <code>app/model/author.rb</code> et la migration suivante : </p>

<pre><code class="language-ruby">class CreateAuthors < ActiveRecord::Migration[5.2]
  def change
    create_table :authors do |t|
      t.timestamps
    end
  end
end</code></pre>

<p>Parfait. Maintenant nous allons faire de mÃªme avec le model <code>Book</code> : </p>

<pre><code class="language-ruby">$ rails generate model Book</code></pre>

<p>Cependant, tu vas devoir modifier la migration pour que la table <code>books</code> ait une information en plusÂ : la rÃ©fÃ©rence de l'auteur de chaque livre. Pour faire Ã§a, rajoute la ligne <code>t.belongs_to :author, index: true</code> dans la migration :</p>

<pre><code class="language-ruby">class CreateBooks < ActiveRecord::Migration[5.1]
  def change
    create_table :books do |t|
      t.belongs_to :author, index: true
      t.timestamps
    end
  end
end</code></pre>

<p>Cette ligne dit Ã  ta BDD "crÃ©e une colonne qui va servir Ã  stocker un integer, celui-ci sera la rÃ©fÃ©rence (l'<code>id</code>) de l'auteur qui est liÃ© au livre". Maintenant, tu n'as plus qu'Ã  passer tes 2 migrationsÂ : <code>$ rails db:migrate</code></p>

<p>Maintenant que l'on a bien les tables crÃ©Ã©es, il n'y a plus qu'Ã  dire Ã  ActiveRecord de faire le lien entre les models. Il faut dire dans notre model de book qu'il appartient Ã  un author :</p>
<pre><code class="language-ruby">class Book < ApplicationRecord
  belongs_to :author
end</code></pre>

<p>Puis dire Ã  notre model dâ€™author qu'il a plusieurs books :</p>
<pre><code class="language-ruby">class Author < ApplicationRecord
  has_many :books
end</code></pre>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸ¤“ QUESTION RÃ‰CURRENTE</h4>
      <p class="card-text">
        <b>Mais dis donc Jamy, j'ai dÃ©jÃ  vu un truc du genre </b><code>t.references :author, foreign_key: true</code><b>, quelle est la diffÃ©rence avec </b><code>t.belongs_to :author, index: true</code></b>Â ?<br>
        Absolument aucune, elles veulent dire exactement la mÃªme chose.
      </p>
      <p class="card-text">
        <b>Mais dis donc Jamy, dans une relation 1-N, comment savoir dans quelle table je mets l'index de l'autreÂ ?</b><br>
        Il suffit de rÃ©flÃ©chir 2 secondes et te dire "ok, l'index est <b>toujours</b> stockÃ© au format integer. Si je mets dans la table <code>authors</code> les index de chaque bouquin qu'il a Ã©crit, je vais en avoir parfois 1, parfois 5 ou parfois 1000. C'est pas gÃ©rable. Par contre, si je mets dans la table <code>books</code> l'index de l'auteur correspondant, comme il est unique, il n'y en aura toujours qu'un seulÂ !" Du coup tu as ta rÃ©ponse : c'est la table <code>books</code> qui porte l'index.
      </p>
      <p class="card-text">
        <b>Mais dis donc Jamy, comment on fait alors pour faire des relations N-N </i>ğŸ¤”</b><br>
        On devra forcÃ©ment rajouter une table entre les deux. Mais on verra Ã§a demain ğŸ¤“
      </p>
    </div>
  </div>
</div>

<h4>3.4.2. Ajout de liens entre 2 tables dÃ©jÃ  existantes</h4>
<p>Reprenons notre exemple avec les <code>Book</code> et les <code>Author</code> mais cette fois, imaginons que les 2 tables et les 2 models sont dÃ©jÃ  crÃ©Ã©s <b>mais n'ont jamais encore Ã©tÃ© liÃ©s avec <code>t.belongs_to</code></b>. Aucune des 2 tables n'a de foreign key dans ce cas de figure. <br>
 Comment les lier Ã  prÃ©sentÂ ? Il faut commencer par ajouter l'index Ã  la table books, en faisant une migration :</p>

<pre><code class="language-bash">$ rails generate migration AddIndexToBooks</code></pre>

<p>Ensuite on rentre les lignes suivantes dans le fichier de migration, avant de la passer :</p>

<pre><code class="language-ruby">def change
  add_reference :books, :author, foreign_key: true
end</code></pre>

<p>Reste alors Ã  modifier tes modÃ¨les pour prendre en compte les associations :</p>
<pre><code class="language-ruby">class Book < ApplicationRecord
  belongs_to :author
end</code></pre>

<pre><code class="language-ruby">class Author < ApplicationRecord
  has_many :books
end</code></pre>

<h4>3.4.3. Fonctionnellement, Ã§a rajoute quoi une relation 1-NÂ ? Testons en consoleÂ !</h4>

<p>En ayant liÃ© entre eux les deux models <code>Book</code> et <code>Author</code>, Rails va te permettre trÃ¨s facilement de passer de l'un Ã  l'autre. <br>
Ainsi, si tu disposes d'une instance de <code>Book</code>, tu peux immÃ©diatement rÃ©cupÃ©rer l'instance <code>Author</code> qui lui est liÃ©e en faisant <code>.author</code> dessus (tu noteras le singulier de "author"). <br>
SymÃ©triquement, si tu disposes d'une instance de <code>Author</code> tu peux immÃ©diatement rÃ©cupÃ©rer <b>un array des instances</b> <code>Book</code> qui lui sont liÃ©es en faisant <code>.books</code> dessus (tu noteras le pluriel de "books").</p>

<p>Pour tester en console et vÃ©rifier que le lien est bien fait, voici une mÃ©thode classique :</p>
<pre><code class="language-ruby">> b = Book.new("Les misÃ©rables", 1903)
#=> cela crÃ©e un book pas encore sauvegardÃ©

> b.author
#=> tu devrais voir "nil" car aucun objet author n'est liÃ© Ã  ce book.
#=>S'il te renvoie une erreur, c'est que le lien entre les 2 modÃ¨les est mal fait : il faut le revoir.

> a = Author.create("Victor Hugo", "FranÃ§ais")
#=> on crÃ©e une instance d'Author

> b.author = a
#=> Ã§a y est, on lie l'objet "b" (book) avec l'objet "a" (author). 
#=>S'il te renvoie une erreur, c'est que le lien entre les 2 modÃ¨les est mal fait : il faut le revoir.

> b.save
#=> On Ã©crit l'objet "b" en BDD. S'il te renvoie une erreur, tu as mal suivi ce tuto

> livre = Book.last
#=> RÃ©cupÃ¨re le dernier book Ã©crit en base (celui que tu viens de crÃ©er)

>livre.author
#=> Renvoie thÃ©oriquement l'objet "a" (Victor Hugo)

>livre.author.books
#=> Devrait te renvoyer un array avec tous les book Ã©crits par Victor Hugo. Parmi eux, tu devrais trouver le book que tu viens de crÃ©er</code></pre>

<p>GrÃ¢ce Ã  ceci, tu vÃ©rifies que :</p>
<ul>
  <li>Tes books sont bien liÃ©s aux authors</li>
  <li>Tes authors sont bien liÃ©s aux books</li>
</ul>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Parfois tu feras <code>Truc.create</code> et la console te renverra un truc ou y'a marquÃ© en rouge <code>ROLLBACK</code>. Cela veut dire que la sauvegarde n'a pas Ã©tÃ© prise en compte. Pour remÃ©dier Ã  ceci, la mÃ©thode <code>#errors</code> va te sauver la vie et t'expliquer ce qui a foirÃ©. Exemple avec notre book :</p>
      <pre><code class="language-ruby">> b = Book.create
#=> ROLLBACK
> b.errors
#=> Author must exist</code></pre>
      <p class="card-text">Ã‰tant donnÃ© que ton book <code>belongs_to</code> un auteur, eh bien <b>il faut absolument qu'un auteur soit dÃ©fini pour ton book AVANT de pouvoir le sauvegarder en BDD.</b> </p>
    </div>
  </div>
</div>

<h2>4. Points importants Ã  retenir</h2>

<p>Le systÃ¨me de migrations a de nombreux avantages, notamment :</p>

<ul>
  <li>Ce systÃ¨me permet de dÃ©barquer Ã  tout moment dans une application, savoir quelles sont les migrations qui sont faites (up) et celles qui sont Ã  faire (down), puis de pouvoir mettre Ã  jour sa base de donnÃ©es facilement. TrÃ¨s pratique pour travailler Ã  plusieurs dessus.</li>
  <li>Cela permet d'avoir des bases de donnÃ©es dynamiques que tu peux modifier facilement. Ainsi si jamais tu n'es pas content d'un model (nom foireux, mauvaise architecture), ce sera trÃ¨s simple de la modifier.</li>
</ul>


<p>Les principales commandes pour jouer avec les migrations sont :</p>
<ul>
  <li><code>$ rails generate migration nom_de_ta_migration</code>Â : crÃ©e une migration</li>
  <li><code>$ rails db:migrate</code>Â : passe toutes les migrations en attente</li>
  <li><code>$ rails db:migrate:status</code>Â : te sort un joli tableau pour voir oÃ¹ tu en es dans tes migrations entre les up et les down</li>
  <li><code>$ rails db:rollback</code>Â : revient en arriÃ¨re sur la derniÃ¨re migration.</li>
</ul>

<p>Il est primordial de ne <b>JAMAIS changer ni supprimer un fichier de migration</b> Ã  partir du moment oÃ¹ elle a Ã©tÃ© passÃ©e.</p>

<p>Chaque table (pluriel snake_caseÂ : <code>users</code>) doit Ãªtre liÃ©e Ã  un model (singulier CamelCaseÂ : <code>User</code>)</p>
<p>Tu peux crÃ©er un modÃ¨le et la migration permettant de crÃ©er sa table avec la commande <code>$ rails generate model NomDeTonModel</code> </p>


<p>Pour lier en 1-N deux tables et models entre eux, il faut procÃ©der en 2 Ã©tapesÂ : </p>
<ol>
  <li>Ajouter la clÃ© Ã©trangÃ¨re dans <b>la table qui reprÃ©sente l'objet appartenant Ã  l'autre</b>. ExempleÂ : <code>book</code> appartient Ã  son <code>author</code>, donc c'est <code>book</code> qui aura la clÃ© Ã©trangÃ¨re. Soit le faire dÃ¨s la crÃ©ation de la table, soit faire une migration avecÂ : <code>add_reference :books, :author, foreign_key: true</code></li>
  <li>Lier les models en utilisant <code>has_many</code> et <code>belongs_to</code>.</li>
</ol>

<p>La commande <code>$ rails console</code> sera ta future nouvelle amie (mais on y reviendra). Elle te sera d'une <b>immense</b> utilitÃ© pour vÃ©rifier que tes models sont bien liÃ©s.</p>


<h2>5. Pour aller plus loin</h2>
<p>Pour te familiariser avec les migrations, tu peux aller voir <a href="https://edgeguides.rubyonrails.org/active_record_migrations.html" target="_blank">le chapitre correspondant</a>, dans la doc des Rails Guides. ğŸ»</p>


<p>Voici un peu de lecture pour aller plus loin que les has_many et belongs_to de la ressource et mieux survivre en terres inconnues d'associations :</p>
<ul>
  <li>Voici <a href="https://www.youtube.com/watch?v=DAjfsW4gqGo" target="_blank">une vidÃ©o</a> qui reprend la partie sur les associations, et qui montre quelques mÃ©thodes en console pour jouer avec nos models.</li>
  <li>La doc contient une super grande page sur les associations entre diffÃ©rents modÃ¨les d'une app Rails, et sur les bonnes pratiques pour les rÃ©ussirÂ : <a href="http://guides.rubyonrails.org/association_basics.html" target="_blank">la voici</a>. On verra plus en dÃ©tail les associations demain mais essaye de prendre ce que tu peux dans cette doc pour le projet du jour.</li>
  <li>SitePoints ont fait <a href="https://www.sitepoint.com/brush-up-your-knowledge-of-rails-associations/" target="_blank">un bon tuto</a> qui reprend les bases des associations.</li>
</ul>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Rails Console, ta nouvelle meilleure amie</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>La console de Rails est un outil extrÃªmement puissant qui te permet de lancer PRY, branchÃ© Ã  ta base donnÃ©es. Elle te permet de :</p>

<ul>
	<li>Naviguer dans ta base de donnÃ©es</li>
	<li>Tester tes models</li>
	<li>Modifier ta base de donnÃ©es (pratique pour crÃ©er par exemple quelques utilisateurs Ã  la volÃ©e)</li>
</ul>

<p>Dans cette ressource nous allons te montrer comment interagir avec ta base avec la console.</p>

<h2>2. Historique</h2>
<p>Heu..</p>

<h2>3. La ressource</h2>

<h3>3.1. La console</h3>
<p>La console rails est ultra importante pour tester les BDD et est surtout hyper facile d'utilisation. Il suffit de taper la ligne de commande <code>$ rails console</code> dans ton Terminal pour y avoir accÃ¨s. BasÃ©e sur PRY, elle te permet d'exÃ©cuter du Plain Old Ruby, directement via le terminal.</p>

<p>Ã€ partir de lÃ , tu peux tester plein de mÃ©thodes !</p>

<pre><code class="language-ruby">Running via Spring preloader in process 8287
Loading development environment (Rails 5.2.2)
2.5.1 :001 > puts "Hello"
Hello
 => nil 
2.5.1 :003 > u = User.create
   (0.2ms)  begin transaction
  User Create (0.6ms)  INSERT INTO "users" DEFAULT VALUES
   (6.5ms)  commit transaction
 => #<User id: 4, timestamps: nil, name: nil> 
2.5.1 :004 > u.name
 => nil 
2.5.1 :005 > u.name = "FÃ©lix"
 => "FÃ©lix" 
2.5.1 :006 > u.save
   (0.2ms)  begin transaction
  User Update (0.7ms)  UPDATE "users" SET "name" = ? WHERE "users"."id" = ?  [["name", "FÃ©lix"], ["id", 4]]
   (9.2ms)  commit transaction
 => true </code></pre>

<p>Nous allons voir ensemble les mÃ©thodes que tu peux utiliser dans la console pour t'amuser avec tes models.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Tu peux lancer la console en mode sandbox grÃ¢ce Ã  l'option <code>$ rails console --sandbox</code>. Cela fera perdre toutes les donnÃ©es que tu as enregistrÃ©es lorsque tu quitteras la console. Pratique pour tester des models Ã  la volÃ©e.</p>
      <p>La console tu vas t'en servir trÃ¨Ã¨Ã¨s souvent. Balance un alias pour la lancer rapidement ğŸ˜‰</p>
    </div>
  </div>
</div>


<h3>3.2. Les mÃ©thodes importantes</h3>
<h4>3.2.1. Le CRUD</h4>
<p>Le CRUD, encore ? Et oui. Le CRUD est Ã  la base de toute application rails, donc autant s'y faire dÃ¨s aujourd'hui. On y reviendra la semaine prochaine, mais sache que toute action dans le MVC de rails sera forcÃ©ment l'une des 4 actions du CRUD. Bref, passons Ã  la suite.</p>

<p>Une fois ton model crÃ©Ã©, et liÃ© Ã  une table en base, te voici prÃªt Ã  t'amuser avec la console. Ã‡a va tout dÃ©chirer, car les commandes pour faire un CRUD en sont bien plus faciles que du SQL classique : on exÃ©cute des commandes sur notre model et les mÃ©thodes sont du ruby classique. Par exemple pour retrouver tous les utilisateurs c'est aussi simple que : <code>User.all</code>.</p>

<p>Voici sans plus tarder quelques fonctions de base pour interagir avec ta base de donnÃ©es, nous allons reprendre le CRUD vu hier :</p>

<h5>3.2.1.1. Create</h5>

<pre><code class="language-ruby">> martin = User.new(name: "Martin", email: "martion@gmail.com")
> martin.save</code></pre>

<p>ou</p>

<pre><code class="language-ruby">> martin = User.create(name: "Martin", email: "martion@gmail.com")</code></pre>

<p> <code>#create</code> est l'Ã©quivalent d'un <code>#new</code> suivi d'un <code>#save</code></p>

<h5>3.2.1.2. Read</h5>
<pre><code class="language-ruby">> u = User.find(3) # trouve l'utilisateur avec id = 3
> u.name #=> Affiche le prÃ©nom</code></pre>

<pre><code class="language-ruby">> david = User.find_by(name: 'David')
> david #=> donnera le premier rÃ©sultat qui match ou retournera nil si il n'y a aucun rÃ©sultat</code></pre>

<p>Il est possible de faire des recherches plus complexes avec la mÃ©thode <code>#where</code>:

<pre><code class="language-ruby">> users = User.where(name: 'David', age: 22).order(created_at: :desc)
# Cette ligne nous donnera tout les david de 22 ans par ordre chronologique.</code></pre>

<p>âš ï¸ Pour trier par Ã¢ge, il faut avoir une colonne Ã¢ge dans son model User !</p>

<h5>3.2.1.3. Update</h5>
<pre><code class="language-ruby">> user_1 = User.find(1)
> user_1.name = "a new name"
> user_1.save</code></pre>

<p>ou</p>

<pre><code class="language-ruby">> user_1 = User.find(1)
> user_1.update(name: "a new name")</code></pre>

<p>Il est bien entendu possible d'utiliser une mÃ©thode <code>#where</code> pour trouver l'Ã©lÃ©ment Ã  modifier.

<h5>3.2.1.4. Delete</h5>
<pre><code class="language-ruby">> user_1 = User.find(1)
> user_1.destroy</code></pre>

<h5>3.2.1.5. Ã€ toi de jouer !</h5>
Pour t'entraÃ®ner tu vas crÃ©er 5 profils avec la commande <code>create</code> et 5 avec les commandes <code>new</code> et <code>save</code>. Ensuite tu vas les rechercher avec <code>find</code> et <code>find_by</code>. Tu devras modifier le nom et/ou le mail de certains profils et en supprimer d'autres qui rÃ©pondent Ã  des critÃ¨res que tu auras fixÃ©s (supprimer tous les utilisateurs qui s'appellent "Jack" par exemple. Une fois Ã  l'aise, tu peux attaquer la suite. MaÃ®triser la console est <b>essentiel</b> pour pouvoir tester sa base rapidement en crÃ©ant des instances et en vÃ©rifiant qu'elles font bien ce pour quoi elles ont Ã©tÃ© conÃ§ues. </p>


<h4>3.2.2. Quelques mÃ©thodes</h4>


<p> ğŸBONUS ğŸ: La liste des fonctions prÃ©fÃ©rÃ©es du dev THP
<ul>
  <li><code>#all</code> : te ressort tout les Ã©lÃ©ments de ton modÃ¨le</li>
  <li><code>#new</code> : crÃ©er une nouvelle instance de ton modÃ¨le</li>
  <li><code>#save</code> : enregistre cette instance</li>
  <li><code>#create</code> : crÃ©er et enregistre une instance de modÃ¨le</li>
  <li><code>#update(attribute: value)</code> : met Ã  jour ton model</li>
  <li><code>#last</code> : pour vÃ©rifier la derniÃ¨re entrÃ©e en base</li>
  <li><code>#first</code> : pareil mais pour la premiere</li>
  <li><code>#find_by(attribute: value)</code> : pour rechercher une valeur spÃ©cifique</li>
  <li><code>#where(attribute: value)</code> : te ressort tous les Ã©lÃ©ments qui ont <code>value</code> Ã  l'<code>attribute</code></li>
</ul>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">âš ï¸ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Certaines de ces mÃ©thodes vont te ressortir un objet, d'autres une array. Fais donc attention avant de te lancer dans des <code>.email</code> pointÃ©s Ã  des arrays ;)</p>
    </div>
  </div>
</div>



<h4>3.2.3. Tester ses models</h4>
<p>Ce pourquoi j'utilise trÃ¨s souvent la console est que je peux tester trÃ¨s rapidement si mes models sont bien liÃ©s entre eux. Fais-le tout le temps. Apprends Ã  maÃ®triser ceci, puisque si tu sais le faire en console, tu sauras le faire dans ton programme. Voici par exemple comment tester que Book appartient bien Ã  Author et Author a plusieurs books :</p>

<pre><code class="language-ruby">> b = Book.new
#=> Super un book pas encore sauvegardÃ©
> b.author
#=> il te renvoie nil. S'il te renvoie une erreur, tu as mal suivi ce tuto
> a = Author.first
#=> un superbe auteur. S'il n'a rien, crÃ©e un truc
> b.author = a
#=> pas d'erreur
> b.save
#=> COMMIT. S'il te renvoie une erreur, tu as mal suivi ce tuto
> Book.last.author.books #=> RÃ©cupÃ¨re les books de l'author du dernier book que tu as en base (celui que tu viens de crÃ©Ã©r)
#=> Devrait te renvoyer une array qui contient le book que tu viens de crÃ©Ã©r</code></pre>


<h4>3.2.4. Bonus</h4>
<p>Puisque c'est toi, voici quelques mÃ©thodes en bonus que tu peux copier-coller dans ta console pour t'amuser/</p>

<h5>3.2.4.1. CrÃ©er 100 users</h5>
<p>Voici quelques lignes pour crÃ©er 100 utilisateurs :</p>
<pre><code class="language-ruby">100.times do |index|
	u = User.create
	u.name = "TonPrÃ©nom" + index.to_s
	u.email = "email_#{index}@email.com"
	u.save
end</code></pre>


<h5>3.2.4.2. Visualiser la base de donnÃ©es</h5>
<p>On me demande souvent si c'est possible d'utiliser un soft qui permet de visualiser sa base de donnÃ©es. Ce Ã  quoi je rÃ©ponds : "c'est une view dans ton app Ã§a" ou alors "la console est faite pour". Pour toi, voici une astuce pour afficher la base de donnÃ©es dans la console en mode "gros BG de l'Ã©cran noir". Pour ceci, il faudra passer par la gem <a href="https://github.com/arches/table_print" target="_blank">table_print</a>. Mets-la dans ton Gemfile, puis <code>bundle install</code>, puis tu n'as plus qu'Ã  l'activer dans ta console avec :</p>

<pre><code class="language-ruby">tp User.all</code></pre>

<p>Avoue que c'est assez BG quand mÃªme.</p>



<h2>4. Points importants Ã  retenir</h2>
<p>La console est ta meilleure amie. Utilise la TOUT LE TEMPS.</p>

<h2>5. Pour aller plus loin</h2>
<p>Nous te conseillons de jeter un oeil attentif Ã  ceci :  notre ami Jonathan a fait une <a href="https://youtu.be/UsuFC9-Irzw" target="_blank" class="text-primary">vidÃ©o oÃ¹ il s'amuse avec la console</a>, car la comprÃ©hension de la console est <b>indispensable</b> pour bien gÃ©rer tes modÃ¨les pour les prochains jours. Tu peux la regarder jusqu'Ã  12:59 (il parle du controller aprÃ¨s, et cela ne nous concerne pas pour le moment).</p>

<p>Pour plus d'informations sur les requÃªtes en ActiveRecord, la <a href="https://guides.rubyonrails.org/active_record_querying.html" target="_blank">doc</a> contient beaucoup d"info utiles (comme d'habitude).</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #5E66E5 " >
          <h1>Cours : Seed</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>
<p>Remplir sa base de donnÃ©es Ã  la main peut Ãªtre fastidieux. Et si on trouvait un moyen de remplir 100 books, comme Ã§a c'est la fÃªte et on a juste Ã  siroter un cafÃ© pendant que notre ordinateur le fait ? Mais c'est tout bonnement l'intÃ©rÃªt de l'informatique ğŸ‰</p>

<p>Les seeds vont te demander de <b>bien</b> comprendre le backend puisque tu vas crÃ©er plein d'Ã©lÃ©ments en base, qui doivent Ãªtre corrects. Ce sera une super occasion d'approfondir tes bases en backend et Model.</p>

<h2>2. Historique</h2>
<p>Boarf, y'a pas grand chose Ã  dire, si ce n'est que c'est la meilleure technique pour tester en local ton application.</p>

<h2>3. La ressource</h2>

<h3>3.1. Seed de base</h3>
<p>Au lieu de remplir sa BDD de dummy data Ã  la main, ce qui est particuliÃ¨rement fastidieux, on peut la <b>seed</b>. C'est Ã  dire la remplir de donnÃ©es random en exÃ©cutant la commande : </p>

<pre><code class="language-shell">$ rails db:seed</code></pre>

<p>Au prÃ©alable, tu devras prÃ©ciser ce que tu vas seeder dans le fichier <code>db/seeds.rb</code>. 

<p> Seeds.rb est comme un fichier oÃ¹ l'on peut Ã©crire des lignes de commande de Rails Console. Par exemple si tu Ã©cris Ã  l'intÃ©rieur :</p>

<pre><code class="language-ruby">User.create(name: "jean", email:"jean@jean.jean")
User.create(name: "paul", email:"paul@paul.paul")
p "Deux utilisateurs ont Ã©tÃ© crÃ©Ã©s"</code></pre>
Et que tu fais :

<pre><code class="language-ruby">$ rails db:seed</code></pre>

<p>Rails va te crÃ©er 2 utilisateurs, et t'afficher qu'il a crÃ©Ã© 2 utilisateurs.</p>

<p>Et le programme est encore plus intÃ©ressant si tu fais un truc du genre :</p>

<pre><code class="language-ruby"><code>100.times do |index|
  user = User.create!(name: "Nom#{index}", email: "email#{index}@example.com")
end</code></code></pre>

<p> Bref, tu pourras trouver des tuto pour seeds <a href="http://www.railszilla.com/rails-seed-data-example/rails" target="_blank">ici</a> et <a href="https://davidmles.com/seeding-database-rails/" target="_blank">lÃ </a>.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Comme tout le monde, tu vas te tromper au dÃ©but et devoir relancer ton programme plusieurs fois. Avant de commencer un seed, il est gÃ©nÃ©ralement bien vu de remettre sa base de donnÃ©es Ã  0, pour Ã©viter l'armÃ©e d'utilisateurs ayant le mÃªme email. Tu peux commencer ton seed par :</p>
      <pre><code class="language-ruby">Model1.destroy_all
Model2.destroy_all
etc</code></pre>
    </div>
  </div>
</div>


<h3>3.2. Seed avec Faker</h3>
<p><a href="https://github.com/stympy/faker" target="_blank">Faker</a> est une super gem qui permet de crÃ©er des faux noms Ã  la volÃ©e. Renseigner dans le gemfile la ligne correspondante, puis aprÃ¨s <code>bundle install</code> tu peux l'appeler dans le seed en faisant <code>require 'faker'</code>.</p>

<p>Voici un exemple de seed malin en utilisant la gem Faker : </p>
<pre><code class="language-ruby">require 'faker'
100.times do
  user = User.create!(name: Faker::Company.name, email: Faker::Internet.email)
end</code></pre>

<h2>4. Points importants Ã  retenir</h2>
<p>La fichier <code>db/seeds.rb</code> permet de mettre des lignes de code qui vont te faire remplir ta base de donnÃ©es. Une fois que ton seed est bon, tu n'as qu'Ã  faire <code>$ rails db:seed</code>.</p>

<p><a href="https://github.com/stympy/faker" target="_blank">Faker</a> est une super gem qui permet de crÃ©er des faux noms Ã  la volÃ©e.</p>

          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>


  <div class="container">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header" style="border-top: 3px solid #FF4081 " >
          <h1>Projet : Faire ses premiÃ¨res bases de donnÃ©es en Rails</h1>
          <a class="heading-elements-toggle">
          <i class="la la-ellipsis-v font-medium-3"></i>
          </a>
          <div class="heading-elements">
            <ul class="list-inline mb-0">
              <li><a data-action="collapse"><i class="ft-minus"></i></a></li>
              <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
            </ul>
          </div> 
      </div>
      <div class="card-content collapse show">
        <div class="card-body">
          <div class="tab-pane active" id="home1" role="tabpanel">
          <h2>1. Introduction</h2>

<p>Pour ce projet, on va transcrire les exercices de design de BDD d'hier vers Rails et ActiveRecord. En gros, pour chaque start-up que nous avions imaginÃ©, nous allons te demander de crÃ©er une application Rails puis de paramÃ©trer les models et associations pour que leur base de donnÃ©es soit fonctionnelle.</p>

<p>Dans un premier temps, on va prendre l'exemple du blog pour te guider dans la crÃ©ation d'une base de donnÃ©es Rails. Ensuite, on va suivre la mÃ©thodologie classique chez THPÂ : on te laisse la main et tu dois rÃ©pliquer ce que tu as vu, en t'appuyant si nÃ©cessaire sur l'aide de tes pairs.</p>

<h2>2. Le projet</h2>

<h3>2.1. Notre petit blog des familles</h3>

<h4>2.1.1. Un tableau, de la rÃ©flexion</h4>
<p>Depuis hier, et ta premiÃ¨re Ã©bauche de blog, tu n'as toujours pas vu passer d'article Medium parlant de ton concept rÃ©volutionnaire. Du coup tu dÃ©cides de repartir d'une feuille blanche : tu fais le choix de revoir ton blog pour qu'il propose des fonctionnalitÃ©s lÃ©gÃ¨rement diffÃ©rentes de la prÃ©cÃ©dente.<br>
Le concept version 2 est le suivant: c'est un super blog oÃ¹ les utilisateurs pourront s'enregistrer, crÃ©er des articles, les commenter (sans pouvoir commenter les commentaires), attribuer <b>une</b> catÃ©gorie Ã  chaque article et mÃªme les liker. Mindblowing ğŸ¤¯</p>

<p>Dans cette premiÃ¨re Ã©tape, prends ta feuille / ton tableau / ton ERD et rÃ©flÃ©chis en Ã©quipe Ã  l'organisation de ta base de donnÃ©es. Imagine tous les modÃ¨les qu'il faut pour le blog, les relations entre eux et Ã©videmment les attributs de chacun. On est dans une mise en situation typique d'un lancement de produitÂ : il faut concevoir en premier l'architecture de sa base de donnÃ©es ğŸ˜‡</p>

<p>Ã‰videmment, Jean-Michel Petit-malin va te dire "t'emmerde pas, y a un pas Ã  pas juste aprÃ¨sÂ !". Certes. AprÃ¨s, les architectures de base de donnÃ©es, c'est un peu comme la voitureÂ : c'est pas en lisant le code que t'apprends Ã  en faire (code de la route / code informatique. Vous l'avezÂ ? ğŸ‘Š) Il faut pratiqueÂ !! Au dÃ©but Ã§a va te paraÃ®tre insurmontable, on est super fÃ©brile, on se dit qu'on y arrivera pas. Mais trÃ¨s vite, on prend le pli, on devient plus serein, et on se met Ã  faire des trucs vraiment stylÃ©s. Donc tu peux regarder <a href="https://www.youtube.com/watch?v=OnEcAcVPXUw" target="_blank" class="text-primary">TAXI</a> en boucle, c'est pas Ã§a qui t'apprendra Ã  faire des <i>drifts</i> de ouf. I'm out. âœ‹ğŸ¤</p>


<h4>2.1.2. Une app Rails, et ses models</h4>
<p>Maintenant que tu as pu rÃ©flÃ©chir par toi-mÃªme, on va passer Ã  la pratique en construisant ensemble l'app Rails de blog avec ses models et ses associations.</p>

<h5>a) Les bases</h5>
<p>Commence par crÃ©er une application Rails, puis mets les bonnes versions de Ruby et Rails dans le Gemfile.</p>

<h5>b) Les users</h5>
<p>CrÃ©e un modÃ¨le <code>User</code>, liÃ© Ã  une table qui aura comme attributs :</p>
<ul>
  <li>Un <code>first_name</code>, qui est un string</li>
  <li>Un <code>last_name</code>, qui est un string</li>
  <li>Un <code>email</code>, qui est un string</li>
</ul>

<p>AprÃ¨s avoir fait ta migration, va dans la console et amuse-toi Ã  :</p>
<ul>
  <li>CrÃ©er des utilisateurs</li>
  <li>Les sauver en BDD</li>
  <li>Changer leurs <code>first_name</code>, <code>last_name</code></li>
  <li>RÃ©cupÃ©rer certains users avec <code>User.all</code>, <code>User.first</code>, <code>User.last</code> ou <code>User.find(xxx)</code></li>
</ul> 
<p>Bien maÃ®triser la console est <b>indispensable</b> pour bien comprendre les models et BDD en RailsÂ : donc fais-leÂ ! <br>
Ensuite, crÃ©e avec le seed 10 utilisateurs.</p>

<h5>c) Les articles</h5>
<p>Ajoute un model d'article. <br>
Un article a forcÃ©ment un auteur (qui est un user) et un user peut avoir Ã©crit plusieurs articles. Chaque article aura comme attributs :</p>
<ul>
  <li>Un <code>title</code>, qui est un string</li>
  <li>Un <code>content</code>, qui est un text</li>
</ul>

<p>Pour tester si ton association marche, va en console, et essaie d'ajouter Ã  la main des articles Ã  tes utilisateurs. Pour Ã§a, fais un truc du genre :</p>

<pre><code class="language-ruby">u = User.first
a = Article.new
a.user = u
u.save</code></pre>

<p>Lis-bien ce que le terminal te renvoieÂ : en cas de <code>ROLLBACK</code> ou d'erreur, tu t'es trompÃ©. Il faut reprendre ton modÃ¨le ou tes migrations.</p>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Parfois tu feras <code>Truc.create</code> et la console te fait un truc du genre :</p>
<pre><code class="language-ruby">> u.save
   (36.6ms)  BEGIN
   (24.4ms)  ROLLBACK</code></pre>

      <p>Tu peux faire <code>u.errors</code> pour que ActiveRecord te dise ce qui ne va pas.</p>
    </div>
  </div>
</div>

<p>Ã€ nouveau, fais-toi la main avec la console et crÃ©e des articles en base. C'est normal et indispensable de prendre un peu de temps pour se faire la main avec la consoleÂ : on est tous passÃ©s par lÃ  et tous les devs mÃªme seniors continuent de le faire ğŸ˜‰</p>

<p>Finalement, crÃ©e avec le fichier seed 10 articles en base de donnÃ©es (forcÃ©ment associÃ©s Ã  un auteur chacun).</p>

<h5>d) Les catÃ©gories</h5>
<p>Ajoute un model de catÃ©gorie. Un article a une catÃ©gorie, et une catÃ©gorie peut concerner plusieurs articles. Voici ses attributs :</p>
<ul>
  <li>Un <code>name</code>, qui est un string</li>
</ul>

<p>Bien entendu, teste la crÃ©ation de catÃ©gorie en console, teste aussi la relation entre les catÃ©gories et les articles. <br>
Finalement, crÃ©e avec le seed 5 catÃ©gories, puis associe tes 10 articles Ã  une des catÃ©gories.</p>

<h5>e) Les commentaires</h5>
<p>Maintenant nous allons mettre en place un systÃ¨me de commentaires. Un commentaire commentera un article, et aura un auteur (qui est un utilisateur). Un utilisateur peut crÃ©er plusieurs commentaires, et un article peut avoir plusieurs commentaires. Un commentaire aura comme attributs :</p>

<ul>
  <li>Un <code>content</code>, qui est un text.</li>
</ul>

<p>Sans surpriseÂ : teste la crÃ©ation de commentaires et leur bonne association aux users et articles depuis la consoleÂ ! <br>
Maintenant, crÃ©e dans le seed 15 commentaires, que tu assigneras Ã  des utilisateurs et Ã  des articles.</p>

<h5>f) Les likes</h5>
<p>DerniÃ¨re Ã©tape de l'architecture de ta BDD, nous allons maintenant faire en sorte de pouvoir liker un article. <br>
Un like concerne un article, et est fait par un likeur (qui est un utilisateur). Un utilisateur peut avoir plusieurs likes, et un article peut avoir plusieurs likes. Le like n'aura pas vraiment besoin d'attributs donc nous n'allons pas lui en donner ğŸ˜</p>

<p>On ne change pas les bonnes habitudesÂ : tests en console puis crÃ©ation de 15 likes en BDD avec le seed.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ğŸš€ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Si tu es malin, tu peux te rendre compte qu'Ã  travers un like, on crÃ©e une sorte de lien entre un article et un utilisateur (sans qu'il s'agisse de son auteur). Ainsi un article peut avoir plusieurs <i>likeurs</i> (utilisateurs), et un utilisateur peut avoir plusieurs <i>articles likÃ©s</i> (articles). <br>
      <b>Mais, mais, mais, cela ne ressemblerait pas Ã  une relation N-N entre articles et utilisateurs Ã§aÂ ?</b> Exactement chefÂ ! ğŸ¤  <br>
      Tu viens d'avoir une illustration de la faÃ§on dont on gÃ¨re une relation N-N dans Rails : grÃ¢ce Ã  une table intermÃ©diaire entre deux tables (la table <code>likes</code> dans notre cas), et quelques lignes d'association dans les models. C'est aussi simple que cela. Bref, nous verrons ceci plus en dÃ©tails demain, mais je pense que tu as compris l'astuce ğŸ¤“</p>
    </div>
  </div>
</div>


<h5>g) Faker</h5>
<p>Allez, OKLM, puisque que t'es arrivÃ© au boutÂ : utilise la gem Faker pour faire en sorte que les attributs des diffÃ©rents models soient (vaguement) plausibles (les pÃ©tages de plomb Ã  base de Chuck Norris Facts sont autorisÃ©s ğŸ¤ª). <br>
Va donc â€”lÃ©gÃ¨rementâ€” modifier ton seed pour que la crÃ©ation de chaque entrÃ©e en BDD contienne du faker et soit plus stylay.</p>


<h3>2.2. On dÃ©roule sur nos 4 autres startups</h3>
<p>Tu te souviens de MOOCademy, The Hacking Pinterest, The Hacking News et The Hacking ClassÂ ? Eh bien en repartant du travail de conception de BDD que tu avais effectuÃ©, crÃ©e une application Rails pour chacun avec les models, tables, associations et attributs qui vont bien. <br>
ComplÃ¨te le tout avec des seed en Faker, teste tout bien en console et le tour est dans le sacÂ !</p>


<h2>3. Rendu attendu</h2>
<p>Aujourd'hui, tu t'es muÃ© en crÃ©ateur prolifique de start-ups. Il faudra nous soumettre 5 liensÂ : </p>
<ul>
  <li>Un lien GitHub pour l'app Rails du blog</li>
  <li>Un lien GitHub pour l'app Rails de MOOCademy</li>
  <li>Un lien GitHub pour l'app Rails de The Hacking Pinterest</li>
  <li>Un lien GitHub pour l'app Rails de The Hacking News</li>
  <li>Un lien GitHub pour l'app Rails de The Hacking Class</li>
</ul>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>



</div>


  </div>
</div>
    <script src="/packs/dashboard-031178fac0de4f91cbcc.js"></script>
    

    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  </body>
</html>
